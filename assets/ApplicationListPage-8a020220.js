var j=Object.defineProperty;var $=(l,s,e)=>s in l?j(l,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[s]=e;var f=(l,s,e)=>($(l,typeof s!="symbol"?s+"":s,e),e);import{g as v,S as z,ac as w,s as d,i as a,ad as k,b as A,j as t,L as g,c as C,m as N,n as y,e as T,B as u,O as P,ae as I,u as L,h as q,T as F,af as R}from"./index-ba7d0766.js";import{h as B}from"./moment-fbc5633a.js";import{B as O}from"./BaseListPage-79bcb834.js";import{P as U}from"./PopconfirmModal-2c22ff01.js";import{T as D}from"./Table-c2bde13f.js";import{L as S}from"./index-3c7d130b.js";import{E}from"./EditOutlined-5579088b.js";import"./index-2f07707f.js";class Y extends O{constructor(e){super(e);f(this,"fetch",(e={})=>{const r=e.searchedColumn,p=e.searchText,i=e.sortField,n=e.sortOrder;this.setState({loading:!0}),(P(this.props.account)?I("admin",e.pagination.current,e.pagination.pageSize,r,p,i,n):L("admin",this.state.organizationName,e.pagination.current,e.pagination.pageSize,r,p,i,n)).then(o=>{o.status==="ok"?this.setState({loading:!1,data:o.data,pagination:{...e.pagination,total:o.data2},searchText:e.searchText,searchedColumn:e.searchedColumn}):q(o)&&this.setState({loading:!1,isAuthorized:!1})})})}componentDidMount(){this.setState({organizationName:this.props.account.owner})}newApplication(){const e=v();return{owner:"admin",name:`application_${e}`,organization:this.state.organizationName,createdTime:B().format(),displayName:`New Application - ${e}`,logo:`${z}/img/casdoor-logo_1185x256.png`,enablePassword:!0,enableSignUp:!0,enableSigninSession:!1,enableCodeSignin:!1,enableSamlCompress:!1,providers:[{name:"provider_captcha_default",canSignUp:!1,canSignIn:!1,canUnlink:!1,prompted:!1,alertType:"None"}],signupItems:[{name:"ID",visible:!1,required:!0,rule:"Random"},{name:"Username",visible:!0,required:!0,rule:"None"},{name:"Display name",visible:!0,required:!0,rule:"None"},{name:"Password",visible:!0,required:!0,rule:"None"},{name:"Confirm password",visible:!0,required:!0,rule:"None"},{name:"Email",visible:!0,required:!0,rule:"Normal"},{name:"Phone",visible:!0,required:!0,rule:"None"},{name:"Agreement",visible:!0,required:!0,rule:"None"}],cert:"cert-built-in",redirectUris:["http://localhost:9000/callback"],tokenFormat:"JWT",expireInHours:24*7,formOffset:2}}addApplication(){const e=this.newApplication();w(e).then(r=>{r.status==="ok"?(this.props.history.push({pathname:`/applications/${e.organization}/${e.name}`,mode:"add"}),d("success",a.t("general:Successfully added"))):d("error",`${a.t("general:Failed to add")}: ${r.msg}`)}).catch(r=>{d("error",`${a.t("general:Failed to connect to server")}: ${r}`)})}deleteApplication(e){k(this.state.data[e]).then(r=>{r.status==="ok"?(d("success",a.t("general:Successfully deleted")),this.setState({data:A(this.state.data,e),pagination:{total:this.state.pagination.total-1}})):d("error",`${a.t("general:Failed to delete")}: ${r.msg}`)}).catch(r=>{d("error",`${a.t("general:Failed to connect to server")}: ${r}`)})}renderTable(e){const r=[{title:a.t("general:Name"),dataIndex:"name",key:"name",width:"150px",fixed:"left",sorter:!0,...this.getColumnSearchProps("name"),render:(i,n,o)=>t.jsx(g,{to:`/applications/${n.organization}/${i}`,children:i})},{title:a.t("general:Created time"),dataIndex:"createdTime",key:"createdTime",width:"160px",sorter:!0,render:(i,n,o)=>C(i)},{title:a.t("general:Display name"),dataIndex:"displayName",key:"displayName",sorter:!0,...this.getColumnSearchProps("displayName")},{title:"Logo",dataIndex:"logo",key:"logo",width:"200px",render:(i,n,o)=>t.jsx("a",{target:"_blank",rel:"noreferrer",href:i,children:t.jsx("img",{src:i,alt:i,width:150})})},{title:a.t("general:Organization"),dataIndex:"organization",key:"organization",width:"150px",sorter:!0,...this.getColumnSearchProps("organization"),render:(i,n,o)=>t.jsx(g,{to:`/organizations/${i}`,children:i})},{title:a.t("general:Providers"),dataIndex:"providers",key:"providers",...this.getColumnSearchProps("providers"),render:(i,n,o)=>{const c=i;if(c.length===0)return`(${a.t("general:empty")})`;const h=Math.floor((c.length+1)/2),x=b=>t.jsx(S,{size:"small",locale:{emptyText:" "},dataSource:b,renderItem:(m,M)=>t.jsx(S.Item,{children:t.jsxs("div",{style:{display:"inline"},children:[t.jsx(F,{placement:"topLeft",title:"Edit",children:t.jsx(u,{style:{marginRight:"5px"},icon:t.jsx(E,{}),size:"small",onClick:()=>R(this,`/providers/${n.organization}/${m.name}`)})}),t.jsx(g,{to:`/providers/${n.organization}/${m.name}`,children:m.name})]})})});return t.jsx("div",{children:t.jsxs(N,{children:[t.jsx(y,{span:12,children:x(c.slice(0,h))}),t.jsx(y,{span:12,children:x(c.slice(h))})]})})}},{title:a.t("general:Action"),dataIndex:"",key:"op",width:"170px",fixed:T()?"false":"right",render:(i,n,o)=>t.jsxs("div",{children:[t.jsx(u,{style:{marginTop:"10px",marginBottom:"10px",marginRight:"10px"},type:"primary",onClick:()=>this.props.history.push(`/applications/${n.organization}/${n.name}`),children:a.t("general:Edit")}),t.jsx(U,{title:a.t("general:Sure to delete")+`: ${n.name} ?`,onConfirm:()=>this.deleteApplication(o),disabled:n.name==="app-built-in"})]})}],p={total:this.state.pagination.total,showQuickJumper:!0,showSizeChanger:!0,showTotal:()=>a.t("general:{total} in total").replace("{total}",this.state.pagination.total)};return t.jsx("div",{children:t.jsx(D,{scroll:{x:"max-content"},columns:r,dataSource:e,rowKey:"name",size:"middle",bordered:!0,pagination:p,title:()=>t.jsxs("div",{children:[a.t("general:Applications"),"    ",t.jsx(u,{type:"primary",size:"small",onClick:this.addApplication.bind(this),children:a.t("general:Add")})]}),loading:this.state.loading,onChange:this.handleTableChange})})}}export{Y as default};
