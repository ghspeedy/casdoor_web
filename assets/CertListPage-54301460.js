var g=Object.defineProperty;var m=(n,a,e)=>a in n?g(n,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[a]=e;var h=(n,a,e)=>(m(n,typeof a!="symbol"?a+"":a,e),e);import{g as u,s as d,i as t,b as x,j as s,L as y,c as f,e as C,B as p,h as S}from"./index-f0baa7a0.js";import{h as w}from"./moment-fbc5633a.js";import{a as k,d as T,g as v}from"./CertBackend-d8ae5857.js";import{B as $}from"./BaseListPage-041c389a.js";import{P as I}from"./PopconfirmModal-8710d8ae.js";import{T as b}from"./Table-f650b5e6.js";import"./index-9d454b6e.js";class M extends ${constructor(){super(...arguments);h(this,"fetch",(e={})=>{let r=e.searchedColumn,c=e.searchText;const o=e.sortField,l=e.sortOrder;e.category!==void 0&&e.category!==null?(r="category",c=e.category):e.type!==void 0&&e.type!==null&&(r="type",c=e.type),this.setState({loading:!0}),v("admin",e.pagination.current,e.pagination.pageSize,r,c,o,l).then(i=>{i.status==="ok"?this.setState({loading:!1,data:i.data,pagination:{...e.pagination,total:i.data2},searchText:e.searchText,searchedColumn:e.searchedColumn}):S(i)&&this.setState({loading:!1,isAuthorized:!1})})})}newCert(){const e=u();return{owner:"admin",name:`cert_${e}`,createdTime:w().format(),displayName:`New Cert - ${e}`,scope:"JWT",type:"x509",cryptoAlgorithm:"RS256",bitSize:4096,expireInYears:20,certificate:"",privateKey:""}}addCert(){const e=this.newCert();k(e).then(r=>{r.status==="ok"?(this.props.history.push({pathname:`/certs/${e.name}`,mode:"add"}),d("success",t.t("general:Successfully added"))):d("error",`${t.t("general:Failed to add")}: ${r.msg}`)}).catch(r=>{d("error",`${t.t("general:Failed to connect to server")}: ${r}`)})}deleteCert(e){T(this.state.data[e]).then(r=>{r.status==="ok"?(d("success",t.t("general:Successfully deleted")),this.setState({data:x(this.state.data,e),pagination:{total:this.state.pagination.total-1}})):d("error",`${t.t("general:Failed to delete")}: ${r.msg}`)}).catch(r=>{d("error",`${t.t("general:Failed to connect to server")}: ${r}`)})}renderTable(e){const r=[{title:t.t("general:Name"),dataIndex:"name",key:"name",width:"120px",fixed:"left",sorter:!0,...this.getColumnSearchProps("name"),render:(o,l,i)=>s.jsx(y,{to:`/certs/${o}`,children:o})},{title:t.t("general:Created time"),dataIndex:"createdTime",key:"createdTime",width:"180px",sorter:!0,render:(o,l,i)=>f(o)},{title:t.t("general:Display name"),dataIndex:"displayName",key:"displayName",sorter:!0,...this.getColumnSearchProps("displayName")},{title:t.t("provider:Scope"),dataIndex:"scope",key:"scope",filterMultiple:!1,filters:[{text:"JWT",value:"JWT"}],width:"110px",sorter:!0},{title:t.t("provider:Type"),dataIndex:"type",key:"type",filterMultiple:!1,filters:[{text:"x509",value:"x509"}],width:"110px",sorter:!0},{title:t.t("cert:Crypto algorithm"),dataIndex:"cryptoAlgorithm",key:"cryptoAlgorithm",filterMultiple:!1,filters:[{text:"RS256",value:"RS256"}],width:"190px",sorter:!0},{title:t.t("cert:Bit size"),dataIndex:"bitSize",key:"bitSize",width:"130px",sorter:!0,...this.getColumnSearchProps("bitSize")},{title:t.t("cert:Expire in years"),dataIndex:"expireInYears",key:"expireInYears",width:"170px",sorter:!0,...this.getColumnSearchProps("expireInYears")},{title:t.t("general:Action"),dataIndex:"",key:"op",width:"170px",fixed:C()?"false":"right",render:(o,l,i)=>s.jsxs("div",{children:[s.jsx(p,{style:{marginTop:"10px",marginBottom:"10px",marginRight:"10px"},type:"primary",onClick:()=>this.props.history.push(`/certs/${l.name}`),children:t.t("general:Edit")}),s.jsx(I,{title:t.t("general:Sure to delete")+`: ${l.name} ?`,onConfirm:()=>this.deleteCert(i)})]})}],c={total:this.state.pagination.total,showQuickJumper:!0,showSizeChanger:!0,showTotal:()=>t.t("general:{total} in total").replace("{total}",this.state.pagination.total)};return s.jsx("div",{children:s.jsx(b,{scroll:{x:"max-content"},columns:r,dataSource:e,rowKey:"name",size:"middle",bordered:!0,pagination:c,title:()=>s.jsxs("div",{children:[t.t("general:Certs"),"    ",s.jsx(p,{type:"primary",size:"small",onClick:this.addCert.bind(this),children:t.t("general:Add")})]}),loading:this.state.loading,onChange:this.handleTableChange})})}}export{M as default};
