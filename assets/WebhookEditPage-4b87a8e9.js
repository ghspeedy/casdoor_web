import{R as T,k as y,b as f,p as k,i,j as e,I as u,T as b,B as p,D as W,m as l,n as o,f as C,E as w,v as E,e as r,w as h,q as c,s as m,W as F}from"./index-ba7d0766.js";import{b as z,u as R,d as S}from"./WebhookBackend-40dc9ab6.js";import{T as L}from"./Table-c2bde13f.js";import{U as N}from"./UpOutlined-c7f9b9eb.js";import{D as O}from"./DeleteOutlined-b2ad8e5b.js";import{C as U}from"./index-1eb3247d.js";import"./javascript-2866a589.js";import"./javascript-caf49c66.js";import{S as j}from"./index-ae4cddc7.js";import{L as $}from"./LinkOutlined-b2beeea9.js";import"./UpOutlined-7082c42f.js";import"./DeleteOutlined-25685737.js";class D extends T.Component{constructor(t){super(t),this.state={classes:t}}updateTable(t){this.props.onUpdateTable(t)}updateField(t,a,s,n){t[a][s]=n,this.updateTable(t)}addRow(t){const a={name:`header-${t.length}`,value:`value-${t.length}`};t===void 0&&(t=[]),t=y(t,a),this.updateTable(t)}deleteRow(t,a){t=f(t,a),this.updateTable(t)}upRow(t,a){t=k(t,a-1,a),this.updateTable(t)}downRow(t,a){t=k(t,a,a+1),this.updateTable(t)}renderTable(t){const a=[{title:i.t("general:Name"),dataIndex:"name",key:"name",width:"250px",render:(s,n,d)=>e.jsx(u,{value:s,onChange:g=>{this.updateField(t,d,"name",g.target.value)}})},{title:i.t("webhook:Value"),dataIndex:"value",key:"value",render:(s,n,d)=>e.jsx(u,{value:s,onChange:g=>{this.updateField(t,d,"value",g.target.value)}})},{title:i.t("general:Action"),key:"action",width:"100px",render:(s,n,d)=>e.jsxs("div",{children:[e.jsx(b,{placement:"bottomLeft",title:i.t("general:Up"),children:e.jsx(p,{style:{marginRight:"5px"},disabled:d===0,icon:e.jsx(N,{}),size:"small",onClick:()=>this.upRow(t,d)})}),e.jsx(b,{placement:"topLeft",title:i.t("general:Down"),children:e.jsx(p,{style:{marginRight:"5px"},disabled:d===t.length-1,icon:e.jsx(W,{}),size:"small",onClick:()=>this.downRow(t,d)})}),e.jsx(b,{placement:"topLeft",title:i.t("general:Delete"),children:e.jsx(p,{icon:e.jsx(O,{}),size:"small",onClick:()=>this.deleteRow(t,d)})})]})}];return e.jsx(L,{rowKey:"index",columns:a,dataSource:t,size:"middle",bordered:!0,pagination:!1,title:()=>e.jsxs("div",{children:[this.props.title,"    ",e.jsx(p,{style:{marginRight:"5px"},type:"primary",size:"small",onClick:()=>this.addRow(t),children:i.t("general:Add")})]})})}render(){return e.jsx("div",{children:e.jsx(l,{style:{marginTop:"20px"},children:e.jsx(o,{span:24,children:this.renderTable(this.props.table)})})})}}const{Option:x}=c,I={id:9078,owner:"built-in",name:"68f55b28-7380-46b1-9bde-64fe1576e3b3",createdTime:"2022-01-01T01:03:42+08:00",organization:"built-in",clientIp:"159.89.126.192",user:"admin",method:"POST",requestUri:"/api/login",action:"login",isTriggered:!1},_={owner:"built-in",name:"admin",createdTime:"2020-07-16T21:46:52+08:00",updatedTime:"",id:"9eb20f79-3bb5-4e74-99ac-39e3b9a171e8",type:"normal-user",password:"123",passwordSalt:"",displayName:"Admin",avatar:"https://cdn.casbin.com/usercontent/admin/avatar/1596241359.png",permanentAvatar:"https://cdn.casbin.com/casdoor/avatar/casbin/admin.png",email:"admin@example.com",phone:"",location:"",address:null,affiliation:"",title:"",score:1e4,ranking:10,isOnline:!1,isAdmin:!0,isGlobalAdmin:!1,isForbidden:!1,isDeleted:!1,signupApplication:"app-casnode",properties:{bio:"",checkinDate:"20200801",editorType:"",emailVerifiedTime:"2020-07-16T21:46:52+08:00",fileQuota:"50",location:"",no:"22",oauth_QQ_displayName:"",oauth_QQ_verifiedTime:"",oauth_WeChat_displayName:"",oauth_WeChat_verifiedTime:"",onlineStatus:"false",phoneVerifiedTime:"",renameQuota:"3",tagline:"",website:""}};class Y extends T.Component{constructor(t){super(t),this.state={classes:t,webhookName:t.match.params.webhookName,webhook:null,organizations:[],mode:t.location.mode!==void 0?t.location.mode:"edit"}}UNSAFE_componentWillMount(){this.getWebhook(),this.getOrganizations()}getWebhook(){z("admin",this.state.webhookName).then(t=>{this.setState({webhook:t})})}getOrganizations(){C("admin").then(t=>{this.setState({organizations:t.msg===void 0?t:[]})})}parseWebhookField(t,a){return["port"].includes(t)&&(a=F(a)),a}updateWebhookField(t,a){a=this.parseWebhookField(t,a);const s=this.state.webhook;s[t]=a,this.setState({webhook:s})}renderWebhook(){const t=w(I);this.state.webhook.isUserExtended&&(t.extendedUser=_);const a=JSON.stringify(t,null,2);return e.jsxs(E,{size:"small",title:e.jsxs("div",{children:[this.state.mode==="add"?i.t("webhook:New Webhook"):i.t("webhook:Edit Webhook"),"    ",e.jsx(p,{onClick:()=>this.submitWebhookEdit(!1),children:i.t("general:Save")}),e.jsx(p,{style:{marginLeft:"20px"},type:"primary",onClick:()=>this.submitWebhookEdit(!0),children:i.t("general:Save & Exit")}),this.state.mode==="add"?e.jsx(p,{style:{marginLeft:"20px"},onClick:()=>this.deleteWebhook(),children:i.t("general:Cancel")}):null]}),style:r()?{margin:"5px"}:{},type:"inner",children:[e.jsxs(l,{style:{marginTop:"10px"},children:[e.jsxs(o,{style:{marginTop:"5px"},span:r()?22:2,children:[h(i.t("general:Organization"),i.t("general:Organization - Tooltip"))," :"]}),e.jsx(o,{span:22,children:e.jsx(c,{virtual:!1,style:{width:"100%"},value:this.state.webhook.organization,onChange:s=>{this.updateWebhookField("organization",s)},children:this.state.organizations.map((s,n)=>e.jsx(x,{value:s.name,children:s.name},n))})})]}),e.jsxs(l,{style:{marginTop:"20px"},children:[e.jsxs(o,{style:{marginTop:"5px"},span:r()?22:2,children:[h(i.t("general:Name"),i.t("general:Name - Tooltip"))," :"]}),e.jsx(o,{span:22,children:e.jsx(u,{value:this.state.webhook.name,onChange:s=>{this.updateWebhookField("name",s.target.value)}})})]}),e.jsxs(l,{style:{marginTop:"20px"},children:[e.jsxs(o,{style:{marginTop:"5px"},span:r()?22:2,children:[h(i.t("general:URL"),i.t("general:URL - Tooltip"))," :"]}),e.jsx(o,{span:22,children:e.jsx(u,{prefix:e.jsx($,{}),value:this.state.webhook.url,onChange:s=>{this.updateWebhookField("url",s.target.value)}})})]}),e.jsxs(l,{style:{marginTop:"20px"},children:[e.jsxs(o,{style:{marginTop:"5px"},span:r()?22:2,children:[h(i.t("general:Method"),i.t("webhook:Method - Tooltip"))," :"]}),e.jsx(o,{span:22,children:e.jsx(c,{virtual:!1,style:{width:"100%"},value:this.state.webhook.method,onChange:s=>{this.updateWebhookField("method",s)},children:[{id:"POST",name:"POST"},{id:"GET",name:"GET"},{id:"PUT",name:"PUT"},{id:"DELETE",name:"DELETE"}].map((s,n)=>e.jsx(x,{value:s.id,children:s.name},n))})})]}),e.jsxs(l,{style:{marginTop:"20px"},children:[e.jsxs(o,{style:{marginTop:"5px"},span:r()?22:2,children:[h(i.t("webhook:Content type"),i.t("webhook:Content type - Tooltip"))," :"]}),e.jsx(o,{span:22,children:e.jsx(c,{virtual:!1,style:{width:"100%"},value:this.state.webhook.contentType,onChange:s=>{this.updateWebhookField("contentType",s)},children:[{id:"application/json",name:"application/json"},{id:"application/x-www-form-urlencoded",name:"application/x-www-form-urlencoded"}].map((s,n)=>e.jsx(x,{value:s.id,children:s.name},n))})})]}),e.jsxs(l,{style:{marginTop:"20px"},children:[e.jsxs(o,{style:{marginTop:"5px"},span:r()?22:2,children:[h(i.t("webhook:Headers"),i.t("webhook:Headers - Tooltip"))," :"]}),e.jsx(o,{span:22,children:e.jsx(D,{title:i.t("webhook:Headers"),table:this.state.webhook.headers,onUpdateTable:s=>{this.updateWebhookField("headers",s)}})})]}),e.jsxs(l,{style:{marginTop:"20px"},children:[e.jsxs(o,{style:{marginTop:"5px"},span:r()?22:2,children:[h(i.t("webhook:Events"),i.t("webhook:Events - Tooltip"))," :"]}),e.jsx(o,{span:22,children:e.jsx(c,{virtual:!1,mode:"tags",style:{width:"100%"},value:this.state.webhook.events,onChange:s=>{this.updateWebhookField("events",s)},children:["signup","login","logout","add-user","update-user","add-organization","update-organization","add-provider","update-provider"].map((s,n)=>e.jsx(x,{value:s,children:s},s))})})]}),e.jsxs(l,{style:{marginTop:"20px"},children:[e.jsxs(o,{style:{marginTop:"5px"},span:r()?19:2,children:[h(i.t("webhook:Is user extended"),i.t("webhook:Is user extended - Tooltip"))," :"]}),e.jsx(o,{span:1,children:e.jsx(j,{checked:this.state.webhook.isUserExtended,onChange:s=>{this.updateWebhookField("isUserExtended",s)}})})]}),e.jsxs(l,{style:{marginTop:"20px"},children:[e.jsxs(o,{style:{marginTop:"5px"},span:r()?22:2,children:[h(i.t("general:Preview"),i.t("general:Preview - Tooltip"))," :"]}),e.jsx(o,{span:22,children:e.jsx("div",{style:{width:"900px",height:"300px"},children:e.jsx(U,{value:a,options:{mode:"javascript",theme:"material-darker"},onBeforeChange:(s,n,d)=>{}})})})]}),e.jsxs(l,{style:{marginTop:"20px"},children:[e.jsxs(o,{style:{marginTop:"5px"},span:r()?19:2,children:[h(i.t("general:Is enabled"),i.t("general:Is enabled - Tooltip"))," :"]}),e.jsx(o,{span:1,children:e.jsx(j,{checked:this.state.webhook.isEnabled,onChange:s=>{this.updateWebhookField("isEnabled",s)}})})]})]})}submitWebhookEdit(t){const a=w(this.state.webhook);R(this.state.webhook.owner,this.state.webhookName,a).then(s=>{s.status==="ok"?(m("success",i.t("general:Successfully saved")),this.setState({webhookName:this.state.webhook.name}),t?this.props.history.push("/webhooks"):this.props.history.push(`/webhooks/${this.state.webhook.name}`)):(m("error",`${i.t("general:Failed to save")}: ${s.msg}`),this.updateWebhookField("name",this.state.webhookName))}).catch(s=>{m("error",`${i.t("general:Failed to connect to server")}: ${s}`)})}deleteWebhook(){S(this.state.webhook).then(t=>{t.status==="ok"?this.props.history.push("/webhooks"):m("error",`${i.t("general:Failed to delete")}: ${t.msg}`)}).catch(t=>{m("error",`${i.t("general:Failed to connect to server")}: ${t}`)})}render(){return e.jsxs("div",{children:[this.state.webhook!==null?this.renderWebhook():null,e.jsxs("div",{style:{marginTop:"20px",marginLeft:"40px"},children:[e.jsx(p,{size:"large",onClick:()=>this.submitWebhookEdit(!1),children:i.t("general:Save")}),e.jsx(p,{style:{marginLeft:"20px"},type:"primary",size:"large",onClick:()=>this.submitWebhookEdit(!0),children:i.t("general:Save & Exit")}),this.state.mode==="add"?e.jsx(p,{style:{marginLeft:"20px"},size:"large",onClick:()=>this.deleteWebhook(),children:i.t("general:Cancel")}):null]})]})}}export{Y as default};
