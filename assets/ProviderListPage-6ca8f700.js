var x=Object.defineProperty;var v=(l,d,e)=>d in l?x(l,d,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[d]=e;var c=(l,d,e)=>(v(l,typeof d!="symbol"?d+"":d,e),e);import{O as p,g as y,s as u,i as r,b as S,j as o,L as f,c as P,$ as s,a0 as w,a1 as g,e as C,B as m,h as k}from"./index-f0baa7a0.js";import{h as $}from"./moment-fbc5633a.js";import{a as M,d as A,g as T,b}from"./ProviderBackend-1fec7bcd.js";import{B as I}from"./BaseListPage-041c389a.js";import{P as j}from"./PopconfirmModal-8710d8ae.js";import{T as L}from"./Table-f650b5e6.js";import"./index-9d454b6e.js";class D extends I{constructor(e){super(e);c(this,"fetch",(e={})=>{let a=e.searchedColumn,h=e.searchText;const t=e.sortField,i=e.sortOrder;e.category!==void 0&&e.category!==null?(a="category",h=e.category):e.type!==void 0&&e.type!==null&&(a="type",h=e.type),this.setState({loading:!0}),(p(this.props.account)?T(e.pagination.current,e.pagination.pageSize,a,h,t,i):b(this.state.owner,e.pagination.current,e.pagination.pageSize,a,h,t,i)).then(n=>{n.status==="ok"?this.setState({loading:!1,data:n.data,pagination:{...e.pagination,total:n.data2},searchText:e.searchText,searchedColumn:e.searchedColumn}):k(n)&&this.setState({loading:!1,isAuthorized:!1})})})}componentDidMount(){this.setState({owner:p(this.props.account)?"admin":this.props.account.owner})}newProvider(){const e=y();return{owner:this.state.owner,name:`provider_${e}`,createdTime:$().format(),displayName:`New Provider - ${e}`,category:"OAuth",type:"GitHub",method:"Normal",clientId:"",clientSecret:"",enableSignUp:!0,host:"",port:0,providerUrl:"https://github.com/organizations/xxx/settings/applications/1234567"}}addProvider(){const e=this.newProvider();M(e).then(a=>{a.status==="ok"?(this.props.history.push({pathname:`/providers/${e.owner}/${e.name}`,mode:"add"}),u("success",r.t("general:Successfully added"))):u("error",`${r.t("general:Failed to add")}: ${a.msg}`)}).catch(a=>{u("error",`${r.t("general:Failed to connect to server")}: ${a}`)})}deleteProvider(e){A(this.state.data[e]).then(a=>{a.status==="ok"?(u("success",r.t("general:Successfully deleted")),this.setState({data:S(this.state.data,e),pagination:{total:this.state.pagination.total-1}})):u("error",`${r.t("general:Failed to delete")}: ${a.msg}`)}).catch(a=>{u("error",`${r.t("general:Failed to connect to server")}: ${a}`)})}renderTable(e){const a=[{title:r.t("general:Name"),dataIndex:"name",key:"name",width:"120px",fixed:"left",sorter:!0,...this.getColumnSearchProps("name"),render:(t,i,n)=>o.jsx(f,{to:`/providers/${i.owner}/${t}`,children:t})},{title:r.t("general:Organization"),dataIndex:"owner",key:"owner",width:"150px",sorter:!0,...this.getColumnSearchProps("owner")},{title:r.t("general:Created time"),dataIndex:"createdTime",key:"createdTime",width:"180px",sorter:!0,render:(t,i,n)=>P(t)},{title:r.t("general:Display name"),dataIndex:"displayName",key:"displayName",sorter:!0,...this.getColumnSearchProps("displayName")},{title:r.t("provider:Category"),dataIndex:"category",key:"category",filterMultiple:!1,filters:[{text:"OAuth",value:"OAuth"},{text:"Email",value:"Email"},{text:"SMS",value:"SMS"},{text:"Storage",value:"Storage"},{text:"SAML",value:"SAML"},{text:"Captcha",value:"Captcha"},{text:"Payment",value:"Payment"}],width:"110px",sorter:!0},{title:r.t("provider:Type"),dataIndex:"type",key:"type",width:"110px",align:"center",filterMultiple:!1,filters:[{text:"OAuth",value:"OAuth",children:s("OAuth").map(t=>({text:t.id,value:t.name}))},{text:"Email",value:"Email",children:s("Email").map(t=>({text:t.id,value:t.name}))},{text:"SMS",value:"SMS",children:s("SMS").map(t=>({text:t.id,value:t.name}))},{text:"Storage",value:"Storage",children:s("Storage").map(t=>({text:t.id,value:t.name}))},{text:"SAML",value:"SAML",children:s("SAML").map(t=>({text:t.id,value:t.name}))},{text:"Captcha",value:"Captcha",children:s("Captcha").map(t=>({text:t.id,value:t.name}))},{text:"Payment",value:"Payment",children:s("Payment").map(t=>({text:t.id,value:t.name}))}],sorter:!0,render:(t,i,n)=>w(i)},{title:r.t("provider:Client ID"),dataIndex:"clientId",key:"clientId",width:"100px",sorter:!0,...this.getColumnSearchProps("clientId"),render:(t,i,n)=>g(t)},{title:r.t("provider:Provider URL"),dataIndex:"providerUrl",key:"providerUrl",width:"150px",sorter:!0,...this.getColumnSearchProps("providerUrl"),render:(t,i,n)=>o.jsx("a",{target:"_blank",rel:"noreferrer",href:t,children:g(t)})},{title:r.t("general:Action"),dataIndex:"",key:"op",width:"170px",fixed:C()?"false":"right",render:(t,i,n)=>o.jsxs("div",{children:[o.jsx(m,{disabled:!p(this.props.account)&&i.owner!==this.props.account.owner,style:{marginTop:"10px",marginBottom:"10px",marginRight:"10px"},type:"primary",onClick:()=>this.props.history.push(`/providers/${i.owner}/${i.name}`),children:r.t("general:Edit")}),o.jsx(j,{title:r.t("general:Sure to delete")+`: ${i.name} ?`,onConfirm:()=>this.deleteProvider(n)})]})}],h={total:this.state.pagination.total,showQuickJumper:!0,showSizeChanger:!0,showTotal:()=>r.t("general:{total} in total").replace("{total}",this.state.pagination.total)};return o.jsx("div",{children:o.jsx(L,{scroll:{x:"max-content"},columns:a,dataSource:e,rowKey:"name",size:"middle",bordered:!0,pagination:h,title:()=>o.jsxs("div",{children:[r.t("general:Providers"),"    ",o.jsx(m,{type:"primary",size:"small",onClick:this.addProvider.bind(this),children:r.t("general:Add")})]}),loading:this.state.loading,onChange:this.handleTableChange})})}}export{D as default};
