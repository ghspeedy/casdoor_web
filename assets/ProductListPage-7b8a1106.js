var w=Object.defineProperty;var j=(d,n,e)=>n in d?w(d,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[n]=e;var x=(d,n,e)=>(j(d,typeof n!="symbol"?n+"":n,e),e);import{g as k,S as C,s as l,i as t,b as $,j as r,L as y,c as T,m as v,n as f,e as I,B as p,h as b,T as L,af as B}from"./index-f0baa7a0.js";import{h as R}from"./moment-fbc5633a.js";import{a as z,d as F,g as N}from"./ProductBackend-ca9984e6.js";import{B as E}from"./BaseListPage-041c389a.js";import{P as q}from"./PopconfirmModal-8710d8ae.js";import{T as D}from"./Table-f650b5e6.js";import{L as P}from"./index-64aa6822.js";import{E as M}from"./EditOutlined-4f6290b9.js";import"./index-9d454b6e.js";class X extends E{constructor(){super(...arguments);x(this,"fetch",(e={})=>{let a=e.searchedColumn,c=e.searchText;const i=e.sortField,o=e.sortOrder;e.type!==void 0&&e.type!==null&&(a="type",c=e.type),this.setState({loading:!0}),N("",e.pagination.current,e.pagination.pageSize,a,c,i,o).then(s=>{s.status==="ok"?this.setState({loading:!1,data:s.data,pagination:{...e.pagination,total:s.data2},searchText:e.searchText,searchedColumn:e.searchedColumn}):b(s)&&this.setState({loading:!1,isAuthorized:!1})})})}newProduct(){const e=k();return{owner:"admin",name:`product_${e}`,createdTime:R().format(),displayName:`New Product - ${e}`,image:`${C}/img/casdoor-logo_1185x256.png`,tag:"Casdoor Summit 2022",currency:"USD",price:300,quantity:99,sold:10,providers:[],state:"Published"}}addProduct(){const e=this.newProduct();z(e).then(a=>{a.status==="ok"?(this.props.history.push({pathname:`/products/${e.name}`,mode:"add"}),l("success",t.t("general:Successfully added"))):l("error",`${t.t("general:Failed to add")}: ${a.msg}`)}).catch(a=>{l("error",`${t.t("general:Failed to connect to server")}: ${a}`)})}deleteProduct(e){F(this.state.data[e]).then(a=>{a.status==="ok"?(l("success",t.t("general:Successfully deleted")),this.setState({data:$(this.state.data,e),pagination:{total:this.state.pagination.total-1}})):l("error",`${t.t("general:Failed to delete")}: ${a.msg}`)}).catch(a=>{l("error",`${t.t("general:Failed to connect to server")}: ${a}`)})}renderTable(e){const a=[{title:t.t("general:Name"),dataIndex:"name",key:"name",width:"140px",fixed:"left",sorter:!0,...this.getColumnSearchProps("name"),render:(i,o,s)=>r.jsx(y,{to:`/products/${i}`,children:i})},{title:t.t("general:Created time"),dataIndex:"createdTime",key:"createdTime",width:"160px",sorter:!0,render:(i,o,s)=>T(i)},{title:t.t("general:Display name"),dataIndex:"displayName",key:"displayName",width:"170px",sorter:!0,...this.getColumnSearchProps("displayName")},{title:t.t("product:Image"),dataIndex:"image",key:"image",width:"170px",render:(i,o,s)=>r.jsx("a",{target:"_blank",rel:"noreferrer",href:i,children:r.jsx("img",{src:i,alt:i,width:150})})},{title:t.t("user:Tag"),dataIndex:"tag",key:"tag",width:"160px",sorter:!0,...this.getColumnSearchProps("tag")},{title:t.t("payment:Currency"),dataIndex:"currency",key:"currency",width:"120px",sorter:!0,...this.getColumnSearchProps("currency")},{title:t.t("product:Price"),dataIndex:"price",key:"price",width:"120px",sorter:!0,...this.getColumnSearchProps("price")},{title:t.t("product:Quantity"),dataIndex:"quantity",key:"quantity",width:"120px",sorter:!0,...this.getColumnSearchProps("quantity")},{title:t.t("product:Sold"),dataIndex:"sold",key:"sold",width:"120px",sorter:!0,...this.getColumnSearchProps("sold")},{title:t.t("general:State"),dataIndex:"state",key:"state",width:"120px",sorter:!0,...this.getColumnSearchProps("state")},{title:t.t("product:Payment providers"),dataIndex:"providers",key:"providers",width:"500px",...this.getColumnSearchProps("providers"),render:(i,o,s)=>{const h=i;if(h.length===0)return`(${t.t("general:empty")})`;const g=Math.floor((h.length+1)/2),m=S=>r.jsx(P,{size:"small",locale:{emptyText:" "},dataSource:S,renderItem:(u,A)=>r.jsx(P.Item,{children:r.jsxs("div",{style:{display:"inline"},children:[r.jsx(L,{placement:"topLeft",title:"Edit",children:r.jsx(p,{style:{marginRight:"5px"},icon:r.jsx(M,{}),size:"small",onClick:()=>B(this,`/providers/${u}`)})}),r.jsx(y,{to:`/providers/${u}`,children:u})]})})});return r.jsx("div",{children:r.jsxs(v,{children:[r.jsx(f,{span:12,children:m(h.slice(0,g))}),r.jsx(f,{span:12,children:m(h.slice(g))})]})})}},{title:t.t("general:Action"),dataIndex:"",key:"op",width:"230px",fixed:I()?"false":"right",render:(i,o,s)=>r.jsxs("div",{children:[r.jsx(p,{style:{marginTop:"10px",marginBottom:"10px",marginRight:"10px"},onClick:()=>this.props.history.push(`/products/${o.name}/buy`),children:t.t("product:Buy")}),r.jsx(p,{style:{marginTop:"10px",marginBottom:"10px",marginRight:"10px"},type:"primary",onClick:()=>this.props.history.push(`/products/${o.name}`),children:t.t("general:Edit")}),r.jsx(q,{title:t.t("general:Sure to delete")+`: ${o.name} ?`,onConfirm:()=>this.deleteProduct(s)})]})}],c={total:this.state.pagination.total,showQuickJumper:!0,showSizeChanger:!0,showTotal:()=>t.t("general:{total} in total").replace("{total}",this.state.pagination.total)};return r.jsx("div",{children:r.jsx(D,{scroll:{x:"max-content"},columns:a,dataSource:e,rowKey:"name",size:"middle",bordered:!0,pagination:c,title:()=>r.jsxs("div",{children:[t.t("general:Products"),"    ",r.jsx(p,{type:"primary",size:"small",onClick:this.addProduct.bind(this),children:t.t("general:Add")})]}),loading:this.state.loading,onChange:this.handleTableChange})})}}export{X as default};
