import{R as g,j as t,v as j,i as s,B as o,e as a,m as n,n as r,w as l,I as p,q as u,E as y,s as c,W as P}from"./index-ba7d0766.js";import{b as v,u as T,d as f}from"./ProductBackend-7b776bbf.js";import{b as C}from"./ProviderBackend-aef53d7c.js";import b from"./ProductBuyPage-d0db4635.js";import{I as h}from"./index-4091184f.js";import{L as m}from"./LinkOutlined-b2beeea9.js";import"./index-00085cca.js";import"./UpOutlined-7082c42f.js";const{Option:x}=u;class U extends g.Component{constructor(e){super(e),this.state={classes:e,organizationName:e.organizationName!==void 0?e.organizationName:e.match.params.organizationName,productName:e.match.params.productName,product:null,providers:[],mode:e.location.mode!==void 0?e.location.mode:"edit"}}UNSAFE_componentWillMount(){this.getProduct(),this.getPaymentProviders()}getProduct(){v("admin",this.state.productName).then(e=>{this.setState({product:e})})}getPaymentProviders(){C("admin").then(e=>{this.setState({providers:e.filter(i=>i.category==="Payment")})})}parseProductField(e,i){return[""].includes(e)&&(i=P(i)),i}updateProductField(e,i){i=this.parseProductField(e,i);const d=this.state.product;d[e]=i,this.setState({product:d})}renderProduct(){return t.jsxs(j,{size:"small",title:t.jsxs("div",{children:[this.state.mode==="add"?s.t("product:New Product"):s.t("product:Edit Product"),"    ",t.jsx(o,{onClick:()=>this.submitProductEdit(!1),children:s.t("general:Save")}),t.jsx(o,{style:{marginLeft:"20px"},type:"primary",onClick:()=>this.submitProductEdit(!0),children:s.t("general:Save & Exit")}),this.state.mode==="add"?t.jsx(o,{style:{marginLeft:"20px"},onClick:()=>this.deleteProduct(),children:s.t("general:Cancel")}):null]}),style:a()?{margin:"5px"}:{},type:"inner",children:[t.jsxs(n,{style:{marginTop:"20px"},children:[t.jsxs(r,{style:{marginTop:"5px"},span:a()?22:2,children:[l(s.t("general:Name"),s.t("general:Name - Tooltip"))," :"]}),t.jsx(r,{span:22,children:t.jsx(p,{value:this.state.product.name,onChange:e=>{this.updateProductField("name",e.target.value)}})})]}),t.jsxs(n,{style:{marginTop:"20px"},children:[t.jsxs(r,{style:{marginTop:"5px"},span:a()?22:2,children:[l(s.t("general:Display name"),s.t("general:Display name - Tooltip"))," :"]}),t.jsx(r,{span:22,children:t.jsx(p,{value:this.state.product.displayName,onChange:e=>{this.updateProductField("displayName",e.target.value)}})})]}),t.jsxs(n,{style:{marginTop:"20px"},children:[t.jsxs(r,{style:{marginTop:"5px"},span:a()?22:2,children:[l(s.t("product:Image"),s.t("product:Image - Tooltip"))," :"]}),t.jsxs(r,{span:22,style:a()?{maxWidth:"100%"}:{},children:[t.jsxs(n,{style:{marginTop:"20px"},children:[t.jsxs(r,{style:{marginTop:"5px"},span:a()?22:1,children:[l(s.t("general:URL"),s.t("general:URL - Tooltip"))," :"]}),t.jsx(r,{span:23,children:t.jsx(p,{prefix:t.jsx(m,{}),value:this.state.product.image,onChange:e=>{this.updateProductField("image",e.target.value)}})})]}),t.jsxs(n,{style:{marginTop:"20px"},children:[t.jsxs(r,{style:{marginTop:"5px"},span:a()?22:1,children:[s.t("general:Preview"),":"]}),t.jsx(r,{span:23,children:t.jsx("a",{target:"_blank",rel:"noreferrer",href:this.state.product.image,children:t.jsx("img",{src:this.state.product.image,alt:this.state.product.image,height:90,style:{marginBottom:"20px"}})})})]})]})]}),t.jsxs(n,{style:{marginTop:"20px"},children:[t.jsxs(r,{style:{marginTop:"5px"},span:a()?22:2,children:[l(s.t("user:Tag"),s.t("product:Tag - Tooltip"))," :"]}),t.jsx(r,{span:22,children:t.jsx(p,{value:this.state.product.tag,onChange:e=>{this.updateProductField("tag",e.target.value)}})})]}),t.jsxs(n,{style:{marginTop:"20px"},children:[t.jsxs(r,{style:{marginTop:"5px"},span:a()?22:2,children:[l(s.t("product:Detail"),s.t("product:Detail - Tooltip"))," :"]}),t.jsx(r,{span:22,children:t.jsx(p,{value:this.state.product.detail,onChange:e=>{this.updateProductField("detail",e.target.value)}})})]}),t.jsxs(n,{style:{marginTop:"20px"},children:[t.jsxs(r,{style:{marginTop:"5px"},span:a()?22:2,children:[l(s.t("general:Description"),s.t("general:Description - Tooltip"))," :"]}),t.jsx(r,{span:22,children:t.jsx(p,{value:this.state.product.description,onChange:e=>{this.updateProductField("description",e.target.value)}})})]}),t.jsxs(n,{style:{marginTop:"20px"},children:[t.jsxs(r,{style:{marginTop:"5px"},span:a()?22:2,children:[l(s.t("payment:Currency"),s.t("payment:Currency - Tooltip"))," :"]}),t.jsx(r,{span:22,children:t.jsx(u,{virtual:!1,style:{width:"100%"},value:this.state.product.currency,onChange:e=>{this.updateProductField("currency",e)},children:[{id:"USD",name:"USD"},{id:"CNY",name:"CNY"}].map((e,i)=>t.jsx(x,{value:e.id,children:e.name},i))})})]}),t.jsxs(n,{style:{marginTop:"20px"},children:[t.jsxs(r,{style:{marginTop:"5px"},span:a()?22:2,children:[l(s.t("product:Price"),s.t("product:Price - Tooltip"))," :"]}),t.jsx(r,{span:22,children:t.jsx(h,{value:this.state.product.price,onChange:e=>{this.updateProductField("price",e)}})})]}),t.jsxs(n,{style:{marginTop:"20px"},children:[t.jsxs(r,{style:{marginTop:"5px"},span:a()?22:2,children:[l(s.t("product:Quantity"),s.t("product:Quantity - Tooltip"))," :"]}),t.jsx(r,{span:22,children:t.jsx(h,{value:this.state.product.quantity,onChange:e=>{this.updateProductField("quantity",e)}})})]}),t.jsxs(n,{style:{marginTop:"20px"},children:[t.jsxs(r,{style:{marginTop:"5px"},span:a()?22:2,children:[l(s.t("product:Sold"),s.t("product:Sold - Tooltip"))," :"]}),t.jsx(r,{span:22,children:t.jsx(h,{value:this.state.product.sold,onChange:e=>{this.updateProductField("sold",e)}})})]}),t.jsxs(n,{style:{marginTop:"20px"},children:[t.jsxs(r,{style:{marginTop:"5px"},span:a()?22:2,children:[l(s.t("product:Payment providers"),s.t("product:Payment providers - Tooltip"))," :"]}),t.jsx(r,{span:22,children:t.jsx(u,{virtual:!1,mode:"tags",style:{width:"100%"},value:this.state.product.providers,onChange:e=>{this.updateProductField("providers",e)},children:this.state.providers.map((e,i)=>t.jsx(x,{value:e.name,children:e.name},i))})})]}),t.jsxs(n,{style:{marginTop:"20px"},children:[t.jsxs(r,{style:{marginTop:"5px"},span:a()?22:2,children:[l(s.t("product:Return URL"),s.t("product:Return URL - Tooltip"))," :"]}),t.jsx(r,{span:22,children:t.jsx(p,{prefix:t.jsx(m,{}),value:this.state.product.returnUrl,onChange:e=>{this.updateProductField("returnUrl",e.target.value)}})})]}),t.jsxs(n,{style:{marginTop:"20px"},children:[t.jsxs(r,{style:{marginTop:"5px"},span:a()?22:2,children:[l(s.t("general:State"),s.t("general:State - Tooltip"))," :"]}),t.jsx(r,{span:22,children:t.jsx(u,{virtual:!1,style:{width:"100%"},value:this.state.product.state,onChange:e=>{this.updateProductField("state",e)},children:[{id:"Published",name:"Published"},{id:"Draft",name:"Draft"}].map((e,i)=>t.jsx(x,{value:e.id,children:e.name},i))})})]}),t.jsxs(n,{style:{marginTop:"20px"},children:[t.jsxs(r,{style:{marginTop:"5px"},span:a()?22:2,children:[l(s.t("general:Preview"),s.t("general:Preview - Tooltip"))," :"]}),this.renderPreview()]})]})}renderPreview(){const e=`/products/${this.state.product.name}/buy`;return t.jsxs(r,{span:22,style:{display:"flex",flexDirection:"column"},children:[t.jsx("a",{style:{marginBottom:"10px",display:"flex"},target:"_blank",rel:"noreferrer",href:e,children:t.jsx(o,{type:"primary",children:s.t("product:Test buy page..")})}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("div",{style:{width:"90%",border:"1px solid rgb(217,217,217)",boxShadow:"10px 10px 5px #888888",alignItems:"center",overflow:"auto",flexDirection:"column",flex:"auto"},children:t.jsx(b,{product:this.state.product})})]})}submitProductEdit(e){const i=y(this.state.product);T(this.state.product.owner,this.state.productName,i).then(d=>{d.status==="ok"?(c("success",s.t("general:Successfully saved")),this.setState({productName:this.state.product.name}),e?this.props.history.push("/products"):this.props.history.push(`/products/${this.state.product.name}`)):(c("error",`${s.t("general:Failed to save")}: ${d.msg}`),this.updateProductField("name",this.state.productName))}).catch(d=>{c("error",`${s.t("general:Failed to connect to server")}: ${d}`)})}deleteProduct(){f(this.state.product).then(e=>{e.status==="ok"?this.props.history.push("/products"):c("error",`${s.t("general:Failed to delete")}: ${e.msg}`)}).catch(e=>{c("error",`${s.t("general:Failed to connect to server")}: ${e}`)})}render(){return t.jsxs("div",{children:[this.state.product!==null?this.renderProduct():null,t.jsxs("div",{style:{marginTop:"20px",marginLeft:"40px"},children:[t.jsx(o,{size:"large",onClick:()=>this.submitProductEdit(!1),children:s.t("general:Save")}),t.jsx(o,{style:{marginLeft:"20px"},type:"primary",size:"large",onClick:()=>this.submitProductEdit(!0),children:s.t("general:Save & Exit")}),this.state.mode==="add"?t.jsx(o,{style:{marginLeft:"20px"},size:"large",onClick:()=>this.deleteProduct(),children:s.t("general:Cancel")}):null]})]})}}export{U as default};
