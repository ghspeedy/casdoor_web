var f=Object.defineProperty;var h=(o,s,e)=>s in o?f(o,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[s]=e;var c=(o,s,e)=>(h(o,typeof s!="symbol"?s+"":s,e),e);import{g as p,S as g,C as b,a as v,s as d,i,d as w,b as y,j as l,L as R,c as x,e as S,B as m,f as P,h as k}from"./index-f0baa7a0.js";import{h as z}from"./moment-fbc5633a.js";import{B as A}from"./BaseListPage-041c389a.js";import{P as C}from"./PopconfirmModal-8710d8ae.js";import{S as T}from"./index-821d4c24.js";import{T as I}from"./Table-f650b5e6.js";import"./index-9d454b6e.js";class L extends A{constructor(){super(...arguments);c(this,"fetch",(e={})=>{let a=e.searchedColumn,u=e.searchText;const t=e.sortField,r=e.sortOrder;e.passwordType!==void 0&&e.passwordType!==null&&(a="passwordType",u=e.passwordType),this.setState({loading:!0}),P("admin",e.pagination.current,e.pagination.pageSize,a,u,t,r).then(n=>{n.status==="ok"?this.setState({loading:!1,data:n.data,pagination:{...e.pagination,total:n.data2},searchText:e.searchText,searchedColumn:e.searchedColumn}):k(n)&&this.setState({loading:!1,isAuthorized:!1})})})}newOrganization(){const e=p();return{owner:"admin",name:`organization_${e}`,createdTime:z().format(),displayName:`New Organization - ${e}`,websiteUrl:"https://door.casdoor.com",favicon:`${g}/img/favicon.png`,passwordType:"plain",PasswordSalt:"",countryCodes:["CN"],defaultAvatar:`${g}/img/casbin.svg`,defaultApplication:"",tags:[],languages:b.map(a=>a.key),masterPassword:"",enableSoftDeletion:!1,isProfilePublic:!0,accountItems:[{name:"Organization",visible:!0,viewRule:"Public",modifyRule:"Admin"},{name:"ID",visible:!0,viewRule:"Public",modifyRule:"Immutable"},{name:"Name",visible:!0,viewRule:"Public",modifyRule:"Admin"},{name:"Display name",visible:!0,viewRule:"Public",modifyRule:"Self"},{name:"Avatar",visible:!0,viewRule:"Public",modifyRule:"Self"},{name:"User type",visible:!0,viewRule:"Public",modifyRule:"Admin"},{name:"Password",visible:!0,viewRule:"Self",modifyRule:"Self"},{name:"Email",visible:!0,viewRule:"Public",modifyRule:"Self"},{name:"Phone",visible:!0,viewRule:"Public",modifyRule:"Self"},{name:"Country/Region",visible:!0,viewRule:"Public",modifyRule:"Self"},{name:"Location",visible:!0,viewRule:"Public",modifyRule:"Self"},{name:"Affiliation",visible:!0,viewRule:"Public",modifyRule:"Self"},{name:"Title",visible:!0,viewRule:"Public",modifyRule:"Self"},{name:"Homepage",visible:!0,viewRule:"Public",modifyRule:"Self"},{name:"Bio",visible:!0,viewRule:"Public",modifyRule:"Self"},{name:"Tag",visible:!0,viewRule:"Public",modifyRule:"Admin"},{name:"Signup application",visible:!0,viewRule:"Public",modifyRule:"Admin"},{name:"Roles",visible:!0,viewRule:"Public",modifyRule:"Immutable"},{name:"Permissions",visible:!0,viewRule:"Public",modifyRule:"Immutable"},{name:"3rd-party logins",visible:!0,viewRule:"Self",modifyRule:"Self"},{name:"Properties",visible:!1,viewRule:"Admin",modifyRule:"Admin"},{name:"Is admin",visible:!0,viewRule:"Admin",modifyRule:"Admin"},{name:"Is globalThis admin",visible:!0,viewRule:"Admin",modifyRule:"Admin"},{name:"Is forbidden",visible:!0,viewRule:"Admin",modifyRule:"Admin"},{name:"Is deleted",visible:!0,viewRule:"Admin",modifyRule:"Admin"}]}}addOrganization(){const e=this.newOrganization();v(e).then(a=>{a.status==="ok"?(this.props.history.push({pathname:`/organizations/${e.name}`,mode:"add"}),d("success",i.t("general:Successfully added"))):d("error",`${i.t("general:Failed to add")}: ${a.msg}`)}).catch(a=>{d("error",`${i.t("general:Failed to connect to server")}: ${a}`)})}deleteOrganization(e){w(this.state.data[e]).then(a=>{a.status==="ok"?(d("success",i.t("general:Successfully deleted")),this.setState({data:y(this.state.data,e),pagination:{total:this.state.pagination.total-1}})):d("error",`${i.t("general:Failed to delete")}: ${a.msg}`)}).catch(a=>{d("error",`${i.t("general:Failed to connect to server")}: ${a}`)})}renderTable(e){const a=[{title:i.t("general:Name"),dataIndex:"name",key:"name",width:"120px",fixed:"left",sorter:!0,...this.getColumnSearchProps("name"),render:(t,r,n)=>l.jsx(R,{to:`/organizations/${t}`,children:t})},{title:i.t("general:Created time"),dataIndex:"createdTime",key:"createdTime",width:"160px",sorter:!0,render:(t,r,n)=>x(t)},{title:i.t("general:Display name"),dataIndex:"displayName",key:"displayName",sorter:!0,...this.getColumnSearchProps("displayName")},{title:i.t("general:Favicon"),dataIndex:"favicon",key:"favicon",width:"50px",render:(t,r,n)=>l.jsx("a",{target:"_blank",rel:"noreferrer",href:t,children:l.jsx("img",{src:t,alt:t,width:40})})},{title:i.t("organization:Website URL"),dataIndex:"websiteUrl",key:"websiteUrl",width:"300px",sorter:!0,...this.getColumnSearchProps("websiteUrl"),render:(t,r,n)=>l.jsx("a",{target:"_blank",rel:"noreferrer",href:t,children:t})},{title:i.t("general:Password type"),dataIndex:"passwordType",key:"passwordType",width:"150px",sorter:!0,filterMultiple:!1,filters:[{text:"plain",value:"plain"},{text:"salt",value:"salt"},{text:"md5-salt",value:"md5-salt"}]},{title:i.t("general:Password salt"),dataIndex:"passwordSalt",key:"passwordSalt",width:"150px",sorter:!0,...this.getColumnSearchProps("passwordSalt")},{title:i.t("general:Default avatar"),dataIndex:"defaultAvatar",key:"defaultAvatar",width:"120px",render:(t,r,n)=>l.jsx("a",{target:"_blank",rel:"noreferrer",href:t,children:l.jsx("img",{src:t,alt:t,width:40})})},{title:i.t("organization:Soft deletion"),dataIndex:"enableSoftDeletion",key:"enableSoftDeletion",width:"140px",sorter:!0,render:(t,r,n)=>l.jsx(T,{disabled:!0,checkedChildren:"ON",unCheckedChildren:"OFF",checked:t})},{title:i.t("general:Action"),dataIndex:"",key:"op",width:"240px",fixed:S()?"false":"right",render:(t,r,n)=>l.jsxs("div",{children:[l.jsx(m,{style:{marginTop:"10px",marginBottom:"10px",marginRight:"10px"},type:"primary",onClick:()=>this.props.history.push(`/organizations/${r.name}/users`),children:i.t("general:Users")}),l.jsx(m,{style:{marginTop:"10px",marginBottom:"10px",marginRight:"10px"},onClick:()=>this.props.history.push(`/organizations/${r.name}`),children:i.t("general:Edit")}),l.jsx(C,{title:i.t("general:Sure to delete")+`: ${r.name} ?`,onConfirm:()=>this.deleteOrganization(n),disabled:r.name==="built-in"})]})}],u={total:this.state.pagination.total,showQuickJumper:!0,showSizeChanger:!0,showTotal:()=>i.t("general:{total} in total").replace("{total}",this.state.pagination.total)};return l.jsx("div",{children:l.jsx(I,{scroll:{x:"max-content"},columns:a,dataSource:e,rowKey:"name",size:"middle",bordered:!0,pagination:u,title:()=>l.jsxs("div",{children:[i.t("general:Organizations"),"    ",l.jsx(m,{type:"primary",size:"small",onClick:this.addOrganization.bind(this),children:i.t("general:Add")})]}),loading:this.state.loading,onChange:this.handleTableChange})})}}export{L as default};
