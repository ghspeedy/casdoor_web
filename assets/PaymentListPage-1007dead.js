var u=Object.defineProperty;var g=(d,s,e)=>s in d?u(d,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[s]=e;var h=(d,s,e)=>(g(d,typeof s!="symbol"?s+"":s,e),e);import{g as y,s as l,i as t,b as x,j as o,L as m,c as P,$ as f,a0 as k,e as w,B as c,h as C}from"./index-f0baa7a0.js";import{h as S}from"./moment-fbc5633a.js";import{a as $,d as v,g as T}from"./PaymentBackend-698104d6.js";import{B as j}from"./BaseListPage-041c389a.js";import{P as z}from"./PopconfirmModal-8710d8ae.js";import{T as I}from"./Table-f650b5e6.js";import"./index-9d454b6e.js";class A extends j{constructor(){super(...arguments);h(this,"fetch",(e={})=>{let r=e.searchedColumn,p=e.searchText;const a=e.sortField,n=e.sortOrder;e.type!==void 0&&e.type!==null&&(r="type",p=e.type),this.setState({loading:!0}),T("",e.pagination.current,e.pagination.pageSize,r,p,a,n).then(i=>{i.status==="ok"?this.setState({loading:!1,data:i.data,pagination:{...e.pagination,total:i.data2},searchText:e.searchText,searchedColumn:e.searchedColumn}):C(i)&&this.setState({loading:!1,isAuthorized:!1})})})}newPayment(){const e=y();return{owner:"admin",name:`payment_${e}`,createdTime:S().format(),displayName:`New Payment - ${e}`,provider:"provider_pay_paypal",type:"PayPal",organization:"built-in",user:"admin",productName:"computer-1",productDisplayName:"A notebook computer",detail:"This is a computer with excellent CPU, memory and disk",tag:"Promotion-1",currency:"USD",price:300,payUrl:"https://pay.com/pay.php",returnUrl:"https://door.casdoor.com/payments",state:"Paid",message:""}}addPayment(){const e=this.newPayment();$(e).then(r=>{r.status==="ok"?(this.props.history.push({pathname:`/payments/${e.name}`,mode:"add"}),l("success",t.t("general:Successfully added"))):l("error",`${t.t("general:Failed to add")}: ${r.msg}`)}).catch(r=>{l("error",`${t.t("general:Failed to connect to server")}: ${r}`)})}deletePayment(e){v(this.state.data[e]).then(r=>{r.status==="ok"?(l("success",t.t("general:Successfully deleted")),this.setState({data:x(this.state.data,e),pagination:{total:this.state.pagination.total-1}})):l("error",`${t.t("general:Failed to delete")}: ${r.msg}`)}).catch(r=>{l("error",`${t.t("general:Failed to connect to server")}: ${r}`)})}renderTable(e){const r=[{title:t.t("general:Name"),dataIndex:"name",key:"name",width:"180px",fixed:"left",sorter:!0,...this.getColumnSearchProps("name"),render:(a,n,i)=>o.jsx(m,{to:`/payments/${a}`,children:a})},{title:t.t("general:Provider"),dataIndex:"provider",key:"provider",width:"150px",fixed:"left",sorter:!0,...this.getColumnSearchProps("provider"),render:(a,n,i)=>o.jsx(m,{to:`/providers/${a}`,children:a})},{title:t.t("general:Organization"),dataIndex:"organization",key:"organization",width:"120px",sorter:!0,...this.getColumnSearchProps("organization"),render:(a,n,i)=>o.jsx(m,{to:`/organizations/${a}`,children:a})},{title:t.t("general:User"),dataIndex:"user",key:"user",width:"120px",sorter:!0,...this.getColumnSearchProps("user"),render:(a,n,i)=>o.jsx(m,{to:`/users/${n.organization}/${a}`,children:a})},{title:t.t("general:Created time"),dataIndex:"createdTime",key:"createdTime",width:"160px",sorter:!0,render:(a,n,i)=>P(a)},{title:t.t("provider:Type"),dataIndex:"type",key:"type",width:"140px",align:"center",filterMultiple:!1,filters:f("Payment").map(a=>({text:a.id,value:a.name})),sorter:!0,render:(a,n,i)=>(n.category="Payment",k(n))},{title:t.t("payment:Product"),dataIndex:"productDisplayName",key:"productDisplayName",sorter:!0,...this.getColumnSearchProps("productDisplayName")},{title:t.t("product:Price"),dataIndex:"price",key:"price",width:"120px",sorter:!0,...this.getColumnSearchProps("price")},{title:t.t("payment:Currency"),dataIndex:"currency",key:"currency",width:"120px",sorter:!0,...this.getColumnSearchProps("currency")},{title:t.t("general:State"),dataIndex:"state",key:"state",width:"120px",sorter:!0,...this.getColumnSearchProps("state")},{title:t.t("general:Action"),dataIndex:"",key:"op",width:"240px",fixed:w()?"false":"right",render:(a,n,i)=>o.jsxs("div",{children:[o.jsx(c,{style:{marginTop:"10px",marginBottom:"10px",marginRight:"10px"},onClick:()=>this.props.history.push(`/payments/${n.name}/result`),children:t.t("payment:Result")}),o.jsx(c,{style:{marginTop:"10px",marginBottom:"10px",marginRight:"10px"},type:"primary",onClick:()=>this.props.history.push(`/payments/${n.name}`),children:t.t("general:Edit")}),o.jsx(z,{title:t.t("general:Sure to delete")+`: ${n.name} ?`,onConfirm:()=>this.deletePayment(i)})]})}],p={total:this.state.pagination.total,showQuickJumper:!0,showSizeChanger:!0,showTotal:()=>t.t("general:{total} in total").replace("{total}",this.state.pagination.total)};return o.jsx("div",{children:o.jsx(I,{scroll:{x:"max-content"},columns:r,dataSource:e,rowKey:"name",size:"middle",bordered:!0,pagination:p,title:()=>o.jsxs("div",{children:[t.t("general:Payments"),"    ",o.jsx(c,{type:"primary",size:"small",onClick:this.addPayment.bind(this),children:t.t("general:Add")})]}),loading:this.state.loading,onChange:this.handleTableChange})})}}export{A as default};
