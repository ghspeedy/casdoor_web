import{R as c,f as x,Q as u,j as t,v as j,i as a,B as h,e as l,m as o,n as i,w as r,q as m,x as p,I as g,E as y,s as d,W as R}from"./index-f0baa7a0.js";import{b as v,g as T,u as f,d as S}from"./RoleBackend-84821322.js";import{S as w}from"./index-821d4c24.js";class z extends c.Component{constructor(s){super(s),this.state={classes:s,organizationName:s.organizationName!==void 0?s.organizationName:s.match.params.organizationName,roleName:s.match.params.roleName,role:null,organizations:[],users:[],roles:[],mode:s.location.mode!==void 0?s.location.mode:"edit"}}UNSAFE_componentWillMount(){this.getRole(),this.getOrganizations()}getRole(){v(this.state.organizationName,this.state.roleName).then(s=>{this.setState({role:s}),this.getUsers(s.owner),this.getRoles(s.owner)})}getOrganizations(){x("admin").then(s=>{this.setState({organizations:s.msg===void 0?s:[]})})}getUsers(s){u(s).then(e=>{this.setState({users:e})})}getRoles(s){T(s).then(e=>{this.setState({roles:e})})}parseRoleField(s,e){return[""].includes(s)&&(e=R(e)),e}updateRoleField(s,e){e=this.parseRoleField(s,e);const n=this.state.role;n[s]=e,this.setState({role:n})}renderRole(){var s;return t.jsxs(j,{size:"small",title:t.jsxs("div",{children:[this.state.mode==="add"?a.t("role:New Role"):a.t("role:Edit Role"),"    ",t.jsx(h,{onClick:()=>this.submitRoleEdit(!1),children:a.t("general:Save")}),t.jsx(h,{style:{marginLeft:"20px"},type:"primary",onClick:()=>this.submitRoleEdit(!0),children:a.t("general:Save & Exit")}),this.state.mode==="add"?t.jsx(h,{style:{marginLeft:"20px"},onClick:()=>this.deleteRole(),children:a.t("general:Cancel")}):null]}),style:l()?{margin:"5px"}:{},type:"inner",children:[t.jsxs(o,{style:{marginTop:"10px"},children:[t.jsxs(i,{style:{marginTop:"5px"},span:l()?22:2,children:[r(a.t("general:Organization"),a.t("general:Organization - Tooltip"))," :"]}),t.jsx(i,{span:22,children:t.jsx(m,{virtual:!1,style:{width:"100%"},value:this.state.role.owner,onChange:e=>{this.updateRoleField("owner",e)},options:this.state.organizations.map(e=>p(e.name,e.name))})})]}),t.jsxs(o,{style:{marginTop:"20px"},children:[t.jsxs(i,{style:{marginTop:"5px"},span:l()?22:2,children:[r(a.t("general:Name"),a.t("general:Name - Tooltip"))," :"]}),t.jsx(i,{span:22,children:t.jsx(g,{value:this.state.role.name,onChange:e=>{this.updateRoleField("name",e.target.value)}})})]}),t.jsxs(o,{style:{marginTop:"20px"},children:[t.jsxs(i,{style:{marginTop:"5px"},span:l()?22:2,children:[r(a.t("general:Display name"),a.t("general:Display name - Tooltip"))," :"]}),t.jsx(i,{span:22,children:t.jsx(g,{value:this.state.role.displayName,onChange:e=>{this.updateRoleField("displayName",e.target.value)}})})]}),t.jsxs(o,{style:{marginTop:"20px"},children:[t.jsxs(i,{style:{marginTop:"5px"},span:l()?22:2,children:[r(a.t("role:Sub users"),a.t("role:Sub users - Tooltip"))," :"]}),t.jsx(i,{span:22,children:t.jsx(m,{mode:"tags",style:{width:"100%"},value:this.state.role.users,onChange:e=>{this.updateRoleField("users",e)},options:this.state.users.map(e=>p(`${e.owner}/${e.name}`,`${e.owner}/${e.name}`))})})]}),t.jsxs(o,{style:{marginTop:"20px"},children:[t.jsxs(i,{style:{marginTop:"5px"},span:l()?22:2,children:[r(a.t("role:Sub roles"),a.t("role:Sub roles - Tooltip"))," :"]}),t.jsx(i,{span:22,children:t.jsx(m,{virtual:!1,mode:"tags",style:{width:"100%"},value:this.state.role.roles,onChange:e=>{this.updateRoleField("roles",e)},options:this.state.roles.filter(e=>e.owner!==this.state.role.owner||e.name!==this.state.role.name).map(e=>p(`${e.owner}/${e.name}`,`${e.owner}/${e.name}`))})})]}),t.jsxs(o,{style:{marginTop:"20px"},children:[t.jsxs(i,{style:{marginTop:"5px"},span:l()?22:2,children:[r(a.t("role:Sub domains"),a.t("role:Sub domains - Tooltip"))," :"]}),t.jsx(i,{span:22,children:t.jsx(m,{virtual:!1,mode:"tags",style:{width:"100%"},value:this.state.role.domains,onChange:e=>{this.updateRoleField("domains",e)},options:(s=this.state.role.domains)==null?void 0:s.map(e=>p(e,e))})})]}),t.jsxs(o,{style:{marginTop:"20px"},children:[t.jsxs(i,{style:{marginTop:"5px"},span:l()?19:2,children:[r(a.t("general:Is enabled"),a.t("general:Is enabled - Tooltip"))," :"]}),t.jsx(i,{span:1,children:t.jsx(w,{checked:this.state.role.isEnabled,onChange:e=>{this.updateRoleField("isEnabled",e)}})})]})]})}submitRoleEdit(s){const e=y(this.state.role);f(this.state.organizationName,this.state.roleName,e).then(n=>{n.status==="ok"?(d("success",a.t("general:Successfully saved")),this.setState({roleName:this.state.role.name}),s?this.props.history.push("/roles"):this.props.history.push(`/roles/${this.state.role.owner}/${this.state.role.name}`)):(d("error",`${a.t("general:Failed to save")}: ${n.msg}`),this.updateRoleField("name",this.state.roleName))}).catch(n=>{d("error",`${a.t("general:Failed to connect to server")}: ${n}`)})}deleteRole(){S(this.state.role).then(s=>{s.status==="ok"?this.props.history.push("/roles"):d("error",`${a.t("general:Failed to delete")}: ${s.msg}`)}).catch(s=>{d("error",`${a.t("general:Failed to connect to server")}: ${s}`)})}render(){return t.jsxs("div",{children:[this.state.role!==null?this.renderRole():null,t.jsxs("div",{style:{marginTop:"20px",marginLeft:"40px"},children:[t.jsx(h,{size:"large",onClick:()=>this.submitRoleEdit(!1),children:a.t("general:Save")}),t.jsx(h,{style:{marginLeft:"20px"},type:"primary",size:"large",onClick:()=>this.submitRoleEdit(!0),children:a.t("general:Save & Exit")}),this.state.mode==="add"?t.jsx(h,{style:{marginLeft:"20px"},size:"large",onClick:()=>this.deleteRole(),children:a.t("general:Cancel")}):null]})]})}}export{z as default};
