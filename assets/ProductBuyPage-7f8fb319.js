import{ag as h,ah as m,ai as l,R as y,i as r,l as o,s as c,j as t,co as x,X as p,B as P,cp as f,cn as j,cq as d}from"./index-f0baa7a0.js";import{b as C,c as b}from"./ProductBackend-ca9984e6.js";import{D as n}from"./index-3a9f1bfc.js";var S={icon:function(e,s){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z",fill:e}},{tag:"path",attrs:{d:"M512 140c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm193.4 225.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.3 0 19.9 5 25.9 13.3l71.2 98.8 157.2-218c6-8.4 15.7-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.4 12.7z",fill:s}},{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z",fill:e}}]}},name:"check-circle",theme:"twotone"};const T=S;var u=function(e,s){return h.createElement(m,l(l({},e),{},{ref:s,icon:T}))};u.displayName="CheckCircleTwoTone";const v=h.forwardRef(u);class z extends y.Component{constructor(e){var s;super(e),this.state={classes:e,productName:(s=e.match)==null?void 0:s.params.productName,product:null,isPlacingOrder:!1,qrCodeModalProvider:null}}UNSAFE_componentWillMount(){this.getProduct()}getProduct(){this.state.productName!==void 0&&C("admin",this.state.productName).then(e=>{this.setState({product:e})})}getProductObj(){return this.props.product!==void 0?this.props.product:this.state.product}getCurrencySymbol(e){return(e==null?void 0:e.currency)==="USD"?"$":(e==null?void 0:e.currency)==="CNY"?"￥":"(Unknown currency)"}getCurrencyText(e){return(e==null?void 0:e.currency)==="USD"?r.t("product:USD"):(e==null?void 0:e.currency)==="CNY"?r.t("product:CNY"):"(Unknown currency)"}getPrice(e){return`${this.getCurrencySymbol(e)}${e==null?void 0:e.price} (${this.getCurrencyText(e)})`}buyProduct(e,s){if(s.clientId.startsWith("http")){this.setState({qrCodeModalProvider:s});return}this.setState({isPlacingOrder:!0}),b(this.state.product.owner,this.state.productName,s.name).then(a=>{if(a.status==="ok"){const g=a.data;o(g)}else c("error",`${r.t("general:Failed to save")}: ${a.msg}`),this.setState({isPlacingOrder:!1})}).catch(a=>{c("error",`${r.t("general:Failed to connect to server")}: ${a}`)})}renderQrCodeModal(){var e,s,a;return this.state.qrCodeModalProvider===void 0||this.state.qrCodeModalProvider===null?null:t.jsx(x,{title:t.jsxs("div",{children:[t.jsx(v,{twoToneColor:"rgb(45,120,213)"})," "+r.t("product:Please scan the QR code to pay")]}),open:this.state.qrCodeModalProvider!==void 0&&this.state.qrCodeModalProvider!==null,onOk:()=>{o(this.state.product.returnUrl)},onCancel:()=>{this.setState({qrCodeModalProvider:null})},okText:r.t("product:I have completed the payment"),cancelText:r.t("general:Cancel"),children:t.jsxs("p",{children:[r.t("product:Please provide your username in the remark"),":  ",p("default",this.props.account.name),t.jsx("br",{}),t.jsx("br",{}),t.jsx("img",{src:(e=this.state.qrCodeModalProvider)==null?void 0:e.clientId,alt:(s=this.state.qrCodeModalProvider)==null?void 0:s.name,width:"472px",style:{marginBottom:"20px"}})]},(a=this.state.qrCodeModalProvider)==null?void 0:a.name)})}getPayButton(e){let s=e.type;return e.type==="Alipay"?s=r.t("product:Alipay"):e.type==="WeChat Pay"?s=r.t("product:WeChat Pay"):e.type==="PayPal"&&(s=r.t("product:PayPal")),t.jsx(P,{style:{height:"50px",borderWidth:"2px"},shape:"round",icon:t.jsx("img",{style:{marginRight:"10px"},width:36,height:36,src:f(e),alt:e.displayName}),size:"large",children:s})}renderProviderButton(e,s){return t.jsx("span",{style:{width:"200px",marginRight:"20px",marginBottom:"10px"},children:t.jsx("span",{style:{width:"200px",cursor:"pointer"},onClick:()=>this.buyProduct(s,e),children:this.getPayButton(e)})},e.name)}renderPay(e){return e==null?null:e.state!=="Published"?r.t("product:This product is currently not in sale."):e.providerObjs.length===0?r.t("product:There is no payment channel for this product."):e.providerObjs.map(s=>this.renderProviderButton(s,e))}render(){const e=this.getProductObj();return e===null?null:t.jsxs("div",{children:[t.jsx(j,{spinning:this.state.isPlacingOrder,size:"large",tip:r.t("product:Placing order..."),style:{paddingTop:"10%"},children:t.jsxs(n,{title:r.t("product:Buy Product"),bordered:!0,children:[t.jsx(n.Item,{label:r.t("general:Name"),span:3,children:t.jsx("span",{style:{fontSize:28},children:d(e==null?void 0:e.displayName)})}),t.jsx(n.Item,{label:r.t("product:Detail"),children:t.jsx("span",{style:{fontSize:16},children:d(e==null?void 0:e.detail)})}),t.jsx(n.Item,{label:r.t("user:Tag"),children:t.jsx("span",{style:{fontSize:16},children:e==null?void 0:e.tag})}),t.jsx(n.Item,{label:r.t("product:SKU"),children:t.jsx("span",{style:{fontSize:16},children:e==null?void 0:e.name})}),t.jsx(n.Item,{label:r.t("product:Image"),span:3,children:t.jsx("img",{src:e==null?void 0:e.image,alt:e==null?void 0:e.name,height:90,style:{marginBottom:"20px"}})}),t.jsx(n.Item,{label:r.t("product:Price"),children:t.jsx("span",{style:{fontSize:28,color:"red",fontWeight:"bold"},children:this.getPrice(e)})}),t.jsx(n.Item,{label:r.t("product:Quantity"),children:t.jsx("span",{style:{fontSize:16},children:e==null?void 0:e.quantity})}),t.jsx(n.Item,{label:r.t("product:Sold"),children:t.jsx("span",{style:{fontSize:16},children:e==null?void 0:e.sold})}),t.jsx(n.Item,{label:r.t("product:Pay"),span:3,children:this.renderPay(e)})]})}),this.renderQrCodeModal()]})}}export{z as default};
