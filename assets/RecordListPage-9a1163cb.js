var c=Object.defineProperty;var x=(o,a,e)=>a in o?c(o,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[a]=e;var u=(o,a,e)=>(x(o,typeof a!="symbol"?a+"":a,e),e);import{U as p,_ as m,i,j as d,c as f,L as h,e as g,Y as T}from"./index-f0baa7a0.js";import{h as C}from"./moment-fbc5633a.js";import{B as S}from"./BaseListPage-041c389a.js";import{S as k}from"./index-821d4c24.js";import{T as I}from"./Table-f650b5e6.js";function P(o,a,e="",s="",l="",t=""){return fetch(`${p}/api/get-records?pageSize=${a}&p=${o}&field=${e}&value=${s}&sortField=${l}&sortOrder=${t}`,{method:"GET",credentials:"include",headers:{"Accept-Language":m()}}).then(r=>r.json())}class A extends S{constructor(){super(...arguments);u(this,"fetch",(e={})=>{let s=e.searchedColumn,l=e.searchText;const t=e.sortField,r=e.sortOrder;e.method!==void 0&&e.method!==null&&(s="method",l=e.method),this.setState({loading:!0}),P(e.pagination.current,e.pagination.pageSize,s,l,t,r).then(n=>{n.status==="ok"?this.setState({loading:!1,data:n.data,pagination:{...e.pagination,total:n.data2},searchText:e.searchText,searchedColumn:e.searchedColumn}):n.data.includes("Please login first")&&this.setState({loading:!1,isAuthorized:!1})})})}UNSAFE_componentWillMount(){this.state.pagination.pageSize=20;const{pagination:e}=this.state;this.fetch({pagination:e})}newRecord(){return{owner:"built-in",name:"1234",id:"1234",clientIp:"::1",timestamp:C().format(),organization:"built-in",username:"admin",requestUri:"/api/get-account",action:"login",isTriggered:!1}}renderTable(e){let s=[{title:i.t("general:Name"),dataIndex:"name",key:"name",width:"320px",sorter:!0,...this.getColumnSearchProps("name")},{title:i.t("general:ID"),dataIndex:"id",key:"id",width:"90px",sorter:!0,...this.getColumnSearchProps("id")},{title:i.t("general:Client IP"),dataIndex:"clientIp",key:"clientIp",width:"150px",sorter:!0,...this.getColumnSearchProps("clientIp"),render:(t,r,n)=>d.jsx("a",{target:"_blank",rel:"noreferrer",href:`https://db-ip.com/${t}`,children:t})},{title:i.t("general:Timestamp"),dataIndex:"createdTime",key:"createdTime",width:"180px",sorter:!0,render:(t,r,n)=>f(t)},{title:i.t("general:Organization"),dataIndex:"organization",key:"organization",width:"110px",sorter:!0,...this.getColumnSearchProps("organization"),render:(t,r,n)=>d.jsx(h,{to:`/organizations/${t}`,children:t})},{title:i.t("general:User"),dataIndex:"user",key:"user",width:"120px",sorter:!0,...this.getColumnSearchProps("user"),render:(t,r,n)=>d.jsx(h,{to:`/users/${r.organization}/${r.user}`,children:t})},{title:i.t("general:Method"),dataIndex:"method",key:"method",width:"110px",sorter:!0,filterMultiple:!1,filters:[{text:"GET",value:"GET"},{text:"HEAD",value:"HEAD"},{text:"POST",value:"POST"},{text:"PUT",value:"PUT"},{text:"DELETE",value:"DELETE"},{text:"CONNECT",value:"CONNECT"},{text:"OPTIONS",value:"OPTIONS"},{text:"TRACE",value:"TRACE"},{text:"PATCH",value:"PATCH"}]},{title:i.t("general:Request URI"),dataIndex:"requestUri",key:"requestUri",sorter:!0,...this.getColumnSearchProps("requestUri")},{title:i.t("general:Action"),dataIndex:"action",key:"action",width:"200px",sorter:!0,...this.getColumnSearchProps("action"),fixed:g()?"false":"right",render:(t,r,n)=>t},{title:i.t("record:Is triggered"),dataIndex:"isTriggered",key:"isTriggered",width:"140px",sorter:!0,fixed:g()?"false":"right",render:(t,r,n)=>["signup","login","logout","update-user"].includes(r.action)?d.jsx(k,{disabled:!0,checkedChildren:"ON",unCheckedChildren:"OFF",checked:t}):null}];T(this.props.account)&&(s=s.filter(t=>t.key!=="name"&&t.key!=="organization"));const l={total:this.state.pagination.total,pageSize:this.state.pagination.pageSize,showQuickJumper:!0,showSizeChanger:!0,showTotal:()=>i.t("general:{total} in total").replace("{total}",this.state.pagination.total)};return d.jsx("div",{children:d.jsx(I,{scroll:{x:"max-content"},columns:s,dataSource:e,rowKey:"id",size:"middle",bordered:!0,pagination:l,title:()=>d.jsxs("div",{children:[i.t("general:Records"),"    "]}),loading:this.state.loading,onChange:this.handleTableChange})})}}export{A as default};
