var y=Object.defineProperty;var g=(l,o,e)=>o in l?y(l,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[o]=e;var p=(l,o,e)=>(g(l,typeof o!="symbol"?o+"":o,e),e);import{g as m,s as d,i as t,b as x,j as n,L as u,c as S,e as f,B as h,h as b}from"./index-ba7d0766.js";import{h as w}from"./moment-fbc5633a.js";import{a as k,d as C,r as T,g as I}from"./SyncerBackend-10a45745.js";import{B as v}from"./BaseListPage-79bcb834.js";import{P}from"./PopconfirmModal-2c22ff01.js";import{S as $}from"./index-ae4cddc7.js";import{T as j}from"./Table-c2bde13f.js";import"./index-2f07707f.js";class O extends v{constructor(){super(...arguments);p(this,"fetch",(e={})=>{let a=e.searchedColumn,c=e.searchText;const r=e.sortField,i=e.sortOrder;e.type!==void 0&&e.type!==null&&(a="type",c=e.type),this.setState({loading:!0}),I("admin",e.pagination.current,e.pagination.pageSize,a,c,r,i).then(s=>{s.status==="ok"?this.setState({loading:!1,data:s.data,pagination:{...e.pagination,total:s.data2},searchText:e.searchText,searchedColumn:e.searchedColumn}):b(s)&&this.setState({loading:!1,isAuthorized:!1})})})}newSyncer(){return{owner:"admin",name:`syncer_${m()}`,createdTime:w().format(),organization:"built-in",type:"Database",host:"localhost",port:3306,user:"root",password:"123456",databaseType:"mysql",database:"dbName",table:"tableName",tableColumns:[],affiliationTable:"",avatarBaseUrl:"",syncInterval:10,isEnabled:!1}}addSyncer(){const e=this.newSyncer();k(e).then(a=>{a.status==="ok"?(this.props.history.push({pathname:`/syncers/${e.name}`,mode:"add"}),d("success",t.t("general:Successfully added"))):d("error",`${t.t("general:Failed to add")}: ${a.msg}`)}).catch(a=>{d("error",`${t.t("general:Failed to connect to server")}: ${a}`)})}deleteSyncer(e){C(this.state.data[e]).then(a=>{a.status==="ok"?(d("success",t.t("general:Successfully deleted")),this.setState({data:x(this.state.data,e),pagination:{total:this.state.pagination.total-1}})):d("error",`${t.t("general:Failed to delete")}: ${a.msg}`)}).catch(a=>{d("error",`${t.t("general:Failed to connect to server")}: ${a}`)})}runSyncer(e){this.setState({loading:!0}),T("admin",this.state.data[e].name).then(a=>{this.setState({loading:!1}),d("success","Syncer sync users successfully")}).catch(a=>{this.setState({loading:!1}),d("error",`Syncer failed to sync users: ${a}`)})}renderTable(e){const a=[{title:t.t("general:Name"),dataIndex:"name",key:"name",width:"150px",fixed:"left",sorter:!0,...this.getColumnSearchProps("name"),render:(r,i,s)=>n.jsx(u,{to:`/syncers/${r}`,children:r})},{title:t.t("general:Organization"),dataIndex:"organization",key:"organization",width:"120px",sorter:!0,...this.getColumnSearchProps("organization"),render:(r,i,s)=>n.jsx(u,{to:`/organizations/${r}`,children:r})},{title:t.t("general:Created time"),dataIndex:"createdTime",key:"createdTime",width:"160px",sorter:!0,render:(r,i,s)=>S(r)},{title:t.t("provider:Type"),dataIndex:"type",key:"type",width:"100px",sorter:!0,filterMultiple:!1,filters:[{text:"Database",value:"Database"},{text:"LDAP",value:"LDAP"}]},{title:t.t("provider:Host"),dataIndex:"host",key:"host",width:"120px",sorter:!0,...this.getColumnSearchProps("host")},{title:t.t("provider:Port"),dataIndex:"port",key:"port",width:"100px",sorter:!0,...this.getColumnSearchProps("port")},{title:t.t("general:User"),dataIndex:"user",key:"user",width:"120px",sorter:!0,...this.getColumnSearchProps("user")},{title:t.t("general:Password"),dataIndex:"password",key:"password",width:"120px",sorter:!0,...this.getColumnSearchProps("password")},{title:t.t("syncer:Database type"),dataIndex:"databaseType",key:"databaseType",width:"120px",sorter:(r,i)=>r.databaseType.localeCompare(i.databaseType)},{title:t.t("syncer:Database"),dataIndex:"database",key:"database",width:"120px",sorter:!0},{title:t.t("syncer:Table"),dataIndex:"table",key:"table",width:"120px",sorter:!0},{title:t.t("syncer:Sync interval"),dataIndex:"syncInterval",key:"syncInterval",width:"130px",sorter:!0,...this.getColumnSearchProps("syncInterval")},{title:t.t("general:Is enabled"),dataIndex:"isEnabled",key:"isEnabled",width:"120px",sorter:!0,render:(r,i,s)=>n.jsx($,{disabled:!0,checkedChildren:"ON",unCheckedChildren:"OFF",checked:r})},{title:t.t("general:Action"),dataIndex:"",key:"op",width:"240px",fixed:f()?"false":"right",render:(r,i,s)=>n.jsxs("div",{children:[n.jsx(h,{style:{marginTop:"10px",marginBottom:"10px",marginRight:"10px"},type:"primary",onClick:()=>this.runSyncer(s),children:t.t("general:Sync")}),n.jsx(h,{style:{marginTop:"10px",marginBottom:"10px",marginRight:"10px"},onClick:()=>this.props.history.push(`/syncers/${i.name}`),children:t.t("general:Edit")}),n.jsx(P,{title:t.t("general:Sure to delete")+`: ${i.name} ?`,onConfirm:()=>this.deleteSyncer(s)})]})}],c={total:this.state.pagination.total,showQuickJumper:!0,showSizeChanger:!0,showTotal:()=>t.t("general:{total} in total").replace("{total}",this.state.pagination.total)};return n.jsx("div",{children:n.jsx(j,{scroll:{x:"max-content"},columns:a,dataSource:e,rowKey:"name",size:"middle",bordered:!0,pagination:c,title:()=>n.jsxs("div",{children:[t.t("general:Syncers"),"    ",n.jsx(h,{type:"primary",size:"small",onClick:this.addSyncer.bind(this),children:t.t("general:Add")})]}),loading:this.state.loading,onChange:this.handleTableChange})})}}export{O as default};
