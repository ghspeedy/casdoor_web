var m=Object.defineProperty;var x=(d,s,e)=>s in d?m(d,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[s]=e;var c=(d,s,e)=>(x(d,typeof s!="symbol"?s+"":s,e),e);import{g as k,s as l,i as t,b,j as n,L as u,c as f,a1 as w,V as y,e as C,B as g,h as T}from"./index-f0baa7a0.js";import{h as S}from"./moment-fbc5633a.js";import{a as j,d as v,g as $}from"./WebhookBackend-2eef6585.js";import{B as I}from"./BaseListPage-041c389a.js";import{P as W}from"./PopconfirmModal-8710d8ae.js";import{S as p}from"./index-821d4c24.js";import{T as z}from"./Table-f650b5e6.js";import"./index-9d454b6e.js";class A extends I{constructor(){super(...arguments);c(this,"fetch",(e={})=>{let r=e.searchedColumn,h=e.searchText;const o=e.sortField,i=e.sortOrder;e.contentType!==void 0&&e.contentType!==null&&(r="contentType",h=e.contentType),this.setState({loading:!0}),$("admin",e.pagination.current,e.pagination.pageSize,r,h,o,i).then(a=>{a.status==="ok"?this.setState({loading:!1,data:a.data,pagination:{...e.pagination,total:a.data2},searchText:e.searchText,searchedColumn:e.searchedColumn}):T(a)&&this.setState({loading:!1,isAuthorized:!1})})})}newWebhook(){return{owner:"admin",name:`webhook_${k()}`,createdTime:S().format(),organization:"built-in",url:"https://example.com/callback",method:"POST",contentType:"application/json",headers:[],events:["signup","login","logout","update-user"],isEnabled:!0}}addWebhook(){const e=this.newWebhook();j(e).then(r=>{r.status==="ok"?(this.props.history.push({pathname:`/webhooks/${e.name}`,mode:"add"}),l("success",t.t("general:Successfully added"))):l("error",`${t.t("general:Failed to add")}: ${r.msg}`)}).catch(r=>{l("error",`${t.t("general:Failed to connect to server")}: ${r}`)})}deleteWebhook(e){v(this.state.data[e]).then(r=>{r.status==="ok"?(l("success",t.t("general:Successfully deleted")),this.setState({data:b(this.state.data,e),pagination:{total:this.state.pagination.total-1}})):l("error",`${t.t("general:Failed to delete")}: ${r.msg}`)}).catch(r=>{l("error",`${t.t("general:Failed to connect to server")}: ${r}`)})}renderTable(e){const r=[{title:t.t("general:Name"),dataIndex:"name",key:"name",width:"150px",fixed:"left",sorter:!0,...this.getColumnSearchProps("name"),render:(o,i,a)=>n.jsx(u,{to:`/webhooks/${o}`,children:o})},{title:t.t("general:Organization"),dataIndex:"organization",key:"organization",width:"110px",sorter:!0,...this.getColumnSearchProps("organization"),render:(o,i,a)=>n.jsx(u,{to:`/organizations/${o}`,children:o})},{title:t.t("general:Created time"),dataIndex:"createdTime",key:"createdTime",width:"180px",sorter:!0,render:(o,i,a)=>f(o)},{title:t.t("general:URL"),dataIndex:"url",key:"url",width:"300px",sorter:!0,...this.getColumnSearchProps("url"),render:(o,i,a)=>n.jsx("a",{target:"_blank",rel:"noreferrer",href:o,children:w(o)})},{title:t.t("general:Method"),dataIndex:"method",key:"method",width:"120px",sorter:!0,...this.getColumnSearchProps("method")},{title:t.t("webhook:Content type"),dataIndex:"contentType",key:"contentType",width:"200px",sorter:!0,filterMultiple:!1,filters:[{text:"application/json",value:"application/json"},{text:"application/x-www-form-urlencoded",value:"application/x-www-form-urlencoded"}]},{title:t.t("webhook:Events"),dataIndex:"events",key:"events",sorter:!0,...this.getColumnSearchProps("events"),render:(o,i,a)=>y(o)},{title:t.t("webhook:Is user extended"),dataIndex:"isUserExtended",key:"isUserExtended",width:"160px",sorter:!0,render:(o,i,a)=>n.jsx(p,{disabled:!0,checkedChildren:"ON",unCheckedChildren:"OFF",checked:o})},{title:t.t("general:Is enabled"),dataIndex:"isEnabled",key:"isEnabled",width:"120px",sorter:!0,render:(o,i,a)=>n.jsx(p,{disabled:!0,checkedChildren:"ON",unCheckedChildren:"OFF",checked:o})},{title:t.t("general:Action"),dataIndex:"",key:"op",width:"170px",fixed:C()?"false":"right",render:(o,i,a)=>n.jsxs("div",{children:[n.jsx(g,{style:{marginTop:"10px",marginBottom:"10px",marginRight:"10px"},type:"primary",onClick:()=>this.props.history.push(`/webhooks/${i.name}`),children:t.t("general:Edit")}),n.jsx(W,{title:t.t("general:Sure to delete")+`: ${i.name} ?`,onConfirm:()=>this.deleteWebhook(a)})]})}],h={total:this.state.pagination.total,showQuickJumper:!0,showSizeChanger:!0,showTotal:()=>t.t("general:{total} in total").replace("{total}",this.state.pagination.total)};return n.jsx("div",{children:n.jsx(z,{scroll:{x:"max-content"},columns:r,dataSource:e,rowKey:"name",size:"middle",bordered:!0,pagination:h,title:()=>n.jsxs("div",{children:[t.t("general:Webhooks"),"    ",n.jsx(g,{type:"primary",size:"small",onClick:this.addWebhook.bind(this),children:t.t("general:Add")})]}),loading:this.state.loading,onChange:this.handleTableChange})})}}export{A as default};
