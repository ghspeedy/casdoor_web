import{R as h,j as e,v as c,i as s,B as p,e as a,m as i,n,I as o,E as x,s as d}from"./index-ba7d0766.js";import{b as k,u as g,d as m}from"./TokenBackend-cc0f9daa.js";class y extends h.Component{constructor(t){super(t),this.state={classes:t,tokenName:t.match.params.tokenName,token:null,mode:t.location.mode!==void 0?t.location.mode:"edit"}}UNSAFE_componentWillMount(){this.getToken()}getToken(){k("admin",this.state.tokenName).then(t=>{this.setState({token:t})})}parseTokenField(t,l){return l}updateTokenField(t,l){l=this.parseTokenField(t,l);const r=this.state.token;r[t]=l,this.setState({token:r})}renderToken(){return e.jsxs(c,{size:"small",title:e.jsxs("div",{children:[this.state.mode==="add"?s.t("token:New Token"):s.t("token:Edit Token"),"    ",e.jsx(p,{onClick:()=>this.submitTokenEdit(!1),children:s.t("general:Save")}),e.jsx(p,{style:{marginLeft:"20px"},type:"primary",onClick:()=>this.submitTokenEdit(!0),children:s.t("general:Save & Exit")}),this.state.mode==="add"?e.jsx(p,{style:{marginLeft:"20px"},onClick:()=>this.deleteToken(),children:s.t("general:Cancel")}):null]}),style:a()?{margin:"5px"}:{},type:"inner",children:[e.jsxs(i,{style:{marginTop:"10px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:a()?22:2,children:[s.t("general:Name"),":"]}),e.jsx(n,{span:22,children:e.jsx(o,{value:this.state.token.name,onChange:t=>{this.updateTokenField("name",t.target.value)}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:a()?22:2,children:[s.t("general:Application"),":"]}),e.jsx(n,{span:22,children:e.jsx(o,{value:this.state.token.application,onChange:t=>{this.updateTokenField("application",t.target.value)}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:a()?22:2,children:[s.t("general:Organization"),":"]}),e.jsx(n,{span:22,children:e.jsx(o,{value:this.state.token.organization,onChange:t=>{this.updateTokenField("organization",t.target.value)}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:a()?22:2,children:[s.t("general:User"),":"]}),e.jsx(n,{span:22,children:e.jsx(o,{value:this.state.token.user,onChange:t=>{this.updateTokenField("user",t.target.value)}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:a()?22:2,children:[s.t("token:Authorization code"),":"]}),e.jsx(n,{span:22,children:e.jsx(o,{value:this.state.token.code,onChange:t=>{this.updateTokenField("code",t.target.value)}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:a()?22:2,children:[s.t("token:Access token"),":"]}),e.jsx(n,{span:22,children:e.jsx(o,{value:this.state.token.accessToken,onChange:t=>{this.updateTokenField("accessToken",t.target.value)}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:a()?22:2,children:[s.t("token:Expires in"),":"]}),e.jsx(n,{span:22,children:e.jsx(o,{value:this.state.token.expiresIn,onChange:t=>{this.updateTokenField("expiresIn",parseInt(t.target.value))}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:a()?22:2,children:[s.t("provider:Scope"),":"]}),e.jsx(n,{span:22,children:e.jsx(o,{value:this.state.token.scope,onChange:t=>{this.updateTokenField("scope",t.target.value)}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:a()?22:2,children:[s.t("token:Token type"),":"]}),e.jsx(n,{span:22,children:e.jsx(o,{value:this.state.token.tokenType,onChange:t=>{this.updateTokenField("tokenType",t.target.value)}})})]})]})}submitTokenEdit(t){const l=x(this.state.token);g(this.state.token.owner,this.state.tokenName,l).then(r=>{r.status==="ok"?(d("success",s.t("general:Successfully saved")),this.setState({tokenName:this.state.token.name}),t?this.props.history.push("/tokens"):this.props.history.push(`/tokens/${this.state.token.name}`)):(d("error",`${s.t("general:Failed to save")}: ${r.msg}`),this.updateTokenField("name",this.state.tokenName))}).catch(r=>{d("error",`${s.t("general:Failed to connect to server")}: ${r}`)})}deleteToken(){m(this.state.token).then(t=>{t.status==="ok"?this.props.history.push("/tokens"):d("error",`${s.t("general:Failed to delete")}: ${t.msg}`)}).catch(t=>{d("error",`${s.t("general:Failed to connect to server")}: ${t}`)})}render(){return e.jsxs("div",{children:[this.state.token!==null?this.renderToken():null,e.jsxs("div",{style:{marginTop:"20px",marginLeft:"40px"},children:[e.jsx(p,{size:"large",onClick:()=>this.submitTokenEdit(!1),children:s.t("general:Save")}),e.jsx(p,{style:{marginLeft:"20px"},type:"primary",size:"large",onClick:()=>this.submitTokenEdit(!0),children:s.t("general:Save & Exit")}),this.state.mode==="add"?e.jsx(p,{style:{marginLeft:"20px"},size:"large",onClick:()=>this.deleteToken(),children:s.t("general:Cancel")}):null]})]})}}export{y as default};
