import{s as d,i as r,U as k,R as v,j as e,B as h,a2 as B,a3 as H,O as S,f as V,w as s,m as o,n as i,e as n,I as p,v as W,q as m,a4 as F,$ as q,a5 as _,a6 as G,a7 as J,a8 as Q,a9 as X,aa as y,ab as I,E as Y,W as K}from"./index-f0baa7a0.js";import{c as Z,u as ee,d as te}from"./ProviderBackend-1fec7bcd.js";import{S as C}from"./index-821d4c24.js";import{I as re}from"./index-c8446531.js";import{L as P}from"./LinkOutlined-c83e38a9.js";import"./UpOutlined-7082c42f.js";function ie(c,t){b(c,t).then(a=>{a.status==="ok"?d("success",`${r.t("provider:Email sent successfully")}`):d("error",a.msg)}).catch(a=>{d("error",`${r.t("general:Failed to connect to server")}: ${a}`)})}function se(c){b(c).then(t=>{t.status==="ok"?d("success","provider:SMTP connected successfully"):d("error",t.msg)}).catch(t=>{d("error",`${r.t("general:Failed to connect to server")}: ${t}`)})}function b(c,t=""){const a={title:c.title,content:c.content,sender:c.displayName,receivers:t===""?["TestSmtpServer"]:[t],provider:c.name};return fetch(`${k}/api/send-email`,{method:"POST",credentials:"include",body:JSON.stringify(a)}).then(l=>l.json())}function ae(c,t){oe(c,t).then(a=>{a.status==="ok"?d("success",`${r.t("provider:SMS sent successfully")}`):d("error",a.msg)}).catch(a=>{d("error",`${r.t("general:Failed to connect to server")}: ${a}`)})}function oe(c,t=""){const a={content:"123456",receivers:[t]};return fetch(`${k}/api/send-sms?provider=`+c.name,{method:"POST",credentials:"include",body:JSON.stringify(a)}).then(l=>l.json())}const ne=c=>{const{owner:t,name:a,provider:l,captchaType:u,subType:j,clientId:f,clientSecret:T,clientId2:U,clientSecret2:L,providerUrl:E}=c,[w,g]=v.useState(!1),M=()=>{l.name=a,l.clientId=f,l.type=u,l.providerUrl=E,T!=="***"&&(l.clientSecret=T),g(!0)},D=()=>u!=="Default"&&(!f||!T||u==="Aliyun Captcha"&&(!j||!U||!L)),N=(O,$,z)=>{H(O,$,z).then(()=>{g(!1)})},R=()=>{g(!1)};return e.jsxs(v.Fragment,{children:[e.jsx(h,{style:{fontSize:14},type:"primary",onClick:M,disabled:D(),children:r.t("general:Preview")}),e.jsx(B,{owner:t,name:a,visible:w,onOk:N,onCancel:R,isCurrentProvider:!0})]})},{Option:x}=m,{TextArea:A}=p;class ue extends v.Component{constructor(t){super(t),this.state={classes:t,providerName:t.match.params.providerName,owner:t.organizationName!==void 0?t.organizationName:t.match.params.organizationName,provider:null,organizations:[],mode:t.location.mode!==void 0?t.location.mode:"edit"}}UNSAFE_componentWillMount(){this.getOrganizations(),this.getProvider()}getProvider(){Z(this.state.owner,this.state.providerName).then(t=>{this.setState({provider:t})})}getOrganizations(){S(this.props.account)&&V("admin").then(t=>{this.setState({organizations:t.msg===void 0?t:[]})})}parseProviderField(t,a){return["port"].includes(t)&&(a=K(a)),a}updateProviderField(t,a){a=this.parseProviderField(t,a);const l=this.state.provider;l[t]=a,this.setState({provider:l})}getClientIdLabel(t){switch(t.category){case"Email":return s(r.t("signup:Username"),r.t("signup:Username - Tooltip"));case"SMS":return t.type==="Volc Engine SMS"?s(r.t("provider:Access key"),r.t("provider:Access key - Tooltip")):t.type==="Huawei Cloud SMS"?s(r.t("provider:App key"),r.t("provider:App key - Tooltip")):s(r.t("provider:Client ID"),r.t("provider:Client ID - Tooltip"));case"Captcha":return t.type==="Aliyun Captcha"?s(r.t("provider:Access key"),r.t("provider:Access key - Tooltip")):s(r.t("provider:Site key"),r.t("provider:Site key - Tooltip"));default:return s(r.t("provider:Client ID"),r.t("provider:Client ID - Tooltip"))}}getClientSecretLabel(t){switch(t.category){case"Email":return s(r.t("login:Password"),r.t("login:Password - Tooltip"));case"SMS":return t.type==="Volc Engine SMS"?s(r.t("provider:Secret access key"),r.t("provider:Secret access key - Tooltip")):t.type==="Huawei Cloud SMS"?s(r.t("provider:App secret"),r.t("provider:AppSecret - Tooltip")):s(r.t("provider:Client secret"),r.t("provider:Client secret - Tooltip"));case"Captcha":return t.type==="Aliyun Captcha"?s(r.t("provider:Secret access key"),r.t("provider:Secret access key - Tooltip")):s(r.t("provider:Secret key"),r.t("provider:Secret key - Tooltip"));default:return s(r.t("provider:Client secret"),r.t("provider:Client secret - Tooltip"))}}getAppIdRow(t){let a="",l="";return t.category==="OAuth"?t.type==="WeCom"&&t.subType==="Internal"?(a=r.t("provider:Agent ID"),l=r.t("provider:Agent ID - Tooltip")):t.type==="Infoflow"&&(a=r.t("provider:Agent ID"),l=r.t("provider:Agent ID - Tooltip")):t.category==="SMS"?t.type==="Tencent Cloud SMS"?(a=r.t("provider:App ID"),l=r.t("provider:App ID - Tooltip")):t.type==="Volc Engine SMS"?(a=r.t("provider:SMS account"),l=r.t("provider:SMS account - Tooltip")):t.type==="Huawei Cloud SMS"&&(a=r.t("provider:Channel No."),l=r.t("provider:Channel No. - Tooltip")):t.category==="Email"&&t.type==="SUBMAIL"&&(a=r.t("provider:App ID"),l=r.t("provider:App ID - Tooltip")),a===""&&l===""?null:e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(a,l)," :"]}),e.jsx(i,{span:22,children:e.jsx(p,{value:t.appId,onChange:u=>{this.updateProviderField("appId",u.target.value)}})})]})}loadSamlConfiguration(){const a=new DOMParser().parseFromString(this.state.provider.metadata,"text/xml"),l=a.getElementsByTagName("ds:X509Certificate")[0].childNodes[0].nodeValue,u=a.getElementsByTagName("md:SingleSignOnService")[0].getAttribute("Location"),j=a.getElementsByTagName("md:EntityDescriptor")[0].getAttribute("entityID");this.updateProviderField("idP",l),this.updateProviderField("endpoint",u),this.updateProviderField("issuerUrl",j)}renderProvider(){return e.jsxs(W,{size:"small",title:e.jsxs("div",{children:[this.state.mode==="add"?r.t("provider:New Provider"):r.t("provider:Edit Provider"),"    ",e.jsx(h,{onClick:()=>this.submitProviderEdit(!1),children:r.t("general:Save")}),e.jsx(h,{style:{marginLeft:"20px"},type:"primary",onClick:()=>this.submitProviderEdit(!0),children:r.t("general:Save & Exit")}),this.state.mode==="add"?e.jsx(h,{style:{marginLeft:"20px"},onClick:()=>this.deleteProvider(),children:r.t("general:Cancel")}):null]}),style:n()?{margin:"5px"}:{},type:"inner",children:[e.jsxs(o,{style:{marginTop:"10px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("general:Name"),r.t("general:Name - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.name,onChange:t=>{this.updateProviderField("name",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("general:Display name"),r.t("general:Display name - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.displayName,onChange:t=>{this.updateProviderField("displayName",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("general:Organization"),r.t("general:Organization - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsxs(m,{virtual:!1,style:{width:"100%"},disabled:!S(this.props.account),value:this.state.provider.owner,onChange:t=>{this.updateProviderField("owner",t)},children:[S(this.props.account)?e.jsx(x,{value:"admin",children:r.t("provider:admin (Shared)")},"admin"):null,this.state.organizations.map((t,a)=>e.jsx(x,{value:t.name,children:t.name},a))]})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("provider:Category"),r.t("provider:Category - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(m,{virtual:!1,style:{width:"100%"},value:this.state.provider.category,onChange:t=>{this.updateProviderField("category",t),t==="OAuth"?this.updateProviderField("type","GitHub"):t==="Email"?(this.updateProviderField("type","Default"),this.updateProviderField("host","smtp.example.com"),this.updateProviderField("port",465),this.updateProviderField("disableSsl",!1),this.updateProviderField("title","Casdoor Verification Code"),this.updateProviderField("content","You have requested a verification code at Casdoor. Here is your code: %s, please enter in 5 minutes."),this.updateProviderField("receiver",this.props.account.email)):t==="SMS"?this.updateProviderField("type","Aliyun SMS"):t==="Storage"?(this.updateProviderField("type","Local File System"),this.updateProviderField("domain",F())):t==="SAML"?this.updateProviderField("type","Aliyun IDaaS"):t==="Payment"?this.updateProviderField("type","Alipay"):t==="Captcha"&&this.updateProviderField("type","Default")},children:[{id:"OAuth",name:"OAuth"},{id:"Email",name:"Email"},{id:"SMS",name:"SMS"},{id:"Storage",name:"Storage"},{id:"SAML",name:"SAML"},{id:"Payment",name:"Payment"},{id:"Captcha",name:"Captcha"}].sort((t,a)=>t.name.localeCompare(a.name)).map((t,a)=>e.jsx(x,{value:t.id,children:t.name},a))})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("provider:Type"),r.t("provider:Type - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(m,{virtual:!1,style:{width:"100%"},value:this.state.provider.type,onChange:t=>{this.updateProviderField("type",t),t==="Local File System"&&this.updateProviderField("domain",F()),t==="Custom"&&(this.updateProviderField("customAuthUrl","https://door.casdoor.com/login/oauth/authorize"),this.updateProviderField("customScope","openid profile email"),this.updateProviderField("customTokenUrl","https://door.casdoor.com/api/login/oauth/access_token"),this.updateProviderField("customUserInfoUrl","https://door.casdoor.com/api/userinfo"))},children:q(this.state.provider.category).sort((t,a)=>t.name.localeCompare(a.name)).map((t,a)=>e.jsx(x,{value:t.id,children:t.name},a))})})]}),this.state.provider.type!=="WeCom"&&this.state.provider.type!=="Infoflow"&&this.state.provider.type!=="Aliyun Captcha"?null:e.jsxs(v.Fragment,{children:[e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:2,children:[s(r.t("provider:Sub type"),r.t("provider:Sub type - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(m,{virtual:!1,style:{width:"100%"},value:this.state.provider.subType,onChange:t=>{this.updateProviderField("subType",t)},children:_(this.state.provider.type).map((t,a)=>e.jsx(x,{value:t.id,children:t.name},a))})})]}),this.state.provider.type!=="WeCom"?null:e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:2,children:[s(r.t("general:Method"),r.t("provider:Method - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(m,{virtual:!1,style:{width:"100%"},value:this.state.provider.method,onChange:t=>{this.updateProviderField("method",t)},children:[{name:"Normal"},{name:"Silent"}].map((t,a)=>e.jsx(x,{value:t.name,children:t.name},a))})})]})]}),this.state.provider.type!=="Custom"?null:e.jsxs(v.Fragment,{children:[e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsx(i,{style:{marginTop:"5px"},span:n()?22:2,children:s(r.t("provider:Auth URL"),r.t("provider:Auth URL - Tooltip"))}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.customAuthUrl,onChange:t=>{this.updateProviderField("customAuthUrl",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsx(i,{style:{marginTop:"5px"},span:n()?22:2,children:s(r.t("provider:Scope"),r.t("provider:Scope - Tooltip"))}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.customScope,onChange:t=>{this.updateProviderField("customScope",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsx(i,{style:{marginTop:"5px"},span:n()?22:2,children:s(r.t("provider:Token URL"),r.t("provider:Token URL - Tooltip"))}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.customTokenUrl,onChange:t=>{this.updateProviderField("customTokenUrl",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsx(i,{style:{marginTop:"5px"},span:n()?22:2,children:s(r.t("provider:UserInfo URL"),r.t("provider:UserInfo URL - Tooltip"))}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.customUserInfoUrl,onChange:t=>{this.updateProviderField("customUserInfoUrl",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("general:Favicon"),r.t("general:Favicon - Tooltip"))," :"]}),e.jsxs(i,{span:22,children:[e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:1,children:[s(r.t("general:URL"),r.t("general:URL - Tooltip"))," :"]}),e.jsx(i,{span:23,children:e.jsx(p,{prefix:e.jsx(P,{}),value:this.state.provider.customLogo,onChange:t=>{this.updateProviderField("customLogo",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:1,children:[r.t("general:Preview"),":"]}),e.jsx(i,{span:23,children:e.jsx("a",{target:"_blank",rel:"noreferrer",href:this.state.provider.customLogo,children:e.jsx("img",{src:this.state.provider.customLogo,alt:this.state.provider.customLogo,height:90,style:{marginBottom:"20px"}})})})]})]})]})]}),this.state.provider.category==="Captcha"&&this.state.provider.type==="Default"?null:e.jsxs(v.Fragment,{children:[e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsx(i,{style:{marginTop:"5px"},span:n()?22:2,children:this.getClientIdLabel(this.state.provider)}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.clientId,onChange:t=>{this.updateProviderField("clientId",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsx(i,{style:{marginTop:"5px"},span:n()?22:2,children:this.getClientSecretLabel(this.state.provider)}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.clientSecret,onChange:t=>{this.updateProviderField("clientSecret",t.target.value)}})})]})]}),this.state.provider.type!=="WeChat"&&this.state.provider.type!=="Aliyun Captcha"?null:e.jsxs(v.Fragment,{children:[e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsx(i,{style:{marginTop:"5px"},span:n()?22:2,children:this.state.provider.type==="Aliyun Captcha"?s(r.t("provider:Scene"),r.t("provider:Scene - Tooltip")):s(r.t("provider:Client ID 2"),r.t("provider:Client ID 2 - Tooltip"))}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.clientId2,onChange:t=>{this.updateProviderField("clientId2",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsx(i,{style:{marginTop:"5px"},span:n()?22:2,children:this.state.provider.type==="Aliyun Captcha"?s(r.t("provider:App key"),r.t("provider:App key - Tooltip")):s(r.t("provider:Client secret 2"),r.t("provider:Client secret 2 - Tooltip"))}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.clientSecret2,onChange:t=>{this.updateProviderField("clientSecret2",t.target.value)}})})]})]}),this.state.provider.type!=="WeChat"?null:e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("provider:Enable QR code"),r.t("provider:Enable QR code - Tooltip"))," :"]}),e.jsx(i,{span:1,children:e.jsx(C,{checked:this.state.provider.disableSsl,onChange:t=>{this.updateProviderField("disableSsl",t)}})})]}),this.state.provider.type!=="Adfs"&&this.state.provider.type!=="Casdoor"&&this.state.provider.type!=="Okta"?null:e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:2,children:[s(r.t("provider:Domain"),r.t("provider:Domain - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.domain,onChange:t=>{this.updateProviderField("domain",t.target.value)}})})]}),this.state.provider.category==="Storage"?e.jsxs("div",{children:[e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:2,children:[s(r.t("provider:Endpoint"),r.t("provider:Region endpoint for Internet"))," :"]}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.endpoint,onChange:t=>{this.updateProviderField("endpoint",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:2,children:[s(r.t("provider:Endpoint (Intranet)"),r.t("provider:Region endpoint for Intranet"))," :"]}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.intranetEndpoint,onChange:t=>{this.updateProviderField("intranetEndpoint",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:2,children:[s(r.t("provider:Bucket"),r.t("provider:Bucket - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.bucket,onChange:t=>{this.updateProviderField("bucket",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:2,children:[s(r.t("provider:Path prefix"),r.t("provider:Path prefix - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.pathPrefix,onChange:t=>{this.updateProviderField("pathPrefix",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:2,children:[s(r.t("provider:Domain"),r.t("provider:Domain - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.domain,onChange:t=>{this.updateProviderField("domain",t.target.value)}})})]}),["AWS S3","MinIO","Tencent Cloud COS"].includes(this.state.provider.type)?e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:2,children:[s(r.t("provider:Region ID"),r.t("provider:Region ID - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.regionId,onChange:t=>{this.updateProviderField("regionId",t.target.value)}})})]}):null]}):null,this.state.provider.category==="Email"?e.jsxs(v.Fragment,{children:[e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("provider:Host"),r.t("provider:Host - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(p,{prefix:e.jsx(P,{}),value:this.state.provider.host,onChange:t=>{this.updateProviderField("host",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("provider:Port"),r.t("provider:Port - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(re,{value:this.state.provider.port,onChange:t=>{this.updateProviderField("port",t)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("provider:Disable SSL"),r.t("provider:Disable SSL - Tooltip"))," :"]}),e.jsx(i,{span:1,children:e.jsx(C,{checked:this.state.provider.disableSsl,onChange:t=>{this.updateProviderField("disableSsl",t)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("provider:Email title"),r.t("provider:Email title - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.title,onChange:t=>{this.updateProviderField("title",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("provider:Email content"),r.t("provider:Email content - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(A,{autoSize:{minRows:3,maxRows:100},value:this.state.provider.content,onChange:t=>{this.updateProviderField("content",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("provider:Test Email"),r.t("provider:Test Email - Tooltip"))," :"]}),e.jsx(i,{span:4,children:e.jsx(p,{value:this.state.provider.receiver,placeholder:r.t("user:Input your email"),onChange:t=>{this.updateProviderField("receiver",t.target.value)}})}),e.jsx(h,{style:{marginLeft:"10px",marginBottom:"5px"},type:"primary",onClick:()=>se(this.state.provider),children:r.t("provider:Test SMTP Connection")}),e.jsx(h,{style:{marginLeft:"10px",marginBottom:"5px"},type:"primary",disabled:!G(this.state.provider.receiver),onClick:()=>ie(this.state.provider,this.state.provider.receiver),children:r.t("provider:Send Testing Email")})]})]}):this.state.provider.category==="SMS"?e.jsxs(v.Fragment,{children:[this.state.provider.type==="Twilio SMS"?null:e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("provider:Sign Name"),r.t("provider:Sign Name - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.signName,onChange:t=>{this.updateProviderField("signName",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("provider:Template code"),r.t("provider:Template code - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.templateCode,onChange:t=>{this.updateProviderField("templateCode",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("provider:SMS Test"),r.t("provider:SMS Test - Tooltip"))," :"]}),e.jsx(i,{span:4,children:e.jsxs(p.Group,{compact:!0,children:[e.jsx(J,{style:{width:"30%"},value:this.state.provider.content,onChange:t=>{this.updateProviderField("content",t)},countryCodes:this.props.account.organization.countryCodes}),e.jsx(p,{value:this.state.provider.receiver,style:{width:"70%"},placeholder:r.t("user:Input your phone number"),onChange:t=>{this.updateProviderField("receiver",t.target.value)}})]})}),e.jsx(i,{span:2,children:e.jsx(h,{style:{marginLeft:"10px",marginBottom:"5px"},type:"primary",disabled:!Q(this.state.provider.receiver),onClick:()=>ae(this.state.provider,"+"+X(this.state.provider.content)+this.state.provider.receiver),children:r.t("provider:Send Testing SMS")})})]})]}):this.state.provider.category==="SAML"?e.jsxs(v.Fragment,{children:[e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("provider:Sign request"),r.t("provider:Sign request - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(C,{checked:this.state.provider.enableSignAuthnRequest,onChange:t=>{this.updateProviderField("enableSignAuthnRequest",t)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("provider:Metadata"),r.t("provider:Metadata - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(A,{rows:4,value:this.state.provider.metadata,onChange:t=>{this.updateProviderField("metadata",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsx(i,{style:{marginTop:"5px"},span:2}),e.jsx(i,{span:2,children:e.jsx(h,{type:"primary",onClick:()=>{try{this.loadSamlConfiguration(),d("success",r.t("provider:Parse metadata successfully"))}catch{d("error",r.t("provider:Can not parse metadata"))}},children:r.t("provider:Parse")})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("provider:Endpoint"),r.t("provider:SAML 2.0 Endpoint (HTTP)"))," :"]}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.endpoint,onChange:t=>{this.updateProviderField("endpoint",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("provider:IdP"),r.t("provider:IdP certificate"))," :"]}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.idP,onChange:t=>{this.updateProviderField("idP",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("provider:Issuer URL"),r.t("provider:Issuer URL - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(p,{value:this.state.provider.issuerUrl,onChange:t=>{this.updateProviderField("issuerUrl",t.target.value)}})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("provider:SP ACS URL"),r.t("provider:SP ACS URL - Tooltip"))," :"]}),e.jsx(i,{span:21,children:e.jsx(p,{value:`${y.serverUrl}/api/acs`,readOnly:"readonly"})}),e.jsx(i,{span:1,children:e.jsx(h,{type:"primary",onClick:()=>{I(`${y.serverUrl}/api/acs`),d("success",r.t("provider:Link copied to clipboard successfully"))},children:r.t("provider:Copy")})})]}),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("provider:SP Entity ID"),r.t("provider:SP ACS URL - Tooltip"))," :"]}),e.jsx(i,{span:21,children:e.jsx(p,{value:`${y.serverUrl}/api/acs`,readOnly:"readonly"})}),e.jsx(i,{span:1,children:e.jsx(h,{type:"primary",onClick:()=>{I(`${y.serverUrl}/api/acs`),d("success",r.t("provider:Link copied to clipboard successfully"))},children:r.t("provider:Copy")})})]})]}):null,this.getAppIdRow(this.state.provider),e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("provider:Provider URL"),r.t("provider:Provider URL - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(p,{prefix:e.jsx(P,{}),value:this.state.provider.providerUrl,onChange:t=>{this.updateProviderField("providerUrl",t.target.value)}})})]}),this.state.provider.category!=="Captcha"?null:e.jsxs(o,{style:{marginTop:"20px"},children:[e.jsxs(i,{style:{marginTop:"5px"},span:n()?22:2,children:[s(r.t("general:Preview"),r.t("general:Preview - Tooltip"))," :"]}),e.jsx(i,{span:22,children:e.jsx(ne,{owner:this.state.provider.owner,name:this.state.provider.name,provider:this.state.provider,providerName:this.state.providerName,captchaType:this.state.provider.type,subType:this.state.provider.subType,clientId:this.state.provider.clientId,clientSecret:this.state.provider.clientSecret,clientId2:this.state.provider.clientId2,clientSecret2:this.state.provider.clientSecret2,providerUrl:this.state.provider.providerUrl})})]})]})}submitProviderEdit(t){const a=Y(this.state.provider);ee(this.state.owner,this.state.providerName,a).then(l=>{l.status==="ok"?(d("success",r.t("general:Successfully saved")),this.setState({owner:this.state.provider.owner,providerName:this.state.provider.name}),t?this.props.history.push("/providers"):this.props.history.push(`/providers/${this.state.provider.owner}/${this.state.provider.name}`)):(d("error",`${r.t("general:Failed to save")}: ${l.msg}`),this.updateProviderField("name",this.state.providerName))}).catch(l=>{d("error",`${r.t("general:Failed to connect to server")}: ${l}`)})}deleteProvider(){te(this.state.provider).then(t=>{t.status==="ok"?this.props.history.push("/providers"):d("error",`${r.t("general:Failed to delete")}: ${t.msg}`)}).catch(t=>{d("error",`${r.t("general:Failed to connect to server")}: ${t}`)})}render(){return e.jsxs("div",{children:[this.state.provider!==null?this.renderProvider():null,e.jsxs("div",{style:{marginTop:"20px",marginLeft:"40px"},children:[e.jsx(h,{size:"large",onClick:()=>this.submitProviderEdit(!1),children:r.t("general:Save")}),e.jsx(h,{style:{marginLeft:"20px"},type:"primary",size:"large",onClick:()=>this.submitProviderEdit(!0),children:r.t("general:Save & Exit")}),this.state.mode==="add"?e.jsx(h,{style:{marginLeft:"20px"},size:"large",onClick:()=>this.deleteProvider(),children:r.t("general:Cancel")}):null]})]})}}export{ue as default};
