var f=Object.defineProperty;var m=(s,t,e)=>t in s?f(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var h=(s,t,e)=>(m(s,typeof t!="symbol"?t+"":t,e),e);import{U as g,_ as u,s as c,i as o,b as S,j as l,L as T,c as $,d_ as w,e as y,h as j}from"./index-f0baa7a0.js";import{B as C}from"./BaseListPage-041c389a.js";import{P as k}from"./PopconfirmModal-8710d8ae.js";import{T as z}from"./Table-f650b5e6.js";import"./index-9d454b6e.js";function I(s,t="",e="",a="",d="",n="",r=""){return fetch(`${g}/api/get-sessions?owner=${s}&p=${t}&pageSize=${e}&field=${a}&value=${d}&sortField=${n}&sortOrder=${r}`,{method:"GET",credentials:"include",headers:{"Accept-Language":u()}}).then(i=>i.json())}function P(s){return fetch(`${g}/api/delete-session`,{method:"POST",credentials:"include",body:JSON.stringify(s),headers:{"Accept-Language":u()}}).then(t=>t.json())}class D extends C{constructor(){super(...arguments);h(this,"fetch",(e={})=>{let a=e.searchedColumn,d=e.searchText;const n=e.sortField,r=e.sortOrder;e.contentType!==void 0&&e.contentType!==null&&(a="contentType",d=e.contentType),this.setState({loading:!0}),I("",e.pagination.current,e.pagination.pageSize,a,d,n,r).then(i=>{i.status==="ok"?this.setState({loading:!1,data:i.data,pagination:{...e.pagination,total:i.data2},searchText:e.searchText,searchedColumn:e.searchedColumn}):j(i)&&this.setState({loading:!1,isAuthorized:!1})})})}deleteSession(e){P(this.state.data[e]).then(a=>{a.status==="ok"?(c("success",o.t("general:Successfully deleted")),this.setState({data:S(this.state.data,e),pagination:{total:this.state.pagination.total-1}})):c("error",`${o.t("general:Failed to delete")}: ${a.msg}`)}).catch(a=>{c("error",`${o.t("general:Failed to connect to server")}: ${a}`)})}renderTable(e){const a=[{title:o.t("general:Name"),dataIndex:"name",key:"name",width:"150px",fixed:"left",sorter:!0,...this.getColumnSearchProps("name")},{title:o.t("general:Organization"),dataIndex:"owner",key:"organization",width:"110px",sorter:!0,...this.getColumnSearchProps("organization"),render:(n,r,i)=>l.jsx(T,{to:`/organizations/${n}`,children:n})},{title:o.t("general:Created time"),dataIndex:"createdTime",key:"createdTime",width:"180px",sorter:!0,render:(n,r,i)=>$(n)},{title:o.t("general:Session ID"),dataIndex:"sessionId",key:"sessionId",width:"180px",sorter:!0,render:(n,r,i)=>n.map((p,x)=>l.jsx(w,{children:p},x))},{title:o.t("general:Action"),dataIndex:"",key:"op",width:"70px",fixed:y()?"false":"right",render:(n,r,i)=>l.jsx("div",{children:l.jsx(k,{title:o.t("general:Sure to delete")+`: ${r.name} ?`,onConfirm:()=>this.deleteSession(i)})})}],d={total:this.state.pagination.total,showQuickJumper:!0,showSizeChanger:!0,showTotal:()=>o.t("general:{total} in total").replace("{total}",this.state.pagination.total)};return l.jsx("div",{children:l.jsx(z,{scroll:{x:"max-content"},columns:a,dataSource:e,rowKey:"name",size:"middle",bordered:!0,pagination:d,loading:this.state.loading,onChange:this.handleTableChange})})}}export{D as default};
