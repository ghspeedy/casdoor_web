import{Z as z,R as O,j as e,v as U,i as s,B as u,e as p,m as x,n as l,w as m,I as k,q as C,ab as A,s as y,E as _,W as $}from"./index-f0baa7a0.js";import{b as D,u as I,d as W}from"./CertBackend-d8ae5857.js";import{I as B}from"./index-c8446531.js";import"./UpOutlined-7082c42f.js";var w={},H={get exports(){return w},set exports(f){w=f}};(function(f,n){(function(t,o){o()})(z,function(){function t(i,r){return typeof r>"u"?r={autoBom:!1}:typeof r!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),r={autoBom:!r}),r.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i}function o(i,r,h){var a=new XMLHttpRequest;a.open("GET",i),a.responseType="blob",a.onload=function(){j(a.response,r,h)},a.onerror=function(){console.error("could not download file")},a.send()}function S(i){var r=new XMLHttpRequest;r.open("HEAD",i,!1);try{r.send()}catch{}return 200<=r.status&&299>=r.status}function v(i){try{i.dispatchEvent(new MouseEvent("click"))}catch{var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),i.dispatchEvent(r)}}var d=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof globalThis=="object"&&globalThis.global===globalThis?globalThis:void 0,F=d.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),j=d.saveAs||(typeof window!="object"||window!==d?function(){}:"download"in HTMLAnchorElement.prototype&&!F?function(i,r,h){var a=d.URL||d.webkitURL,c=document.createElement("a");r=r||i.name||"download",c.download=r,c.rel="noopener",typeof i=="string"?(c.href=i,c.origin===location.origin?v(c):S(c.href)?o(i,r,h):v(c,c.target="_blank")):(c.href=a.createObjectURL(i),setTimeout(function(){a.revokeObjectURL(c.href)},4e4),setTimeout(function(){v(c)},0))}:"msSaveOrOpenBlob"in navigator?function(i,r,h){if(r=r||i.name||"download",typeof i!="string")navigator.msSaveOrOpenBlob(t(i,h),r);else if(S(i))o(i,r,h);else{var a=document.createElement("a");a.href=i,a.target="_blank",setTimeout(function(){v(a)})}}:function(i,r,h,a){if(a=a||open("","_blank"),a&&(a.document.title=a.document.body.innerText="downloading..."),typeof i=="string")return o(i,r,h);var c=i.type==="application/octet-stream",M=/constructor/i.test(d.HTMLElement)||d.safari,R=/CriOS\/[\d]+/.test(navigator.userAgent);if((R||c&&M||F)&&typeof FileReader<"u"){var T=new FileReader;T.onloadend=function(){var g=T.result;g=R?g:g.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=g:location=g,a=null},T.readAsDataURL(i)}else{var L=d.URL||d.webkitURL,b=L.createObjectURL(i);a?a.location=b:location.href=b,a=null,setTimeout(function(){L.revokeObjectURL(b)},4e4)}});d.saveAs=j.saveAs=j,f.exports=j})})(H);const{Option:E}=C,{TextArea:N}=k;class J extends O.Component{constructor(n){super(n),this.state={classes:n,certName:n.match.params.certName,cert:null,mode:n.location.mode!==void 0?n.location.mode:"edit"}}UNSAFE_componentWillMount(){this.getCert()}getCert(){D("admin",this.state.certName).then(n=>{this.setState({cert:n})})}parseCertField(n,t){return["port"].includes(n)&&(t=$(t)),t}updateCertField(n,t){t=this.parseCertField(n,t);const o=this.state.cert;o[n]=t,this.setState({cert:o})}renderCert(){const n=p()?22:9;return e.jsxs(U,{size:"small",title:e.jsxs("div",{children:[this.state.mode==="add"?s.t("cert:New Cert"):s.t("cert:Edit Cert"),"    ",e.jsx(u,{onClick:()=>this.submitCertEdit(!1),children:s.t("general:Save")}),e.jsx(u,{style:{marginLeft:"20px"},type:"primary",onClick:()=>this.submitCertEdit(!0),children:s.t("general:Save & Exit")}),this.state.mode==="add"?e.jsx(u,{style:{marginLeft:"20px"},onClick:()=>this.deleteCert(),children:s.t("general:Cancel")}):null]}),style:p()?{margin:"5px"}:{},type:"inner",children:[e.jsxs(x,{style:{marginTop:"10px"},children:[e.jsxs(l,{style:{marginTop:"5px"},span:p()?22:2,children:[m(s.t("general:Name"),s.t("general:Name - Tooltip"))," :"]}),e.jsx(l,{span:22,children:e.jsx(k,{value:this.state.cert.name,onChange:t=>{this.updateCertField("name",t.target.value)}})})]}),e.jsxs(x,{style:{marginTop:"20px"},children:[e.jsxs(l,{style:{marginTop:"5px"},span:p()?22:2,children:[m(s.t("general:Display name"),s.t("general:Display name - Tooltip"))," :"]}),e.jsx(l,{span:22,children:e.jsx(k,{value:this.state.cert.displayName,onChange:t=>{this.updateCertField("displayName",t.target.value)}})})]}),e.jsxs(x,{style:{marginTop:"20px"},children:[e.jsxs(l,{style:{marginTop:"5px"},span:p()?22:2,children:[m(s.t("provider:Scope"),s.t("cert:Scope - Tooltip"))," :"]}),e.jsx(l,{span:22,children:e.jsx(C,{virtual:!1,style:{width:"100%"},value:this.state.cert.scope,onChange:t=>{this.updateCertField("scope",t)},children:[{id:"JWT",name:"JWT"}].map((t,o)=>e.jsx(E,{value:t.id,children:t.name},o))})})]}),e.jsxs(x,{style:{marginTop:"20px"},children:[e.jsxs(l,{style:{marginTop:"5px"},span:p()?22:2,children:[m(s.t("provider:Type"),s.t("cert:Type - Tooltip"))," :"]}),e.jsx(l,{span:22,children:e.jsx(C,{virtual:!1,style:{width:"100%"},value:this.state.cert.type,onChange:t=>{this.updateCertField("type",t)},children:[{id:"x509",name:"x509"}].map((t,o)=>e.jsx(E,{value:t.id,children:t.name},o))})})]}),e.jsxs(x,{style:{marginTop:"20px"},children:[e.jsxs(l,{style:{marginTop:"5px"},span:p()?22:2,children:[m(s.t("cert:Crypto algorithm"),s.t("cert:Crypto algorithm - Tooltip"))," :"]}),e.jsx(l,{span:22,children:e.jsx(C,{virtual:!1,style:{width:"100%"},value:this.state.cert.cryptoAlgorithm,onChange:t=>{this.updateCertField("cryptoAlgorithm",t)},children:[{id:"RS256",name:"RS256"}].map((t,o)=>e.jsx(E,{value:t.id,children:t.name},o))})})]}),e.jsxs(x,{style:{marginTop:"20px"},children:[e.jsxs(l,{style:{marginTop:"5px"},span:p()?22:2,children:[m(s.t("cert:Bit size"),s.t("cert:Bit size - Tooltip"))," :"]}),e.jsx(l,{span:22,children:e.jsx(B,{value:this.state.cert.bitSize,onChange:t=>{this.updateCertField("bitSize",t)}})})]}),e.jsxs(x,{style:{marginTop:"20px"},children:[e.jsxs(l,{style:{marginTop:"5px"},span:p()?22:2,children:[m(s.t("cert:Expire in years"),s.t("cert:Expire in years - Tooltip"))," :"]}),e.jsx(l,{span:22,children:e.jsx(B,{value:this.state.cert.expireInYears,onChange:t=>{this.updateCertField("expireInYears",t)}})})]}),e.jsxs(x,{style:{marginTop:"20px"},children:[e.jsxs(l,{style:{marginTop:"5px"},span:p()?22:2,children:[m(s.t("cert:Certificate"),s.t("cert:Certificate - Tooltip"))," :"]}),e.jsxs(l,{span:n,children:[e.jsx(u,{style:{marginRight:"10px",marginBottom:"10px"},onClick:()=>{A(this.state.cert.certificate),y("success",s.t("cert:Certificate copied to clipboard successfully"))},children:s.t("cert:Copy certificate")}),e.jsx(u,{type:"primary",onClick:()=>{const t=new Blob([this.state.cert.certificate],{type:"text/plain;charset=utf-8"});w.saveAs(t,"token_jwt_key.pem")},children:s.t("cert:Download certificate")}),e.jsx(N,{autoSize:{minRows:30,maxRows:30},value:this.state.cert.certificate,onChange:t=>{this.updateCertField("certificate",t.target.value)}})]}),e.jsx(l,{span:1}),e.jsxs(l,{style:{marginTop:"5px"},span:p()?22:2,children:[m(s.t("cert:Private key"),s.t("cert:Private key - Tooltip"))," :"]}),e.jsxs(l,{span:n,children:[e.jsx(u,{style:{marginRight:"10px",marginBottom:"10px"},onClick:()=>{A(this.state.cert.privateKey),y("success",s.t("cert:Private key copied to clipboard successfully"))},children:s.t("cert:Copy private key")}),e.jsx(u,{type:"primary",onClick:()=>{const t=new Blob([this.state.cert.privateKey],{type:"text/plain;charset=utf-8"});w.saveAs(t,"token_jwt_key.key")},children:s.t("cert:Download private key")}),e.jsx(N,{autoSize:{minRows:30,maxRows:30},value:this.state.cert.privateKey,onChange:t=>{this.updateCertField("privateKey",t.target.value)}})]})]})]})}submitCertEdit(n){const t=_(this.state.cert);I(this.state.cert.owner,this.state.certName,t).then(o=>{o.status==="ok"?(y("success",s.t("general:Successfully saved")),this.setState({certName:this.state.cert.name}),n?this.props.history.push("/certs"):this.props.history.push(`/certs/${this.state.cert.name}`)):(y("error",`${s.t("general:Failed to save")}: ${o.msg}`),this.updateCertField("name",this.state.certName))}).catch(o=>{y("error",`${s.t("general:Failed to connect to server")}: ${o}`)})}deleteCert(){W(this.state.cert).then(n=>{n.status==="ok"?this.props.history.push("/certs"):y("error",`${s.t("general:Failed to delete")}: ${n.msg}`)}).catch(n=>{y("error",`${s.t("general:Failed to connect to server")}: ${n}`)})}render(){return e.jsxs("div",{children:[this.state.cert!==null?this.renderCert():null,e.jsxs("div",{style:{marginTop:"20px",marginLeft:"40px"},children:[e.jsx(u,{size:"large",onClick:()=>this.submitCertEdit(!1),children:s.t("general:Save")}),e.jsx(u,{style:{marginLeft:"20px"},type:"primary",size:"large",onClick:()=>this.submitCertEdit(!0),children:s.t("general:Save & Exit")}),this.state.mode==="add"?e.jsx(u,{style:{marginLeft:"20px"},size:"large",onClick:()=>this.deleteCert(),children:s.t("general:Cancel")}):null]})]})}}export{J as default};
