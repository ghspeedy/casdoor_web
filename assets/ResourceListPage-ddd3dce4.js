var g=Object.defineProperty;var x=(l,n,e)=>n in l?g(l,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[n]=e;var p=(l,n,e)=>(x(l,typeof n!="symbol"?n+"":n,e),e);import{s as d,i as t,b as m,j as i,B as h,L as u,c as f,c1 as w,ab as y,e as k}from"./index-f0baa7a0.js";import{d as S,u as C,g as v}from"./ResourceBackend-1b97151f.js";import{B as T}from"./BaseListPage-041c389a.js";import{P as j}from"./PopconfirmModal-8710d8ae.js";import{U as P,a as F}from"./UploadOutlined-a658b565.js";import{T as $}from"./Table-f650b5e6.js";import"./index-9d454b6e.js";import"./DeleteOutlined-25685737.js";class A extends T{constructor(e){super(e);p(this,"fetch",(e={})=>{const s=e.searchedColumn,c=e.searchText,a=e.sortField,r=e.sortOrder;this.setState({loading:!0}),v(this.props.account.owner,this.props.account.name,e.pagination.current,e.pagination.pageSize,s,c,a,r).then(o=>{o.status==="ok"?this.setState({loading:!1,data:o.data,pagination:{...e.pagination,total:o.data2},searchText:e.searchText,searchedColumn:e.searchedColumn}):o.data.includes("Please login first")&&this.setState({loading:!1,isAuthorized:!1})})})}componentDidMount(){this.setState({fileList:[],uploading:!1})}deleteResource(e){S(this.state.data[e]).then(s=>{s.status==="ok"?(d("success",t.t("general:Successfully deleted")),this.setState({data:m(this.state.data,e),pagination:{total:this.state.pagination.total-1}})):d("error",`${t.t("general:Failed to delete")}: ${s.msg}`)}).catch(s=>{d("error",`${t.t("general:Failed to connect to server")}: ${s}`)})}handleUpload(e){this.setState({uploading:!0});const s=e.fileList[0].name,c=`resource/${this.props.account.owner}/${this.props.account.name}/${s}`;C(this.props.account.owner,this.props.account.name,"custom","ResourceListPage",c,e.file).then(a=>{a.status==="ok"?(d("success",t.t("application:File uploaded successfully")),window.location.reload()):d("error",a.msg)}).finally(()=>{this.setState({uploading:!1})})}renderUpload(){return i.jsx(P,{maxCount:1,accept:"image/*,video/*,audio/*,.pdf,.doc,.docx,.csv,.xls,.xlsx",showUploadList:!1,beforeUpload:e=>!1,onChange:e=>{this.handleUpload(e)},children:i.jsx(h,{icon:i.jsx(F,{}),loading:this.state.uploading,type:"primary",size:"small",children:t.t("resource:Upload a file...")})})}renderTable(e){const s=[{title:t.t("general:Provider"),dataIndex:"provider",key:"provider",width:"150px",fixed:"left",sorter:!0,...this.getColumnSearchProps("provider"),render:(a,r,o)=>i.jsx(u,{to:`/providers/${r.owner}/${a}`,children:a})},{title:t.t("general:Application"),dataIndex:"application",key:"application",width:"80px",sorter:!0,...this.getColumnSearchProps("application"),render:(a,r,o)=>i.jsx(u,{to:`/applications/${r.organization}/${a}`,children:a})},{title:t.t("general:User"),dataIndex:"user",key:"user",width:"80px",sorter:!0,...this.getColumnSearchProps("user"),render:(a,r,o)=>i.jsx(u,{to:`/users/${r.owner}/${r.user}`,children:a})},{title:t.t("resource:Parent"),dataIndex:"parent",key:"parent",width:"80px",sorter:!0,...this.getColumnSearchProps("parent")},{title:t.t("general:Name"),dataIndex:"name",key:"name",width:"150px",sorter:!0,...this.getColumnSearchProps("name")},{title:t.t("general:Created time"),dataIndex:"createdTime",key:"createdTime",width:"150px",sorter:!0,render:(a,r,o)=>f(a)},{title:t.t("user:Tag"),dataIndex:"tag",key:"tag",width:"80px",sorter:!0,...this.getColumnSearchProps("tag")},{title:t.t("provider:Type"),dataIndex:"fileType",key:"fileType",width:"80px",sorter:!0,...this.getColumnSearchProps("fileType")},{title:t.t("resource:Format"),dataIndex:"fileFormat",key:"fileFormat",width:"80px",sorter:!0,...this.getColumnSearchProps("fileFormat")},{title:t.t("resource:File size"),dataIndex:"fileSize",key:"fileSize",width:"100px",sorter:!0,render:(a,r,o)=>w(a)},{title:t.t("general:Preview"),dataIndex:"preview",key:"preview",width:"100px",render:(a,r,o)=>{if(r.fileType==="image")return i.jsx("a",{target:"_blank",rel:"noreferrer",href:r.url,children:i.jsx("img",{src:r.url,alt:r.name,width:200})});if(r.fileType==="video")return i.jsx("video",{width:200,controls:!0,children:i.jsx("source",{src:r.url,type:"video/mp4"})})}},{title:t.t("general:URL"),dataIndex:"url",key:"url",width:"120px",render:(a,r,o)=>i.jsx("div",{children:i.jsx(h,{type:"normal",onClick:()=>{y(r.url),d("success",t.t("provider:Link copied to clipboard successfully"))},children:t.t("resource:Copy Link")})})},{title:t.t("general:Action"),dataIndex:"",key:"op",width:"70px",fixed:k()?"false":"right",render:(a,r,o)=>i.jsx("div",{children:i.jsx(j,{title:t.t("general:Sure to delete")+`: ${r.name} ?`,onConfirm:()=>this.deleteResource(o),okText:t.t("general:OK"),cancelText:t.t("general:Cancel")})})}],c={total:this.state.pagination.total,showQuickJumper:!0,showSizeChanger:!0,showTotal:()=>t.t("general:{total} in total").replace("{total}",this.state.pagination.total)};return i.jsx("div",{children:i.jsx($,{scroll:{x:"max-content"},columns:s,dataSource:e,rowKey:"name",size:"middle",bordered:!0,pagination:c,title:()=>i.jsxs("div",{children:[t.t("general:Resources"),"    ",this.renderUpload()]}),loading:this.state.loading,onChange:this.handleTableChange})})}}export{A as default};
