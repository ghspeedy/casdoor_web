import{ag as b,ah as k,ai as P,R as F,cr as w,s as p,cs as f,i as t,j as e,co as z,v as S,B as m,e as s,m as i,n,w as r,I as o,q as E,l as L,ct as M,cu as U,a6 as D,a8 as C,cv as V,cw as $,E as R,W as O}from"./index-ba7d0766.js";import{b as B,i as W,u as A,d as _}from"./PaymentBackend-54d4c1cc.js";import{D as d}from"./index-00085cca.js";var q={icon:function(a,l){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z",fill:a}},{tag:"path",attrs:{d:"M512 140c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm32 588c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V456c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272zm-32-344a48.01 48.01 0 010-96 48.01 48.01 0 010 96z",fill:l}},{tag:"path",attrs:{d:"M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z",fill:a}}]}},name:"info-circle",theme:"twotone"};const G=q;var N=function(a,l){return b.createElement(k,P(P({},a),{},{ref:l,icon:G}))};N.displayName="InfoCircleTwoTone";const H=b.forwardRef(N),{Option:J}=E;class Y extends F.Component{constructor(a){super(a),this.state={classes:a,organizationName:a.organizationName!==void 0?a.organizationName:a.match.params.organizationName,paymentName:a.match.params.paymentName,payment:null,isModalVisible:!1,isInvoiceLoading:!1,mode:a.location.mode!==void 0?a.location.mode:"edit"}}UNSAFE_componentWillMount(){this.getPayment()}getPayment(){B("admin",this.state.paymentName).then(a=>{this.setState({payment:a}),w("invoice-area")})}parsePaymentField(a,l){return[""].includes(a)&&(l=O(l)),l}updatePaymentField(a,l){l=this.parsePaymentField(a,l);const h=this.state.payment;h[a]=l,this.setState({payment:h})}issueInvoice(){this.setState({isModalVisible:!1,isInvoiceLoading:!0}),W(this.state.payment.owner,this.state.paymentName).then(a=>{this.setState({isInvoiceLoading:!1}),a.status==="ok"?(p("success","Successfully invoiced"),f(a.data),this.getPayment()):p(a.msg.includes("成功")?"info":"error",a.msg)}).catch(a=>{this.setState({isInvoiceLoading:!1}),p("error",`${t.t("general:Failed to connect to server")}: ${a}`)})}downloadInvoice(){f(this.state.payment.invoiceUrl)}renderModal(){var c,x,u,g,v,T,j,I;const a=this,l=()=>{a.issueInvoice()},h=()=>{this.setState({isModalVisible:!1})};return e.jsx(z,{title:e.jsxs("div",{children:[e.jsx(H,{twoToneColor:"rgb(45,120,213)"})," "+t.t("payment:Confirm your invoice information")]}),open:this.state.isModalVisible,onOk:l,onCancel:h,okText:t.t("payment:Issue Invoice"),cancelText:t.t("general:Cancel"),children:e.jsxs("p",{children:[t.t("payment:Please carefully check your invoice information. Once the invoice is issued, it cannot be withdrawn or modified."),e.jsx("br",{}),e.jsx("br",{}),e.jsxs(d,{size:"small",bordered:!0,children:[e.jsx(d.Item,{label:t.t("payment:Person name"),span:3,children:(c=this.state.payment)==null?void 0:c.personName}),e.jsx(d.Item,{label:t.t("payment:Person ID card"),span:3,children:(x=this.state.payment)==null?void 0:x.personIdCard}),e.jsx(d.Item,{label:t.t("payment:Person Email"),span:3,children:(u=this.state.payment)==null?void 0:u.personEmail}),e.jsx(d.Item,{label:t.t("payment:Person phone"),span:3,children:(g=this.state.payment)==null?void 0:g.personPhone}),e.jsx(d.Item,{label:t.t("payment:Invoice type"),span:3,children:((v=this.state.payment)==null?void 0:v.invoiceType)==="Individual"?t.t("payment:Individual"):t.t("general:Organization")}),e.jsx(d.Item,{label:t.t("payment:Invoice title"),span:3,children:(T=this.state.payment)==null?void 0:T.invoiceTitle}),e.jsx(d.Item,{label:t.t("payment:Invoice tax ID"),span:3,children:(j=this.state.payment)==null?void 0:j.invoiceTaxId}),e.jsx(d.Item,{label:t.t("payment:Invoice remark"),span:3,children:(I=this.state.payment)==null?void 0:I.invoiceRemark})]})]})})}renderPayment(){return e.jsxs(S,{size:"small",title:e.jsxs("div",{children:[this.state.mode==="add"?t.t("payment:New Payment"):t.t("payment:Edit Payment"),"    ",e.jsx(m,{onClick:()=>this.submitPaymentEdit(!1),children:t.t("general:Save")}),e.jsx(m,{style:{marginLeft:"20px"},type:"primary",onClick:()=>this.submitPaymentEdit(!0),children:t.t("general:Save & Exit")}),this.state.mode==="add"?e.jsx(m,{style:{marginLeft:"20px"},onClick:()=>this.deletePayment(),children:t.t("general:Cancel")}):null]}),style:s()?{margin:"5px"}:{},type:"inner",children:[e.jsxs(i,{style:{marginTop:"10px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:s()?22:2,children:[r(t.t("general:Organization"),t.t("general:Organization - Tooltip"))," :"]}),e.jsx(n,{span:22,children:e.jsx(o,{disabled:!0,value:this.state.payment.organization,onChange:a=>{}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:s()?22:2,children:[r(t.t("general:Name"),t.t("general:Name - Tooltip"))," :"]}),e.jsx(n,{span:22,children:e.jsx(o,{disabled:!0,value:this.state.payment.name,onChange:a=>{}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:s()?22:2,children:[r(t.t("general:Display name"),t.t("general:Display name - Tooltip"))," :"]}),e.jsx(n,{span:22,children:e.jsx(o,{disabled:!0,value:this.state.payment.displayName,onChange:a=>{this.updatePaymentField("displayName",a.target.value)}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:s()?22:2,children:[r(t.t("general:Provider"),t.t("general:Provider - Tooltip"))," :"]}),e.jsx(n,{span:22,children:e.jsx(o,{disabled:!0,value:this.state.payment.provider,onChange:a=>{}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:s()?22:2,children:[r(t.t("provider:Type"),t.t("payment:Type - Tooltip"))," :"]}),e.jsx(n,{span:22,children:e.jsx(o,{disabled:!0,value:this.state.payment.type,onChange:a=>{}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:s()?22:2,children:[r(t.t("payment:Product"),t.t("payment:Product - Tooltip"))," :"]}),e.jsx(n,{span:22,children:e.jsx(o,{disabled:!0,value:this.state.payment.productName,onChange:a=>{}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:s()?22:2,children:[r(t.t("product:Price"),t.t("product:Price - Tooltip"))," :"]}),e.jsx(n,{span:22,children:e.jsx(o,{disabled:!0,value:this.state.payment.price,onChange:a=>{}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:s()?22:2,children:[r(t.t("payment:Currency"),t.t("payment:Currency - Tooltip"))," :"]}),e.jsx(n,{span:22,children:e.jsx(o,{disabled:!0,value:this.state.payment.currency,onChange:a=>{}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:s()?22:2,children:[r(t.t("general:State"),t.t("general:State - Tooltip"))," :"]}),e.jsx(n,{span:22,children:e.jsx(o,{disabled:!0,value:this.state.payment.state,onChange:a=>{}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:s()?22:2,children:[r(t.t("payment:Message"),t.t("payment:Message - Tooltip"))," :"]}),e.jsx(n,{span:22,children:e.jsx(o,{disabled:!0,value:this.state.payment.message,onChange:a=>{}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:s()?22:2,children:[r(t.t("payment:Person name"),t.t("payment:Person name - Tooltip"))," :"]}),e.jsx(n,{span:22,children:e.jsx(o,{disabled:this.state.payment.invoiceUrl!=="",value:this.state.payment.personName,onChange:a=>{this.updatePaymentField("personName",a.target.value),this.state.payment.invoiceType==="Individual"&&(this.updatePaymentField("invoiceTitle",a.target.value),this.updatePaymentField("invoiceTaxId",""))}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:s()?22:2,children:[r(t.t("payment:Person ID card"),t.t("payment:Person ID card - Tooltip"))," :"]}),e.jsx(n,{span:22,children:e.jsx(o,{disabled:this.state.payment.invoiceUrl!=="",value:this.state.payment.personIdCard,onChange:a=>{this.updatePaymentField("personIdCard",a.target.value)}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:s()?22:2,children:[r(t.t("payment:Person Email"),t.t("payment:Person Email - Tooltip"))," :"]}),e.jsx(n,{span:22,children:e.jsx(o,{disabled:this.state.payment.invoiceUrl!=="",value:this.state.payment.personEmail,onChange:a=>{this.updatePaymentField("personEmail",a.target.value)}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:s()?22:2,children:[r(t.t("payment:Person phone"),t.t("payment:Person phone - Tooltip"))," :"]}),e.jsx(n,{span:22,children:e.jsx(o,{disabled:this.state.payment.invoiceUrl!=="",value:this.state.payment.personPhone,onChange:a=>{this.updatePaymentField("personPhone",a.target.value)}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:s()?22:2,children:[r(t.t("payment:Invoice type"),t.t("payment:Invoice type - Tooltip"))," :"]}),e.jsx(n,{span:22,children:e.jsx(E,{virtual:!1,disabled:this.state.payment.invoiceUrl!=="",style:{width:"100%"},value:this.state.payment.invoiceType,onChange:a=>{this.updatePaymentField("invoiceType",a),a==="Individual"&&(this.updatePaymentField("invoiceTitle",this.state.payment.personName),this.updatePaymentField("invoiceTaxId",""))},children:[{id:"Individual",name:t.t("payment:Individual")},{id:"Organization",name:t.t("general:Organization")}].map((a,l)=>e.jsx(J,{value:a.id,children:a.name},l))})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:s()?22:2,children:[r(t.t("payment:Invoice title"),t.t("payment:Invoice title - Tooltip"))," :"]}),e.jsx(n,{span:22,children:e.jsx(o,{disabled:this.state.payment.invoiceUrl!==""||this.state.payment.invoiceType==="Individual",value:this.state.payment.invoiceTitle,onChange:a=>{this.updatePaymentField("invoiceTitle",a.target.value)}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:s()?22:2,children:[r(t.t("payment:Invoice tax ID"),t.t("payment:Invoice tax ID - Tooltip"))," :"]}),e.jsx(n,{span:22,children:e.jsx(o,{disabled:this.state.payment.invoiceUrl!==""||this.state.payment.invoiceType==="Individual",value:this.state.payment.invoiceTaxId,onChange:a=>{this.updatePaymentField("invoiceTaxId",a.target.value)}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:s()?22:2,children:[r(t.t("payment:Invoice remark"),t.t("payment:Invoice remark - Tooltip"))," :"]}),e.jsx(n,{span:22,children:e.jsx(o,{disabled:this.state.payment.invoiceUrl!=="",value:this.state.payment.invoiceRemark,onChange:a=>{this.updatePaymentField("invoiceRemark",a.target.value)}})})]}),e.jsxs(i,{style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:s()?22:2,children:[r(t.t("payment:Invoice URL"),t.t("payment:Invoice URL - Tooltip"))," :"]}),e.jsx(n,{span:22,children:e.jsx(o,{disabled:!0,value:this.state.payment.invoiceUrl,onChange:a=>{this.updatePaymentField("invoiceUrl",a.target.value)}})})]}),e.jsxs(i,{id:"invoice-area",style:{marginTop:"20px"},children:[e.jsxs(n,{style:{marginTop:"5px"},span:s()?22:2,children:[r(t.t("payment:Invoice actions"),t.t("payment:Invoice actions - Tooltip"))," :"]}),e.jsxs(n,{span:22,children:[this.state.payment.invoiceUrl===""?e.jsx(m,{type:"primary",loading:this.state.isInvoiceLoading,onClick:()=>{const a=this.checkError();if(a!==""){p("error",a);return}this.setState({isModalVisible:!0})},children:t.t("payment:Issue Invoice")}):e.jsx(m,{type:"primary",onClick:()=>this.downloadInvoice(!1),children:t.t("payment:Download Invoice")}),e.jsx(m,{style:{marginLeft:"20px"},onClick:()=>L(this.state.payment.returnUrl),children:t.t("payment:Return to Website")})]})]})]})}checkError(){if(this.state.payment.state!=="Paid")return t.t("payment:Please pay the order first!");if(!M(this.state.payment.personName))return t.t("signup:Please input your real name!");if(!U(this.state.payment.personIdCard))return t.t("signup:Please input the correct ID card number!");if(!D(this.state.payment.personEmail))return t.t("signup:The input is not valid Email!");if(!C(this.state.payment.personPhone))return t.t("signup:The input is not valid Phone!");if(!C(this.state.payment.personPhone))return t.t("signup:The input is not valid Phone!");if(this.state.payment.invoiceType==="Individual"){if(this.state.payment.invoiceTitle!==this.state.payment.personName)return t.t("signup:The input is not invoice title!");if(this.state.payment.invoiceTaxId!=="")return t.t("signup:The input is not invoice Tax ID!")}else{if(!V(this.state.payment.invoiceTitle))return t.t("signup:The input is not invoice title!");if(!$(this.state.payment.invoiceTaxId))return t.t("signup:The input is not invoice Tax ID!")}return""}submitPaymentEdit(a){const l=this.checkError();if(l!==""){p("error",l);return}const h=R(this.state.payment);A(this.state.payment.owner,this.state.paymentName,h).then(c=>{c.status==="ok"?(p("success",t.t("general:Successfully saved")),this.setState({paymentName:this.state.payment.name}),a?this.props.history.push("/payments"):this.props.history.push(`/payments/${this.state.payment.name}`)):(p("error",`${t.t("general:Failed to save")}: ${c.msg}`),this.updatePaymentField("name",this.state.paymentName))}).catch(c=>{p("error",`${t.t("general:Failed to connect to server")}: ${c}`)})}deletePayment(){_(this.state.payment).then(a=>{a.status==="ok"?this.props.history.push("/payments"):p("error",`${t.t("general:Failed to delete")}: ${a.msg}`)}).catch(a=>{p("error",`${t.t("general:Failed to connect to server")}: ${a}`)})}render(){return e.jsxs("div",{children:[this.state.payment!==null?this.renderPayment():null,this.renderModal(),e.jsxs("div",{style:{marginTop:"20px",marginLeft:"40px"},children:[e.jsx(m,{size:"large",onClick:()=>this.submitPaymentEdit(!1),children:t.t("general:Save")}),e.jsx(m,{style:{marginLeft:"20px"},type:"primary",size:"large",onClick:()=>this.submitPaymentEdit(!0),children:t.t("general:Save & Exit")}),this.state.mode==="add"?e.jsx(m,{style:{marginLeft:"20px"},size:"large",onClick:()=>this.deletePayment(),children:t.t("general:Cancel")}):null]})]})}}export{Y as default};
