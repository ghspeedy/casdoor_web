import{R as p,f as c,j as t,v as x,i as s,B as n,e as o,m as d,n as l,w as r,q as g,I as h,dY as u,E as M,s as m,W as j}from"./index-ba7d0766.js";import{a as y,g as v,u as T,d as f}from"./ModelBackend-5ce35521.js";import{S as N}from"./index-ae4cddc7.js";const{Option:z}=g;class b extends p.Component{constructor(e){super(e),this.state={classes:e,organizationName:e.organizationName!==void 0?e.organizationName:e.match.params.organizationName,modelName:e.match.params.modelName,model:null,organizations:[],users:[],models:[],mode:e.location.mode!==void 0?e.location.mode:"edit"}}UNSAFE_componentWillMount(){this.getModel(),this.getOrganizations()}getModel(){y(this.state.organizationName,this.state.modelName).then(e=>{this.setState({model:e}),this.getModels(e.owner)})}getOrganizations(){c("admin").then(e=>{this.setState({organizations:e.msg===void 0?e:[]})})}getModels(e){v(e).then(a=>{this.setState({models:a})})}parseModelField(e,a){return[""].includes(e)&&(a=j(a)),a}updateModelField(e,a){a=this.parseModelField(e,a);const i=this.state.model;i[e]=a,this.setState({model:i})}renderModel(){return t.jsxs(x,{size:"small",title:t.jsxs("div",{children:[this.state.mode==="add"?s.t("model:New Model"):s.t("model:Edit Model"),"    ",t.jsx(n,{onClick:()=>this.submitModelEdit(!1),children:s.t("general:Save")}),t.jsx(n,{style:{marginLeft:"20px"},type:"primary",onClick:()=>this.submitModelEdit(!0),children:s.t("general:Save & Exit")}),this.state.mode==="add"?t.jsx(n,{style:{marginLeft:"20px"},onClick:()=>this.deleteModel(),children:s.t("general:Cancel")}):null]}),style:o()?{margin:"5px"}:{},type:"inner",children:[t.jsxs(d,{style:{marginTop:"10px"},children:[t.jsxs(l,{style:{marginTop:"5px"},span:o()?22:2,children:[r(s.t("general:Organization"),s.t("general:Organization - Tooltip"))," :"]}),t.jsx(l,{span:22,children:t.jsx(g,{virtual:!1,style:{width:"100%"},value:this.state.model.owner,onChange:e=>{this.updateModelField("owner",e)},children:this.state.organizations.map((e,a)=>t.jsx(z,{value:e.name,children:e.name},a))})})]}),t.jsxs(d,{style:{marginTop:"20px"},children:[t.jsxs(l,{style:{marginTop:"5px"},span:o()?22:2,children:[r(s.t("general:Name"),s.t("general:Name - Tooltip"))," :"]}),t.jsx(l,{span:22,children:t.jsx(h,{value:this.state.model.name,onChange:e=>{this.updateModelField("name",e.target.value)}})})]}),t.jsxs(d,{style:{marginTop:"20px"},children:[t.jsxs(l,{style:{marginTop:"5px"},span:o()?22:2,children:[r(s.t("general:Display name"),s.t("general:Display name - Tooltip"))," :"]}),t.jsx(l,{span:22,children:t.jsx(h,{value:this.state.model.displayName,onChange:e=>{this.updateModelField("displayName",e.target.value)}})})]}),t.jsxs(d,{style:{marginTop:"20px"},children:[t.jsxs(l,{style:{marginTop:"5px"},span:o()?22:2,children:[r(s.t("model:Model text"),s.t("model:Model text - Tooltip"))," :"]}),t.jsx(l,{span:22,children:t.jsx(u,{rows:10,value:this.state.model.modelText,onChange:e=>{this.updateModelField("modelText",e.target.value)}})})]}),t.jsxs(d,{style:{marginTop:"20px"},children:[t.jsxs(l,{style:{marginTop:"5px"},span:o()?19:2,children:[r(s.t("general:Is enabled"),s.t("general:Is enabled - Tooltip"))," :"]}),t.jsx(l,{span:1,children:t.jsx(N,{checked:this.state.model.isEnabled,onChange:e=>{this.updateModelField("isEnabled",e)}})})]})]})}submitModelEdit(e){const a=M(this.state.model);T(this.state.organizationName,this.state.modelName,a).then(i=>{i.status==="ok"?(m("success",s.t("general:Successfully saved")),this.setState({modelName:this.state.model.name}),e?this.props.history.push("/models"):this.props.history.push(`/models/${this.state.model.owner}/${this.state.model.name}`)):(m("error",`${s.t("general:Failed to save")}: ${i.msg}`),this.updateModelField("name",this.state.modelName))}).catch(i=>{m("error",`${s.t("general:Failed to connect to server")}: ${i}`)})}deleteModel(){f(this.state.model).then(e=>{e.status==="ok"?this.props.history.push("/models"):m("error",`${s.t("general:Failed to delete")}: ${e.msg}`)}).catch(e=>{m("error",`${s.t("general:Failed to connect to server")}: ${e}`)})}render(){return t.jsxs("div",{children:[this.state.model!==null?this.renderModel():null,t.jsxs("div",{style:{marginTop:"20px",marginLeft:"40px"},children:[t.jsx(n,{size:"large",onClick:()=>this.submitModelEdit(!1),children:s.t("general:Save")}),t.jsx(n,{style:{marginLeft:"20px"},type:"primary",size:"large",onClick:()=>this.submitModelEdit(!0),children:s.t("general:Save & Exit")}),this.state.mode==="add"?t.jsx(n,{style:{marginLeft:"20px"},size:"large",onClick:()=>this.deleteModel(),children:s.t("general:Cancel")}):null]})]})}}export{b as default};
