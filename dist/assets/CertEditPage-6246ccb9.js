import{_ as C,R as O,f as o,w as U,i as t,j as i,B as m,e as d,n as f,o as c,x as y,I as R,r as b,ac as N,s as g,F as $,X as D}from"./index-a4571b31.js";import{b as I,u as H,d as K}from"./CertBackend-a5cfe38f.js";import{I as M}from"./index-b32b9059.js";import"./UpOutlined-7082c42f.js";var E={},P={get exports(){return E},set exports(x){E=x}};(function(x,s){(function(e,l){l()})(C,function(){function e(r,a){return typeof a>"u"?a={autoBom:!1}:typeof a!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),a={autoBom:!a}),a.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(r.type)?new Blob(["\uFEFF",r],{type:r.type}):r}function l(r,a,u){var n=new XMLHttpRequest;n.open("GET",r),n.responseType="blob",n.onload=function(){T(n.response,a,u)},n.onerror=function(){console.error("could not download file")},n.send()}function L(r){var a=new XMLHttpRequest;a.open("HEAD",r,!1);try{a.send()}catch{}return 200<=a.status&&299>=a.status}function w(r){try{r.dispatchEvent(new MouseEvent("click"))}catch{var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),r.dispatchEvent(a)}}var h=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof C=="object"&&C.global===C?C:void 0,j=h.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),T=h.saveAs||(typeof window!="object"||window!==h?function(){}:"download"in HTMLAnchorElement.prototype&&!j?function(r,a,u){var n=h.URL||h.webkitURL,p=document.createElement("a");a=a||r.name||"download",p.download=a,p.rel="noopener",typeof r=="string"?(p.href=r,p.origin===location.origin?w(p):L(p.href)?l(r,a,u):w(p,p.target="_blank")):(p.href=n.createObjectURL(r),setTimeout(function(){n.revokeObjectURL(p.href)},4e4),setTimeout(function(){w(p)},0))}:"msSaveOrOpenBlob"in navigator?function(r,a,u){if(a=a||r.name||"download",typeof r!="string")navigator.msSaveOrOpenBlob(e(r,u),a);else if(L(r))l(r,a,u);else{var n=document.createElement("a");n.href=r,n.target="_blank",setTimeout(function(){w(n)})}}:function(r,a,u,n){if(n=n||open("","_blank"),n&&(n.document.title=n.document.body.innerText="downloading..."),typeof r=="string")return l(r,a,u);var p=r.type==="application/octet-stream",z=/constructor/i.test(h.HTMLElement)||h.safari,A=/CriOS\/[\d]+/.test(navigator.userAgent);if((A||p&&z||j)&&typeof FileReader<"u"){var k=new FileReader;k.onloadend=function(){var v=k.result;v=A?v:v.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=v:location=v,n=null},k.readAsDataURL(r)}else{var B=h.URL||h.webkitURL,S=B.createObjectURL(r);n?n.location=S:location.href=S,n=null,setTimeout(function(){B.revokeObjectURL(S)},4e4)}});h.saveAs=T.saveAs=T,x.exports=T})})(P);const{Option:F}=b,{TextArea:_}=R;class J extends O.Component{constructor(s){super(s),this.state={classes:s,certName:s.match.params.certName,cert:null,mode:s.location.mode!==void 0?s.location.mode:"edit"}}UNSAFE_componentWillMount(){this.getCert()}getCert(){I("admin",this.state.certName).then(s=>{this.setState({cert:s})})}parseCertField(s,e){return["port"].includes(s)&&(e=D(e)),e}updateCertField(s,e){e=this.parseCertField(s,e);const l=this.state.cert;l[s]=e,this.setState({cert:l})}renderCert(){const s=d()?22:9;return o(U,{size:"small",title:o("div",{children:[this.state.mode==="add"?t.t("cert:New Cert"):t.t("cert:Edit Cert"),"    ",i(m,{onClick:()=>this.submitCertEdit(!1),children:t.t("general:Save")}),i(m,{style:{marginLeft:"20px"},type:"primary",onClick:()=>this.submitCertEdit(!0),children:t.t("general:Save & Exit")}),this.state.mode==="add"?i(m,{style:{marginLeft:"20px"},onClick:()=>this.deleteCert(),children:t.t("general:Cancel")}):null]}),style:d()?{margin:"5px"}:{},type:"inner",children:[o(f,{style:{marginTop:"10px"},children:[o(c,{style:{marginTop:"5px"},span:d()?22:2,children:[y(t.t("general:Name"),t.t("general:Name - Tooltip"))," :"]}),i(c,{span:22,children:i(R,{value:this.state.cert.name,onChange:e=>{this.updateCertField("name",e.target.value)}})})]}),o(f,{style:{marginTop:"20px"},children:[o(c,{style:{marginTop:"5px"},span:d()?22:2,children:[y(t.t("general:Display name"),t.t("general:Display name - Tooltip"))," :"]}),i(c,{span:22,children:i(R,{value:this.state.cert.displayName,onChange:e=>{this.updateCertField("displayName",e.target.value)}})})]}),o(f,{style:{marginTop:"20px"},children:[o(c,{style:{marginTop:"5px"},span:d()?22:2,children:[y(t.t("provider:Scope"),t.t("cert:Scope - Tooltip"))," :"]}),i(c,{span:22,children:i(b,{virtual:!1,style:{width:"100%"},value:this.state.cert.scope,onChange:e=>{this.updateCertField("scope",e)},children:[{id:"JWT",name:"JWT"}].map((e,l)=>i(F,{value:e.id,children:e.name},l))})})]}),o(f,{style:{marginTop:"20px"},children:[o(c,{style:{marginTop:"5px"},span:d()?22:2,children:[y(t.t("provider:Type"),t.t("cert:Type - Tooltip"))," :"]}),i(c,{span:22,children:i(b,{virtual:!1,style:{width:"100%"},value:this.state.cert.type,onChange:e=>{this.updateCertField("type",e)},children:[{id:"x509",name:"x509"}].map((e,l)=>i(F,{value:e.id,children:e.name},l))})})]}),o(f,{style:{marginTop:"20px"},children:[o(c,{style:{marginTop:"5px"},span:d()?22:2,children:[y(t.t("cert:Crypto algorithm"),t.t("cert:Crypto algorithm - Tooltip"))," :"]}),i(c,{span:22,children:i(b,{virtual:!1,style:{width:"100%"},value:this.state.cert.cryptoAlgorithm,onChange:e=>{this.updateCertField("cryptoAlgorithm",e)},children:[{id:"RS256",name:"RS256"}].map((e,l)=>i(F,{value:e.id,children:e.name},l))})})]}),o(f,{style:{marginTop:"20px"},children:[o(c,{style:{marginTop:"5px"},span:d()?22:2,children:[y(t.t("cert:Bit size"),t.t("cert:Bit size - Tooltip"))," :"]}),i(c,{span:22,children:i(M,{value:this.state.cert.bitSize,onChange:e=>{this.updateCertField("bitSize",e)}})})]}),o(f,{style:{marginTop:"20px"},children:[o(c,{style:{marginTop:"5px"},span:d()?22:2,children:[y(t.t("cert:Expire in years"),t.t("cert:Expire in years - Tooltip"))," :"]}),i(c,{span:22,children:i(M,{value:this.state.cert.expireInYears,onChange:e=>{this.updateCertField("expireInYears",e)}})})]}),o(f,{style:{marginTop:"20px"},children:[o(c,{style:{marginTop:"5px"},span:d()?22:2,children:[y(t.t("cert:Certificate"),t.t("cert:Certificate - Tooltip"))," :"]}),o(c,{span:s,children:[i(m,{style:{marginRight:"10px",marginBottom:"10px"},onClick:()=>{N(this.state.cert.certificate),g("success",t.t("cert:Certificate copied to clipboard successfully"))},children:t.t("cert:Copy certificate")}),i(m,{type:"primary",onClick:()=>{const e=new Blob([this.state.cert.certificate],{type:"text/plain;charset=utf-8"});E.saveAs(e,"token_jwt_key.pem")},children:t.t("cert:Download certificate")}),i(_,{autoSize:{minRows:30,maxRows:30},value:this.state.cert.certificate,onChange:e=>{this.updateCertField("certificate",e.target.value)}})]}),i(c,{span:1}),o(c,{style:{marginTop:"5px"},span:d()?22:2,children:[y(t.t("cert:Private key"),t.t("cert:Private key - Tooltip"))," :"]}),o(c,{span:s,children:[i(m,{style:{marginRight:"10px",marginBottom:"10px"},onClick:()=>{N(this.state.cert.privateKey),g("success",t.t("cert:Private key copied to clipboard successfully"))},children:t.t("cert:Copy private key")}),i(m,{type:"primary",onClick:()=>{const e=new Blob([this.state.cert.privateKey],{type:"text/plain;charset=utf-8"});E.saveAs(e,"token_jwt_key.key")},children:t.t("cert:Download private key")}),i(_,{autoSize:{minRows:30,maxRows:30},value:this.state.cert.privateKey,onChange:e=>{this.updateCertField("privateKey",e.target.value)}})]})]})]})}submitCertEdit(s){const e=$(this.state.cert);H(this.state.cert.owner,this.state.certName,e).then(l=>{l.status==="ok"?(g("success",t.t("general:Successfully saved")),this.setState({certName:this.state.cert.name}),s?this.props.history.push("/certs"):this.props.history.push(`/certs/${this.state.cert.name}`)):(g("error",`${t.t("general:Failed to save")}: ${l.msg}`),this.updateCertField("name",this.state.certName))}).catch(l=>{g("error",`${t.t("general:Failed to connect to server")}: ${l}`)})}deleteCert(){K(this.state.cert).then(s=>{s.status==="ok"?this.props.history.push("/certs"):g("error",`${t.t("general:Failed to delete")}: ${s.msg}`)}).catch(s=>{g("error",`${t.t("general:Failed to connect to server")}: ${s}`)})}render(){return o("div",{children:[this.state.cert!==null?this.renderCert():null,o("div",{style:{marginTop:"20px",marginLeft:"40px"},children:[i(m,{size:"large",onClick:()=>this.submitCertEdit(!1),children:t.t("general:Save")}),i(m,{style:{marginLeft:"20px"},type:"primary",size:"large",onClick:()=>this.submitCertEdit(!0),children:t.t("general:Save & Exit")}),this.state.mode==="add"?i(m,{style:{marginLeft:"20px"},size:"large",onClick:()=>this.deleteCert(),children:t.t("general:Cancel")}):null]})]})}}export{J as default};
