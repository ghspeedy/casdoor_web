import{ah as g,ai as x,aj as h,bH as L,R as S,s as o,h as T,j as e,i as a,f as i,w as A,B as p,m as E,n as l,o as n,x as r,r as y,P as b,I as d}from"./index-a4571b31.js";import{b as z,u as w}from"./LdapBackend-d81caf60.js";import{I as u}from"./index-b32b9059.js";import{S as C}from"./index-c1f94e42.js";import"./UpOutlined-7082c42f.js";var I={icon:function(t,s){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M81.8 537.8a60.3 60.3 0 010-51.5C176.6 286.5 319.8 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c-192.1 0-335.4-100.5-430.2-300.2z",fill:s}},{tag:"path",attrs:{d:"M512 258c-161.3 0-279.4 81.8-362.7 254C232.6 684.2 350.7 766 512 766c161.4 0 279.5-81.8 362.7-254C791.4 339.8 673.3 258 512 258zm-4 430c-97.2 0-176-78.8-176-176s78.8-176 176-176 176 78.8 176 176-78.8 176-176 176z",fill:s}},{tag:"path",attrs:{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258s279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766z",fill:t}},{tag:"path",attrs:{d:"M508 336c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z",fill:t}}]}},name:"eye",theme:"twotone"};const R=I;var v=function(t,s){return g.createElement(x,h(h({},t),{},{ref:s,icon:L}))};v.displayName="EyeInvisibleOutlined";const N=g.forwardRef(v);var f=function(t,s){return g.createElement(x,h(h({},t),{},{ref:s,icon:R}))};f.displayName="EyeTwoTone";const F=g.forwardRef(f),{Option:H}=y;class M extends S.Component{constructor(t){super(t),this.state={ldapId:t.match.params.ldapId,organizationName:t.match.params.organizationName,ldap:null,organizations:[]}}UNSAFE_componentWillMount(){this.getLdap(),this.getOrganizations()}getLdap(){z(this.state.organizationName,this.state.ldapId).then(t=>{t.status==="ok"?this.setState({ldap:t.data}):o("error",t.msg)})}getOrganizations(){T("admin").then(t=>{this.setState({organizations:t.msg===void 0?t:[]})})}updateLdapField(t,s){this.setState(m=>(m.ldap[t]=s,m))}renderAutoSyncWarn(){if(this.state.ldap.autoSync>0)return e("span",{style:{color:"#faad14",marginLeft:"20px"},children:a.t("ldap:The Auto Sync option will sync all users to specify organization")})}renderLdap(){return i(A,{size:"small",title:i("div",{children:[a.t("ldap:Edit LDAP"),"    ",e(p,{onClick:()=>this.submitLdapEdit(),children:a.t("general:Save")}),e(p,{style:{marginLeft:"20px"},type:"primary",onClick:()=>this.submitLdapEdit(!0),children:a.t("general:Save & Exit")}),i(p,{style:{marginLeft:"20px"},onClick:()=>E(`/ldap/sync/${this.state.organizationName}/${this.state.ldapId}`),children:[a.t("general:Sync")," LDAP"]})]}),style:{marginLeft:"5px"},type:"inner",children:[i(l,{style:{marginTop:"10px"},children:[i(n,{style:{lineHeight:"32px",textAlign:"right",paddingRight:"25px"},span:3,children:[r(a.t("general:Organization"),a.t("general:Organization - Tooltip"))," :"]}),e(n,{span:21,children:e(y,{virtual:!1,style:{width:"100%"},disabled:!b(this.props.account),value:this.state.ldap.owner,onChange:t=>{this.updateLdapField("owner",t)},children:this.state.organizations.map((t,s)=>e(H,{value:t.name,children:t.name},s))})})]}),i(l,{style:{marginTop:"20px"},children:[i(n,{style:{lineHeight:"32px",textAlign:"right",paddingRight:"25px"},span:3,children:[r(a.t("general:ID"),a.t("general:ID - Tooltip"))," :"]}),e(n,{span:21,children:e(d,{value:this.state.ldap.id,disabled:!0})})]}),i(l,{style:{marginTop:"20px"},children:[i(n,{style:{lineHeight:"32px",textAlign:"right",paddingRight:"25px"},span:3,children:[r(a.t("ldap:Server name"),a.t("ldap:Server name - Tooltip"))," :"]}),e(n,{span:21,children:e(d,{value:this.state.ldap.serverName,onChange:t=>{this.updateLdapField("serverName",t.target.value)}})})]}),i(l,{style:{marginTop:"20px"},children:[i(n,{style:{lineHeight:"32px",textAlign:"right",paddingRight:"25px"},span:3,children:[r(a.t("ldap:Server host"),a.t("ldap:Server host - Tooltip"))," :"]}),e(n,{span:21,children:e(d,{value:this.state.ldap.host,onChange:t=>{this.updateLdapField("host",t.target.value)}})})]}),i(l,{style:{marginTop:"20px"},children:[i(n,{style:{lineHeight:"32px",textAlign:"right",paddingRight:"25px"},span:3,children:[r(a.t("ldap:Server port"),a.t("ldap:Server port - Tooltip"))," :"]}),e(n,{span:21,children:e(u,{min:0,max:65535,formatter:t=>t.replace(/\$\s?|(,*)/g,""),value:this.state.ldap.port,onChange:t=>{this.updateLdapField("port",t)}})})]}),i(l,{style:{marginTop:"20px"},children:[i(n,{style:{lineHeight:"32px",textAlign:"right",paddingRight:"25px"},span:3,children:[r(a.t("ldap:Enable SSL"),a.t("ldap:Enable SSL - Tooltip"))," :"]}),e(n,{span:21,children:e(C,{checked:this.state.ldap.enableSsl,onChange:t=>{this.updateLdapField("enableSsl",t)}})})]}),i(l,{style:{marginTop:"20px"},children:[i(n,{style:{lineHeight:"32px",textAlign:"right",paddingRight:"25px"},span:3,children:[r(a.t("ldap:Base DN"),a.t("ldap:Base DN - Tooltip"))," :"]}),e(n,{span:21,children:e(d,{value:this.state.ldap.baseDn,onChange:t=>{this.updateLdapField("baseDn",t.target.value)}})})]}),i(l,{style:{marginTop:"20px"},children:[i(n,{style:{lineHeight:"32px",textAlign:"right",paddingRight:"25px"},span:3,children:[r(a.t("ldap:Admin"),a.t("ldap:Admin - Tooltip"))," :"]}),e(n,{span:21,children:e(d,{value:this.state.ldap.admin,onChange:t=>{this.updateLdapField("admin",t.target.value)}})})]}),i(l,{style:{marginTop:"20px"},children:[i(n,{style:{lineHeight:"32px",textAlign:"right",paddingRight:"25px"},span:3,children:[r(a.t("ldap:Admin Password"),a.t("ldap:Admin Password - Tooltip"))," :"]}),e(n,{span:21,children:e(d.Password,{iconRender:t=>t?e(F,{}):e(N,{}),value:this.state.ldap.passwd,onChange:t=>{this.updateLdapField("passwd",t.target.value)}})})]}),i(l,{style:{marginTop:"20px"},children:[i(n,{style:{lineHeight:"32px",textAlign:"right",paddingRight:"25px"},span:3,children:[r(a.t("ldap:Auto Sync"),a.t("ldap:Auto Sync - Tooltip"))," :"]}),i(n,{span:21,children:[e(u,{min:0,formatter:t=>t.replace(/\$\s?|(,*)/g,""),disabled:!1,value:this.state.ldap.autoSync,onChange:t=>{this.updateLdapField("autoSync",t)}}),e("span",{children:" mins"}),this.renderAutoSyncWarn()]})]})]})}submitLdapEdit(t){w(this.state.ldap).then(s=>{s.status==="ok"?(o("success","Update LDAP server success"),this.setState({organizationName:this.state.ldap.owner}),t&&this.props.history.push(`/organizations/${this.state.organizationName}`)):o("error",s.msg)}).catch(s=>{o("error",`Update LDAP server failed: ${s}`)})}render(){return i("div",{children:[this.state.ldap!==null?this.renderLdap():null,i("div",{style:{marginTop:"20px",marginLeft:"40px"},children:[e(p,{size:"large",onClick:()=>this.submitLdapEdit(),children:a.t("general:Save")}),e(p,{style:{marginLeft:"20px"},type:"primary",size:"large",onClick:()=>this.submitLdapEdit(!0),children:a.t("general:Save & Exit")})]})]})}}export{M as default};
