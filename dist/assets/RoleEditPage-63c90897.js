import{R as u,h as y,U as R,f as i,w as x,i as s,j as a,B as d,e as n,n as r,o as l,x as h,r as p,y as g,I as c,F as T,s as m,X as f}from"./index-a4571b31.js";import{b as v,g as S,u as w,d as C}from"./RoleBackend-f32e7df6.js";import{S as b}from"./index-c1f94e42.js";class E extends u.Component{constructor(t){super(t),this.state={classes:t,organizationName:t.organizationName!==void 0?t.organizationName:t.match.params.organizationName,roleName:t.match.params.roleName,role:null,organizations:[],users:[],roles:[],mode:t.location.mode!==void 0?t.location.mode:"edit"}}UNSAFE_componentWillMount(){this.getRole(),this.getOrganizations()}getRole(){v(this.state.organizationName,this.state.roleName).then(t=>{this.setState({role:t}),this.getUsers(t.owner),this.getRoles(t.owner)})}getOrganizations(){y("admin").then(t=>{this.setState({organizations:t.msg===void 0?t:[]})})}getUsers(t){R(t).then(e=>{this.setState({users:e})})}getRoles(t){S(t).then(e=>{this.setState({roles:e})})}parseRoleField(t,e){return[""].includes(t)&&(e=f(e)),e}updateRoleField(t,e){e=this.parseRoleField(t,e);const o=this.state.role;o[t]=e,this.setState({role:o})}renderRole(){var t;return i(x,{size:"small",title:i("div",{children:[this.state.mode==="add"?s.t("role:New Role"):s.t("role:Edit Role"),"    ",a(d,{onClick:()=>this.submitRoleEdit(!1),children:s.t("general:Save")}),a(d,{style:{marginLeft:"20px"},type:"primary",onClick:()=>this.submitRoleEdit(!0),children:s.t("general:Save & Exit")}),this.state.mode==="add"?a(d,{style:{marginLeft:"20px"},onClick:()=>this.deleteRole(),children:s.t("general:Cancel")}):null]}),style:n()?{margin:"5px"}:{},type:"inner",children:[i(r,{style:{marginTop:"10px"},children:[i(l,{style:{marginTop:"5px"},span:n()?22:2,children:[h(s.t("general:Organization"),s.t("general:Organization - Tooltip"))," :"]}),a(l,{span:22,children:a(p,{virtual:!1,style:{width:"100%"},value:this.state.role.owner,onChange:e=>{this.updateRoleField("owner",e)},options:this.state.organizations.map(e=>g(e.name,e.name))})})]}),i(r,{style:{marginTop:"20px"},children:[i(l,{style:{marginTop:"5px"},span:n()?22:2,children:[h(s.t("general:Name"),s.t("general:Name - Tooltip"))," :"]}),a(l,{span:22,children:a(c,{value:this.state.role.name,onChange:e=>{this.updateRoleField("name",e.target.value)}})})]}),i(r,{style:{marginTop:"20px"},children:[i(l,{style:{marginTop:"5px"},span:n()?22:2,children:[h(s.t("general:Display name"),s.t("general:Display name - Tooltip"))," :"]}),a(l,{span:22,children:a(c,{value:this.state.role.displayName,onChange:e=>{this.updateRoleField("displayName",e.target.value)}})})]}),i(r,{style:{marginTop:"20px"},children:[i(l,{style:{marginTop:"5px"},span:n()?22:2,children:[h(s.t("role:Sub users"),s.t("role:Sub users - Tooltip"))," :"]}),a(l,{span:22,children:a(p,{mode:"tags",style:{width:"100%"},value:this.state.role.users,onChange:e=>{this.updateRoleField("users",e)},options:this.state.users.map(e=>g(`${e.owner}/${e.name}`,`${e.owner}/${e.name}`))})})]}),i(r,{style:{marginTop:"20px"},children:[i(l,{style:{marginTop:"5px"},span:n()?22:2,children:[h(s.t("role:Sub roles"),s.t("role:Sub roles - Tooltip"))," :"]}),a(l,{span:22,children:a(p,{virtual:!1,mode:"tags",style:{width:"100%"},value:this.state.role.roles,onChange:e=>{this.updateRoleField("roles",e)},options:this.state.roles.filter(e=>e.owner!==this.state.role.owner||e.name!==this.state.role.name).map(e=>g(`${e.owner}/${e.name}`,`${e.owner}/${e.name}`))})})]}),i(r,{style:{marginTop:"20px"},children:[i(l,{style:{marginTop:"5px"},span:n()?22:2,children:[h(s.t("role:Sub domains"),s.t("role:Sub domains - Tooltip"))," :"]}),a(l,{span:22,children:a(p,{virtual:!1,mode:"tags",style:{width:"100%"},value:this.state.role.domains,onChange:e=>{this.updateRoleField("domains",e)},options:(t=this.state.role.domains)==null?void 0:t.map(e=>g(e,e))})})]}),i(r,{style:{marginTop:"20px"},children:[i(l,{style:{marginTop:"5px"},span:n()?19:2,children:[h(s.t("general:Is enabled"),s.t("general:Is enabled - Tooltip"))," :"]}),a(l,{span:1,children:a(b,{checked:this.state.role.isEnabled,onChange:e=>{this.updateRoleField("isEnabled",e)}})})]})]})}submitRoleEdit(t){const e=T(this.state.role);w(this.state.organizationName,this.state.roleName,e).then(o=>{o.status==="ok"?(m("success",s.t("general:Successfully saved")),this.setState({roleName:this.state.role.name}),t?this.props.history.push("/roles"):this.props.history.push(`/roles/${this.state.role.owner}/${this.state.role.name}`)):(m("error",`${s.t("general:Failed to save")}: ${o.msg}`),this.updateRoleField("name",this.state.roleName))}).catch(o=>{m("error",`${s.t("general:Failed to connect to server")}: ${o}`)})}deleteRole(){C(this.state.role).then(t=>{t.status==="ok"?this.props.history.push("/roles"):m("error",`${s.t("general:Failed to delete")}: ${t.msg}`)}).catch(t=>{m("error",`${s.t("general:Failed to connect to server")}: ${t}`)})}render(){return i("div",{children:[this.state.role!==null?this.renderRole():null,i("div",{style:{marginTop:"20px",marginLeft:"40px"},children:[a(d,{size:"large",onClick:()=>this.submitRoleEdit(!1),children:s.t("general:Save")}),a(d,{style:{marginLeft:"20px"},type:"primary",size:"large",onClick:()=>this.submitRoleEdit(!0),children:s.t("general:Save & Exit")}),this.state.mode==="add"?a(d,{style:{marginLeft:"20px"},size:"large",onClick:()=>this.deleteRole(),children:s.t("general:Cancel")}):null]})]})}}export{E as default};
