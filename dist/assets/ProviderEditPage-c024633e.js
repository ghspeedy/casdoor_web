import{s as c,i as t,V as U,R as u,f as i,j as r,B as v,a3 as H,a4 as W,P as x,h as j,x as o,n as s,o as a,e as p,I as l,w as q,r as y,a5 as A,a0 as _,a6 as G,a7 as J,a8 as Q,a9 as X,aa as Y,ab as S,ac as k,F as K,X as Z}from"./index-a4571b31.js";import{c as ee,u as te,d as re}from"./ProviderBackend-d21ff81c.js";import{S as f}from"./index-c1f94e42.js";import{I as ie}from"./index-b32b9059.js";import{L as F}from"./LinkOutlined-e3755743.js";import"./UpOutlined-7082c42f.js";function ae(h,e){L(h,e).then(n=>{n.status==="ok"?c("success",`${t.t("provider:Email sent successfully")}`):c("error",n.msg)}).catch(n=>{c("error",`${t.t("general:Failed to connect to server")}: ${n}`)})}function oe(h){L(h).then(e=>{e.status==="ok"?c("success","provider:SMTP connected successfully"):c("error",e.msg)}).catch(e=>{c("error",`${t.t("general:Failed to connect to server")}: ${e}`)})}function L(h,e=""){const n={title:h.title,content:h.content,sender:h.displayName,receivers:e===""?["TestSmtpServer"]:[e],provider:h.name};return fetch(`${U}/api/send-email`,{method:"POST",credentials:"include",body:JSON.stringify(n)}).then(d=>d.json())}function ne(h,e){se(h,e).then(n=>{n.status==="ok"?c("success",`${t.t("provider:SMS sent successfully")}`):c("error",n.msg)}).catch(n=>{c("error",`${t.t("general:Failed to connect to server")}: ${n}`)})}function se(h,e=""){const n={content:"123456",receivers:[e]};return fetch(`${U}/api/send-sms?provider=`+h.name,{method:"POST",credentials:"include",body:JSON.stringify(n)}).then(d=>d.json())}const pe=h=>{const{owner:e,name:n,provider:d,captchaType:m,subType:C,clientId:I,clientSecret:P,clientId2:w,clientSecret2:E,providerUrl:M}=h,[D,T]=u.useState(!1),N=()=>{d.name=n,d.clientId=I,d.type=m,d.providerUrl=M,P!=="***"&&(d.clientSecret=P),T(!0)},R=()=>m!=="Default"&&(!I||!P||m==="Aliyun Captcha"&&(!C||!w||!E)),O=(z,B,V)=>{W(z,B,V).then(()=>{T(!1)})},$=()=>{T(!1)};return i(u.Fragment,{children:[r(v,{style:{fontSize:14},type:"primary",onClick:N,disabled:R(),children:t.t("general:Preview")}),r(H,{owner:e,name:n,visible:D,onOk:O,onCancel:$,isCurrentProvider:!0})]})},{Option:g}=y,{TextArea:b}=l;class me extends u.Component{constructor(e){super(e),this.state={classes:e,providerName:e.match.params.providerName,owner:e.organizationName!==void 0?e.organizationName:e.match.params.organizationName,provider:null,organizations:[],mode:e.location.mode!==void 0?e.location.mode:"edit"}}UNSAFE_componentWillMount(){this.getOrganizations(),this.getProvider()}getProvider(){ee(this.state.owner,this.state.providerName).then(e=>{this.setState({provider:e})})}getOrganizations(){x(this.props.account)&&j("admin").then(e=>{this.setState({organizations:e.msg===void 0?e:[]})})}parseProviderField(e,n){return["port"].includes(e)&&(n=Z(n)),n}updateProviderField(e,n){n=this.parseProviderField(e,n);const d=this.state.provider;d[e]=n,this.setState({provider:d})}getClientIdLabel(e){switch(e.category){case"Email":return o(t.t("signup:Username"),t.t("signup:Username - Tooltip"));case"SMS":return e.type==="Volc Engine SMS"?o(t.t("provider:Access key"),t.t("provider:Access key - Tooltip")):e.type==="Huawei Cloud SMS"?o(t.t("provider:App key"),t.t("provider:App key - Tooltip")):o(t.t("provider:Client ID"),t.t("provider:Client ID - Tooltip"));case"Captcha":return e.type==="Aliyun Captcha"?o(t.t("provider:Access key"),t.t("provider:Access key - Tooltip")):o(t.t("provider:Site key"),t.t("provider:Site key - Tooltip"));default:return o(t.t("provider:Client ID"),t.t("provider:Client ID - Tooltip"))}}getClientSecretLabel(e){switch(e.category){case"Email":return o(t.t("login:Password"),t.t("login:Password - Tooltip"));case"SMS":return e.type==="Volc Engine SMS"?o(t.t("provider:Secret access key"),t.t("provider:Secret access key - Tooltip")):e.type==="Huawei Cloud SMS"?o(t.t("provider:App secret"),t.t("provider:AppSecret - Tooltip")):o(t.t("provider:Client secret"),t.t("provider:Client secret - Tooltip"));case"Captcha":return e.type==="Aliyun Captcha"?o(t.t("provider:Secret access key"),t.t("provider:Secret access key - Tooltip")):o(t.t("provider:Secret key"),t.t("provider:Secret key - Tooltip"));default:return o(t.t("provider:Client secret"),t.t("provider:Client secret - Tooltip"))}}getAppIdRow(e){let n="",d="";return e.category==="OAuth"?e.type==="WeCom"&&e.subType==="Internal"?(n=t.t("provider:Agent ID"),d=t.t("provider:Agent ID - Tooltip")):e.type==="Infoflow"&&(n=t.t("provider:Agent ID"),d=t.t("provider:Agent ID - Tooltip")):e.category==="SMS"?e.type==="Tencent Cloud SMS"?(n=t.t("provider:App ID"),d=t.t("provider:App ID - Tooltip")):e.type==="Volc Engine SMS"?(n=t.t("provider:SMS account"),d=t.t("provider:SMS account - Tooltip")):e.type==="Huawei Cloud SMS"&&(n=t.t("provider:Channel No."),d=t.t("provider:Channel No. - Tooltip")):e.category==="Email"&&e.type==="SUBMAIL"&&(n=t.t("provider:App ID"),d=t.t("provider:App ID - Tooltip")),n===""&&d===""?null:i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(n,d)," :"]}),r(a,{span:22,children:r(l,{value:e.appId,onChange:m=>{this.updateProviderField("appId",m.target.value)}})})]})}loadSamlConfiguration(){const n=new DOMParser().parseFromString(this.state.provider.metadata,"text/xml"),d=n.getElementsByTagName("ds:X509Certificate")[0].childNodes[0].nodeValue,m=n.getElementsByTagName("md:SingleSignOnService")[0].getAttribute("Location"),C=n.getElementsByTagName("md:EntityDescriptor")[0].getAttribute("entityID");this.updateProviderField("idP",d),this.updateProviderField("endpoint",m),this.updateProviderField("issuerUrl",C)}renderProvider(){return i(q,{size:"small",title:i("div",{children:[this.state.mode==="add"?t.t("provider:New Provider"):t.t("provider:Edit Provider"),"    ",r(v,{onClick:()=>this.submitProviderEdit(!1),children:t.t("general:Save")}),r(v,{style:{marginLeft:"20px"},type:"primary",onClick:()=>this.submitProviderEdit(!0),children:t.t("general:Save & Exit")}),this.state.mode==="add"?r(v,{style:{marginLeft:"20px"},onClick:()=>this.deleteProvider(),children:t.t("general:Cancel")}):null]}),style:p()?{margin:"5px"}:{},type:"inner",children:[i(s,{style:{marginTop:"10px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("general:Name"),t.t("general:Name - Tooltip"))," :"]}),r(a,{span:22,children:r(l,{value:this.state.provider.name,onChange:e=>{this.updateProviderField("name",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("general:Display name"),t.t("general:Display name - Tooltip"))," :"]}),r(a,{span:22,children:r(l,{value:this.state.provider.displayName,onChange:e=>{this.updateProviderField("displayName",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("general:Organization"),t.t("general:Organization - Tooltip"))," :"]}),r(a,{span:22,children:i(y,{virtual:!1,style:{width:"100%"},disabled:!x(this.props.account),value:this.state.provider.owner,onChange:e=>{this.updateProviderField("owner",e)},children:[x(this.props.account)?r(g,{value:"admin",children:t.t("provider:admin (Shared)")},"admin"):null,this.state.organizations.map((e,n)=>r(g,{value:e.name,children:e.name},n))]})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("provider:Category"),t.t("provider:Category - Tooltip"))," :"]}),r(a,{span:22,children:r(y,{virtual:!1,style:{width:"100%"},value:this.state.provider.category,onChange:e=>{this.updateProviderField("category",e),e==="OAuth"?this.updateProviderField("type","GitHub"):e==="Email"?(this.updateProviderField("type","Default"),this.updateProviderField("host","smtp.example.com"),this.updateProviderField("port",465),this.updateProviderField("disableSsl",!1),this.updateProviderField("title","Casdoor Verification Code"),this.updateProviderField("content","You have requested a verification code at Casdoor. Here is your code: %s, please enter in 5 minutes."),this.updateProviderField("receiver",this.props.account.email)):e==="SMS"?this.updateProviderField("type","Aliyun SMS"):e==="Storage"?(this.updateProviderField("type","Local File System"),this.updateProviderField("domain",A())):e==="SAML"?this.updateProviderField("type","Aliyun IDaaS"):e==="Payment"?this.updateProviderField("type","Alipay"):e==="Captcha"&&this.updateProviderField("type","Default")},children:[{id:"OAuth",name:"OAuth"},{id:"Email",name:"Email"},{id:"SMS",name:"SMS"},{id:"Storage",name:"Storage"},{id:"SAML",name:"SAML"},{id:"Payment",name:"Payment"},{id:"Captcha",name:"Captcha"}].sort((e,n)=>e.name.localeCompare(n.name)).map((e,n)=>r(g,{value:e.id,children:e.name},n))})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("provider:Type"),t.t("provider:Type - Tooltip"))," :"]}),r(a,{span:22,children:r(y,{virtual:!1,style:{width:"100%"},value:this.state.provider.type,onChange:e=>{this.updateProviderField("type",e),e==="Local File System"&&this.updateProviderField("domain",A()),e==="Custom"&&(this.updateProviderField("customAuthUrl","https://door.casdoor.com/login/oauth/authorize"),this.updateProviderField("customScope","openid profile email"),this.updateProviderField("customTokenUrl","https://door.casdoor.com/api/login/oauth/access_token"),this.updateProviderField("customUserInfoUrl","https://door.casdoor.com/api/userinfo"))},children:_(this.state.provider.category).sort((e,n)=>e.name.localeCompare(n.name)).map((e,n)=>r(g,{value:e.id,children:e.name},n))})})]}),this.state.provider.type!=="WeCom"&&this.state.provider.type!=="Infoflow"&&this.state.provider.type!=="Aliyun Captcha"?null:i(u.Fragment,{children:[i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:2,children:[o(t.t("provider:Sub type"),t.t("provider:Sub type - Tooltip"))," :"]}),r(a,{span:22,children:r(y,{virtual:!1,style:{width:"100%"},value:this.state.provider.subType,onChange:e=>{this.updateProviderField("subType",e)},children:G(this.state.provider.type).map((e,n)=>r(g,{value:e.id,children:e.name},n))})})]}),this.state.provider.type!=="WeCom"?null:i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:2,children:[o(t.t("general:Method"),t.t("provider:Method - Tooltip"))," :"]}),r(a,{span:22,children:r(y,{virtual:!1,style:{width:"100%"},value:this.state.provider.method,onChange:e=>{this.updateProviderField("method",e)},children:[{name:"Normal"},{name:"Silent"}].map((e,n)=>r(g,{value:e.name,children:e.name},n))})})]})]}),this.state.provider.type!=="Custom"?null:i(u.Fragment,{children:[i(s,{style:{marginTop:"20px"},children:[r(a,{style:{marginTop:"5px"},span:p()?22:2,children:o(t.t("provider:Auth URL"),t.t("provider:Auth URL - Tooltip"))}),r(a,{span:22,children:r(l,{value:this.state.provider.customAuthUrl,onChange:e=>{this.updateProviderField("customAuthUrl",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[r(a,{style:{marginTop:"5px"},span:p()?22:2,children:o(t.t("provider:Scope"),t.t("provider:Scope - Tooltip"))}),r(a,{span:22,children:r(l,{value:this.state.provider.customScope,onChange:e=>{this.updateProviderField("customScope",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[r(a,{style:{marginTop:"5px"},span:p()?22:2,children:o(t.t("provider:Token URL"),t.t("provider:Token URL - Tooltip"))}),r(a,{span:22,children:r(l,{value:this.state.provider.customTokenUrl,onChange:e=>{this.updateProviderField("customTokenUrl",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[r(a,{style:{marginTop:"5px"},span:p()?22:2,children:o(t.t("provider:UserInfo URL"),t.t("provider:UserInfo URL - Tooltip"))}),r(a,{span:22,children:r(l,{value:this.state.provider.customUserInfoUrl,onChange:e=>{this.updateProviderField("customUserInfoUrl",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("general:Favicon"),t.t("general:Favicon - Tooltip"))," :"]}),i(a,{span:22,children:[i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:1,children:[o(t.t("general:URL"),t.t("general:URL - Tooltip"))," :"]}),r(a,{span:23,children:r(l,{prefix:r(F,{}),value:this.state.provider.customLogo,onChange:e=>{this.updateProviderField("customLogo",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:1,children:[t.t("general:Preview"),":"]}),r(a,{span:23,children:r("a",{target:"_blank",rel:"noreferrer",href:this.state.provider.customLogo,children:r("img",{src:this.state.provider.customLogo,alt:this.state.provider.customLogo,height:90,style:{marginBottom:"20px"}})})})]})]})]})]}),this.state.provider.category==="Captcha"&&this.state.provider.type==="Default"?null:i(u.Fragment,{children:[i(s,{style:{marginTop:"20px"},children:[r(a,{style:{marginTop:"5px"},span:p()?22:2,children:this.getClientIdLabel(this.state.provider)}),r(a,{span:22,children:r(l,{value:this.state.provider.clientId,onChange:e=>{this.updateProviderField("clientId",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[r(a,{style:{marginTop:"5px"},span:p()?22:2,children:this.getClientSecretLabel(this.state.provider)}),r(a,{span:22,children:r(l,{value:this.state.provider.clientSecret,onChange:e=>{this.updateProviderField("clientSecret",e.target.value)}})})]})]}),this.state.provider.type!=="WeChat"&&this.state.provider.type!=="Aliyun Captcha"?null:i(u.Fragment,{children:[i(s,{style:{marginTop:"20px"},children:[r(a,{style:{marginTop:"5px"},span:p()?22:2,children:this.state.provider.type==="Aliyun Captcha"?o(t.t("provider:Scene"),t.t("provider:Scene - Tooltip")):o(t.t("provider:Client ID 2"),t.t("provider:Client ID 2 - Tooltip"))}),r(a,{span:22,children:r(l,{value:this.state.provider.clientId2,onChange:e=>{this.updateProviderField("clientId2",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[r(a,{style:{marginTop:"5px"},span:p()?22:2,children:this.state.provider.type==="Aliyun Captcha"?o(t.t("provider:App key"),t.t("provider:App key - Tooltip")):o(t.t("provider:Client secret 2"),t.t("provider:Client secret 2 - Tooltip"))}),r(a,{span:22,children:r(l,{value:this.state.provider.clientSecret2,onChange:e=>{this.updateProviderField("clientSecret2",e.target.value)}})})]})]}),this.state.provider.type!=="WeChat"?null:i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("provider:Enable QR code"),t.t("provider:Enable QR code - Tooltip"))," :"]}),r(a,{span:1,children:r(f,{checked:this.state.provider.disableSsl,onChange:e=>{this.updateProviderField("disableSsl",e)}})})]}),this.state.provider.type!=="Adfs"&&this.state.provider.type!=="Casdoor"&&this.state.provider.type!=="Okta"?null:i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:2,children:[o(t.t("provider:Domain"),t.t("provider:Domain - Tooltip"))," :"]}),r(a,{span:22,children:r(l,{value:this.state.provider.domain,onChange:e=>{this.updateProviderField("domain",e.target.value)}})})]}),this.state.provider.category==="Storage"?i("div",{children:[i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:2,children:[o(t.t("provider:Endpoint"),t.t("provider:Region endpoint for Internet"))," :"]}),r(a,{span:22,children:r(l,{value:this.state.provider.endpoint,onChange:e=>{this.updateProviderField("endpoint",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:2,children:[o(t.t("provider:Endpoint (Intranet)"),t.t("provider:Region endpoint for Intranet"))," :"]}),r(a,{span:22,children:r(l,{value:this.state.provider.intranetEndpoint,onChange:e=>{this.updateProviderField("intranetEndpoint",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:2,children:[o(t.t("provider:Bucket"),t.t("provider:Bucket - Tooltip"))," :"]}),r(a,{span:22,children:r(l,{value:this.state.provider.bucket,onChange:e=>{this.updateProviderField("bucket",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:2,children:[o(t.t("provider:Path prefix"),t.t("provider:Path prefix - Tooltip"))," :"]}),r(a,{span:22,children:r(l,{value:this.state.provider.pathPrefix,onChange:e=>{this.updateProviderField("pathPrefix",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:2,children:[o(t.t("provider:Domain"),t.t("provider:Domain - Tooltip"))," :"]}),r(a,{span:22,children:r(l,{value:this.state.provider.domain,onChange:e=>{this.updateProviderField("domain",e.target.value)}})})]}),["AWS S3","MinIO","Tencent Cloud COS"].includes(this.state.provider.type)?i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:2,children:[o(t.t("provider:Region ID"),t.t("provider:Region ID - Tooltip"))," :"]}),r(a,{span:22,children:r(l,{value:this.state.provider.regionId,onChange:e=>{this.updateProviderField("regionId",e.target.value)}})})]}):null]}):null,this.state.provider.category==="Email"?i(u.Fragment,{children:[i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("provider:Host"),t.t("provider:Host - Tooltip"))," :"]}),r(a,{span:22,children:r(l,{prefix:r(F,{}),value:this.state.provider.host,onChange:e=>{this.updateProviderField("host",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("provider:Port"),t.t("provider:Port - Tooltip"))," :"]}),r(a,{span:22,children:r(ie,{value:this.state.provider.port,onChange:e=>{this.updateProviderField("port",e)}})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("provider:Disable SSL"),t.t("provider:Disable SSL - Tooltip"))," :"]}),r(a,{span:1,children:r(f,{checked:this.state.provider.disableSsl,onChange:e=>{this.updateProviderField("disableSsl",e)}})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("provider:Email title"),t.t("provider:Email title - Tooltip"))," :"]}),r(a,{span:22,children:r(l,{value:this.state.provider.title,onChange:e=>{this.updateProviderField("title",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("provider:Email content"),t.t("provider:Email content - Tooltip"))," :"]}),r(a,{span:22,children:r(b,{autoSize:{minRows:3,maxRows:100},value:this.state.provider.content,onChange:e=>{this.updateProviderField("content",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("provider:Test Email"),t.t("provider:Test Email - Tooltip"))," :"]}),r(a,{span:4,children:r(l,{value:this.state.provider.receiver,placeholder:t.t("user:Input your email"),onChange:e=>{this.updateProviderField("receiver",e.target.value)}})}),r(v,{style:{marginLeft:"10px",marginBottom:"5px"},type:"primary",onClick:()=>oe(this.state.provider),children:t.t("provider:Test SMTP Connection")}),r(v,{style:{marginLeft:"10px",marginBottom:"5px"},type:"primary",disabled:!J(this.state.provider.receiver),onClick:()=>ae(this.state.provider,this.state.provider.receiver),children:t.t("provider:Send Testing Email")})]})]}):this.state.provider.category==="SMS"?i(u.Fragment,{children:[this.state.provider.type==="Twilio SMS"?null:i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("provider:Sign Name"),t.t("provider:Sign Name - Tooltip"))," :"]}),r(a,{span:22,children:r(l,{value:this.state.provider.signName,onChange:e=>{this.updateProviderField("signName",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("provider:Template code"),t.t("provider:Template code - Tooltip"))," :"]}),r(a,{span:22,children:r(l,{value:this.state.provider.templateCode,onChange:e=>{this.updateProviderField("templateCode",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("provider:SMS Test"),t.t("provider:SMS Test - Tooltip"))," :"]}),r(a,{span:4,children:i(l.Group,{compact:!0,children:[r(Q,{style:{width:"30%"},value:this.state.provider.content,onChange:e=>{this.updateProviderField("content",e)},countryCodes:this.props.account.organization.countryCodes}),r(l,{value:this.state.provider.receiver,style:{width:"70%"},placeholder:t.t("user:Input your phone number"),onChange:e=>{this.updateProviderField("receiver",e.target.value)}})]})}),r(a,{span:2,children:r(v,{style:{marginLeft:"10px",marginBottom:"5px"},type:"primary",disabled:!X(this.state.provider.receiver),onClick:()=>ne(this.state.provider,"+"+Y(this.state.provider.content)+this.state.provider.receiver),children:t.t("provider:Send Testing SMS")})})]})]}):this.state.provider.category==="SAML"?i(u.Fragment,{children:[i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("provider:Sign request"),t.t("provider:Sign request - Tooltip"))," :"]}),r(a,{span:22,children:r(f,{checked:this.state.provider.enableSignAuthnRequest,onChange:e=>{this.updateProviderField("enableSignAuthnRequest",e)}})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("provider:Metadata"),t.t("provider:Metadata - Tooltip"))," :"]}),r(a,{span:22,children:r(b,{rows:4,value:this.state.provider.metadata,onChange:e=>{this.updateProviderField("metadata",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[r(a,{style:{marginTop:"5px"},span:2}),r(a,{span:2,children:r(v,{type:"primary",onClick:()=>{try{this.loadSamlConfiguration(),c("success",t.t("provider:Parse metadata successfully"))}catch{c("error",t.t("provider:Can not parse metadata"))}},children:t.t("provider:Parse")})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("provider:Endpoint"),t.t("provider:SAML 2.0 Endpoint (HTTP)"))," :"]}),r(a,{span:22,children:r(l,{value:this.state.provider.endpoint,onChange:e=>{this.updateProviderField("endpoint",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("provider:IdP"),t.t("provider:IdP certificate"))," :"]}),r(a,{span:22,children:r(l,{value:this.state.provider.idP,onChange:e=>{this.updateProviderField("idP",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("provider:Issuer URL"),t.t("provider:Issuer URL - Tooltip"))," :"]}),r(a,{span:22,children:r(l,{value:this.state.provider.issuerUrl,onChange:e=>{this.updateProviderField("issuerUrl",e.target.value)}})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("provider:SP ACS URL"),t.t("provider:SP ACS URL - Tooltip"))," :"]}),r(a,{span:21,children:r(l,{value:`${S.serverUrl}/api/acs`,readOnly:"readonly"})}),r(a,{span:1,children:r(v,{type:"primary",onClick:()=>{k(`${S.serverUrl}/api/acs`),c("success",t.t("provider:Link copied to clipboard successfully"))},children:t.t("provider:Copy")})})]}),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("provider:SP Entity ID"),t.t("provider:SP ACS URL - Tooltip"))," :"]}),r(a,{span:21,children:r(l,{value:`${S.serverUrl}/api/acs`,readOnly:"readonly"})}),r(a,{span:1,children:r(v,{type:"primary",onClick:()=>{k(`${S.serverUrl}/api/acs`),c("success",t.t("provider:Link copied to clipboard successfully"))},children:t.t("provider:Copy")})})]})]}):null,this.getAppIdRow(this.state.provider),i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("provider:Provider URL"),t.t("provider:Provider URL - Tooltip"))," :"]}),r(a,{span:22,children:r(l,{prefix:r(F,{}),value:this.state.provider.providerUrl,onChange:e=>{this.updateProviderField("providerUrl",e.target.value)}})})]}),this.state.provider.category!=="Captcha"?null:i(s,{style:{marginTop:"20px"},children:[i(a,{style:{marginTop:"5px"},span:p()?22:2,children:[o(t.t("general:Preview"),t.t("general:Preview - Tooltip"))," :"]}),r(a,{span:22,children:r(pe,{owner:this.state.provider.owner,name:this.state.provider.name,provider:this.state.provider,providerName:this.state.providerName,captchaType:this.state.provider.type,subType:this.state.provider.subType,clientId:this.state.provider.clientId,clientSecret:this.state.provider.clientSecret,clientId2:this.state.provider.clientId2,clientSecret2:this.state.provider.clientSecret2,providerUrl:this.state.provider.providerUrl})})]})]})}submitProviderEdit(e){const n=K(this.state.provider);te(this.state.owner,this.state.providerName,n).then(d=>{d.status==="ok"?(c("success",t.t("general:Successfully saved")),this.setState({owner:this.state.provider.owner,providerName:this.state.provider.name}),e?this.props.history.push("/providers"):this.props.history.push(`/providers/${this.state.provider.owner}/${this.state.provider.name}`)):(c("error",`${t.t("general:Failed to save")}: ${d.msg}`),this.updateProviderField("name",this.state.providerName))}).catch(d=>{c("error",`${t.t("general:Failed to connect to server")}: ${d}`)})}deleteProvider(){re(this.state.provider).then(e=>{e.status==="ok"?this.props.history.push("/providers"):c("error",`${t.t("general:Failed to delete")}: ${e.msg}`)}).catch(e=>{c("error",`${t.t("general:Failed to connect to server")}: ${e}`)})}render(){return i("div",{children:[this.state.provider!==null?this.renderProvider():null,i("div",{style:{marginTop:"20px",marginLeft:"40px"},children:[r(v,{size:"large",onClick:()=>this.submitProviderEdit(!1),children:t.t("general:Save")}),r(v,{style:{marginLeft:"20px"},type:"primary",size:"large",onClick:()=>this.submitProviderEdit(!0),children:t.t("general:Save & Exit")}),this.state.mode==="add"?r(v,{style:{marginLeft:"20px"},size:"large",onClick:()=>this.deleteProvider(),children:t.t("general:Cancel")}):null]})]})}}export{me as default};
