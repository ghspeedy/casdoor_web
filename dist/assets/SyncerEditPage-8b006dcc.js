import{R as f,l as k,b as I,q as x,i as a,j as t,I as h,r as m,f as n,T as v,B as y,D as R,n as o,o as r,h as L,w as z,e as l,x as d,bJ as N,F as E,s as u,X as A}from"./index-a4571b31.js";import{b as D,u as O,d as P}from"./SyncerBackend-6934f828.js";import{S as w}from"./index-c1f94e42.js";import{T as U}from"./Table-4974f722.js";import{U as $}from"./UpOutlined-fd61f12a.js";import{D as B}from"./DeleteOutlined-4c84e7f6.js";import{C as H}from"./index-70129f18.js";import"./javascript-d96a5cf8.js";import"./javascript-0700ad20.js";import{I as C}from"./index-b32b9059.js";import{L as K}from"./LinkOutlined-e3755743.js";import"./UpOutlined-7082c42f.js";import"./DeleteOutlined-25685737.js";const{Option:b}=m;class q extends f.Component{constructor(e){super(e),this.state={classes:e}}updateTable(e){this.props.onUpdateTable(e)}updateField(e,s,i,g){e[s][i]=g,this.updateTable(e)}addRow(e){const s={name:`column${e.length}`,type:"string",values:[]};e===void 0&&(e=[]),e=k(e,s),this.updateTable(e)}deleteRow(e,s){e=I(e,s),this.updateTable(e)}upRow(e,s){e=x(e,s-1,s),this.updateTable(e)}downRow(e,s){e=x(e,s,s+1),this.updateTable(e)}renderTable(e){const s=[{title:a.t("syncer:Column name"),dataIndex:"name",key:"name",render:(i,g,c)=>t(h,{value:i,onChange:p=>{this.updateField(e,c,"name",p.target.value)}})},{title:a.t("syncer:Column type"),dataIndex:"type",key:"type",render:(i,g,c)=>t(m,{virtual:!1,style:{width:"100%"},value:i,onChange:p=>{this.updateField(e,c,"type",p)},children:["string","integer","boolean"].map((p,T)=>t(b,{value:p,children:p},T))})},{title:a.t("syncer:Casdoor column"),dataIndex:"casdoorName",key:"casdoorName",render:(i,g,c)=>t(m,{virtual:!1,style:{width:"100%"},value:i,onChange:p=>{this.updateField(e,c,"casdoorName",p)},children:["Name","CreatedTime","UpdatedTime","Id","Type","Password","PasswordSalt","DisplayName","FirstName","LastName","Avatar","PermanentAvatar","Email","EmailVerified","Phone","Location","Address","Affiliation","Title","IdCardType","IdCard","Homepage","Bio","Tag","Region","Language","Gender","Birthday","Education","Score","Ranking","IsDefaultAvatar","IsOnline","IsAdmin","IsGlobalAdmin","IsForbidden","IsDeleted","CreatedIp"].map((p,T)=>t(b,{value:p,children:p},T))})},{title:a.t("syncer:Is hashed"),dataIndex:"isHashed",key:"isHashed",render:(i,g,c)=>t(w,{checked:i,onChange:p=>{this.updateField(e,c,"isHashed",p)}})},{title:a.t("general:Action"),key:"action",width:"100px",render:(i,g,c)=>n("div",{children:[t(v,{placement:"bottomLeft",title:a.t("general:Up"),children:t(y,{style:{marginRight:"5px"},disabled:c===0,icon:t($,{}),size:"small",onClick:()=>this.upRow(e,c)})}),t(v,{placement:"topLeft",title:a.t("general:Down"),children:t(y,{style:{marginRight:"5px"},disabled:c===e.length-1,icon:t(R,{}),size:"small",onClick:()=>this.downRow(e,c)})}),t(v,{placement:"topLeft",title:a.t("general:Delete"),children:t(y,{icon:t(B,{}),size:"small",onClick:()=>this.deleteRow(e,c)})})]})}];return t(U,{rowKey:"index",columns:s,dataSource:e,size:"middle",bordered:!0,pagination:!1,title:()=>n("div",{children:[this.props.title,"    ",t(y,{style:{marginRight:"5px"},type:"primary",size:"small",onClick:()=>this.addRow(e),children:a.t("general:Add")})]})})}render(){return t("div",{children:t(o,{style:{marginTop:"20px"},children:t(r,{span:24,children:this.renderTable(this.props.table)})})})}}const{Option:S}=m;class ae extends f.Component{constructor(e){super(e),this.state={classes:e,syncerName:e.match.params.syncerName,syncer:null,organizations:[],mode:e.location.mode!==void 0?e.location.mode:"edit"}}UNSAFE_componentWillMount(){this.getSyncer(),this.getOrganizations()}getSyncer(){D("admin",this.state.syncerName).then(e=>{this.setState({syncer:e})})}getOrganizations(){L("admin").then(e=>{this.setState({organizations:e.msg===void 0?e:[]})})}parseSyncerField(e,s){return["port"].includes(e)&&(s=A(s)),s}updateSyncerField(e,s){s=this.parseSyncerField(e,s);const i=this.state.syncer;i[e]=s,this.setState({syncer:i})}renderSyncer(){return n(z,{size:"small",title:n("div",{children:[this.state.mode==="add"?a.t("syncer:New Syncer"):a.t("syncer:Edit Syncer"),"    ",t(y,{onClick:()=>this.submitSyncerEdit(!1),children:a.t("general:Save")}),t(y,{style:{marginLeft:"20px"},type:"primary",onClick:()=>this.submitSyncerEdit(!0),children:a.t("general:Save & Exit")}),this.state.mode==="add"?t(y,{style:{marginLeft:"20px"},onClick:()=>this.deleteSyncer(),children:a.t("general:Cancel")}):null]}),style:l()?{margin:"5px"}:{},type:"inner",children:[n(o,{style:{marginTop:"10px"},children:[n(r,{style:{marginTop:"5px"},span:l()?22:2,children:[d(a.t("general:Organization"),a.t("general:Organization - Tooltip"))," :"]}),t(r,{span:22,children:t(m,{virtual:!1,style:{width:"100%"},value:this.state.syncer.organization,onChange:e=>{this.updateSyncerField("organization",e)},children:this.state.organizations.map((e,s)=>t(S,{value:e.name,children:e.name},s))})})]}),n(o,{style:{marginTop:"20px"},children:[n(r,{style:{marginTop:"5px"},span:l()?22:2,children:[d(a.t("general:Name"),a.t("general:Name - Tooltip"))," :"]}),t(r,{span:22,children:t(h,{value:this.state.syncer.name,onChange:e=>{this.updateSyncerField("name",e.target.value)}})})]}),n(o,{style:{marginTop:"20px"},children:[n(r,{style:{marginTop:"5px"},span:l()?22:2,children:[d(a.t("provider:Type"),a.t("provider:Type - Tooltip"))," :"]}),t(r,{span:22,children:t(m,{virtual:!1,style:{width:"100%"},value:this.state.syncer.type,onChange:e=>{this.updateSyncerField("type",e);const s=this.state.syncer;s.tableColumns=N(this.state.syncer),s.table=e==="Keycloak"?"user_entity":this.state.syncer.table,this.setState({syncer:s})},children:["Database","LDAP","Keycloak"].map((e,s)=>t(S,{value:e,children:e},s))})})]}),n(o,{style:{marginTop:"20px"},children:[n(r,{style:{marginTop:"5px"},span:l()?22:2,children:[d(a.t("provider:Host"),a.t("provider:Host - Tooltip"))," :"]}),t(r,{span:22,children:t(h,{value:this.state.syncer.host,onChange:e=>{this.updateSyncerField("host",e.target.value)}})})]}),n(o,{style:{marginTop:"20px"},children:[n(r,{style:{marginTop:"5px"},span:l()?22:2,children:[d(a.t("provider:Port"),a.t("provider:Port - Tooltip"))," :"]}),t(r,{span:22,children:t(C,{value:this.state.syncer.port,onChange:e=>{this.updateSyncerField("port",e)}})})]}),n(o,{style:{marginTop:"20px"},children:[n(r,{style:{marginTop:"5px"},span:l()?22:2,children:[d(a.t("general:User"),a.t("general:User - Tooltip"))," :"]}),t(r,{span:22,children:t(h,{value:this.state.syncer.user,onChange:e=>{this.updateSyncerField("user",e.target.value)}})})]}),n(o,{style:{marginTop:"20px"},children:[n(r,{style:{marginTop:"5px"},span:l()?22:2,children:[d(a.t("general:Password"),a.t("general:Password - Tooltip"))," :"]}),t(r,{span:22,children:t(h,{value:this.state.syncer.password,onChange:e=>{this.updateSyncerField("password",e.target.value)}})})]}),n(o,{style:{marginTop:"20px"},children:[n(r,{style:{marginTop:"5px"},span:l()?22:2,children:[d(a.t("syncer:Database type"),a.t("syncer:Database type - Tooltip"))," :"]}),t(r,{span:22,children:t(m,{virtual:!1,style:{width:"100%"},value:this.state.syncer.databaseType,onChange:e=>{this.updateSyncerField("databaseType",e)},children:[{id:"mysql",name:"MySQL"},{id:"postgres",name:"PostgreSQL"},{id:"mssql",name:"SQL Server"},{id:"oracle",name:"Oracle"},{id:"sqlite3",name:"Sqlite 3"}].map((e,s)=>t(S,{value:e.id,children:e.name},s))})})]}),n(o,{style:{marginTop:"20px"},children:[n(r,{style:{marginTop:"5px"},span:l()?22:2,children:[d(a.t("syncer:Database"),a.t("syncer:Database - Tooltip"))," :"]}),t(r,{span:22,children:t(h,{value:this.state.syncer.database,onChange:e=>{this.updateSyncerField("database",e.target.value)}})})]}),n(o,{style:{marginTop:"20px"},children:[n(r,{style:{marginTop:"5px"},span:l()?22:2,children:[d(a.t("syncer:Table"),a.t("syncer:Table - Tooltip"))," :"]}),t(r,{span:22,children:t(h,{value:this.state.syncer.table,disabled:this.state.syncer.type==="Keycloak",onChange:e=>{this.updateSyncerField("table",e.target.value)}})})]}),n(o,{style:{marginTop:"20px"},children:[n(r,{style:{marginTop:"5px"},span:l()?22:2,children:[d(a.t("syncer:Table primary key"),a.t("syncer:Table primary key - Tooltip"))," :"]}),t(r,{span:22,children:t(h,{value:this.state.syncer.tablePrimaryKey,onChange:e=>{this.updateSyncerField("tablePrimaryKey",e.target.value)}})})]}),n(o,{style:{marginTop:"20px"},children:[n(r,{style:{marginTop:"5px"},span:l()?22:2,children:[d(a.t("syncer:Table columns"),a.t("syncer:Table columns - Tooltip"))," :"]}),t(r,{span:22,children:t(q,{title:a.t("syncer:Table columns"),table:this.state.syncer.tableColumns,onUpdateTable:e=>{this.updateSyncerField("tableColumns",e)}})})]}),n(o,{style:{marginTop:"20px"},children:[n(r,{style:{marginTop:"5px"},span:l()?22:2,children:[d(a.t("syncer:Affiliation table"),a.t("syncer:Affiliation table - Tooltip"))," :"]}),t(r,{span:22,children:t(h,{value:this.state.syncer.affiliationTable,onChange:e=>{this.updateSyncerField("affiliationTable",e.target.value)}})})]}),n(o,{style:{marginTop:"20px"},children:[n(r,{style:{marginTop:"5px"},span:l()?22:2,children:[d(a.t("syncer:Avatar base URL"),a.t("syncer:Avatar base URL - Tooltip"))," :"]}),t(r,{span:22,children:t(h,{prefix:t(K,{}),value:this.state.syncer.avatarBaseUrl,onChange:e=>{this.updateSyncerField("avatarBaseUrl",e.target.value)}})})]}),n(o,{style:{marginTop:"20px"},children:[n(r,{style:{marginTop:"5px"},span:l()?22:2,children:[d(a.t("syncer:Sync interval"),a.t("syncer:Sync interval - Tooltip"))," :"]}),t(r,{span:22,children:t(C,{value:this.state.syncer.syncInterval,onChange:e=>{this.updateSyncerField("syncInterval",e)}})})]}),n(o,{style:{marginTop:"20px"},children:[n(r,{style:{marginTop:"5px"},span:l()?22:2,children:[d(a.t("syncer:Error text"),a.t("syncer:Error text - Tooltip"))," :"]}),t(r,{span:22,children:t("div",{style:{width:"100%",height:"300px"},children:t(H,{value:this.state.syncer.errorText,options:{mode:"javascript",theme:"material-darker"},onBeforeChange:(e,s,i)=>{this.updateSyncerField("errorText",i)}})})})]}),n(o,{style:{marginTop:"20px"},children:[n(r,{style:{marginTop:"5px"},span:l()?19:2,children:[d(a.t("general:Is enabled"),a.t("general:Is enabled - Tooltip"))," :"]}),t(r,{span:1,children:t(w,{checked:this.state.syncer.isEnabled,onChange:e=>{this.updateSyncerField("isEnabled",e)}})})]})]})}submitSyncerEdit(e){const s=E(this.state.syncer);O(this.state.syncer.owner,this.state.syncerName,s).then(i=>{i.status==="ok"?(u("success",a.t("general:Successfully saved")),this.setState({syncerName:this.state.syncer.name}),e?this.props.history.push("/syncers"):this.props.history.push(`/syncers/${this.state.syncer.name}`)):(u("error",`${a.t("general:Failed to save")}: ${i.msg}`),this.updateSyncerField("name",this.state.syncerName))}).catch(i=>{u("error",`${a.t("general:Failed to connect to server")}: ${i}`)})}deleteSyncer(){P(this.state.syncer).then(e=>{e.status==="ok"?this.props.history.push("/syncers"):u("error",`${a.t("general:Failed to delete")}: ${e.msg}`)}).catch(e=>{u("error",`${a.t("general:Failed to connect to server")}: ${e}`)})}render(){return n("div",{children:[this.state.syncer!==null?this.renderSyncer():null,n("div",{style:{marginTop:"20px",marginLeft:"40px"},children:[t(y,{size:"large",onClick:()=>this.submitSyncerEdit(!1),children:a.t("general:Save")}),t(y,{style:{marginLeft:"20px"},type:"primary",size:"large",onClick:()=>this.submitSyncerEdit(!0),children:a.t("general:Save & Exit")}),this.state.mode==="add"?t(y,{style:{marginLeft:"20px"},size:"large",onClick:()=>this.deleteSyncer(),children:a.t("general:Cancel")}):null]})]})}}export{ae as default};
