import{R as p,s as d,m as c,i,j as n,f as h,B as u,n as m,o as g}from"./index-a4571b31.js";import{s as f,b as y,c as x}from"./LdapBackend-d81caf60.js";import{T as U}from"./Table-4974f722.js";import{P as I}from"./index-3220aa08.js";class L extends p.Component{constructor(t){super(t),this.state={ldapId:t.match.params.ldapId,organizationName:t.match.params.organizationName,ldap:null,users:[],existUuids:[],selectedUsers:[]}}UNSAFE_componentWillMount(){this.getLdap()}syncUsers(){const t=this.state.selectedUsers;if(t===null||t.length===0){d("error","Please select al least 1 user first");return}f(this.state.ldap.owner,this.state.ldap.id,t).then(a=>{if(a.status==="ok"){const r=a.data.exist,e=a.data.failed,s=[],l=[];(!r||r.length===0)&&(!e||e.length===0)?c(`/organizations/${this.state.ldap.owner}/users`):(r&&r.length>0&&(r.forEach(o=>{s.push(o.cn)}),d("error",`User [${s}] is already exist`)),e&&e.length>0&&(e.forEach(o=>{l.push(o.cn)}),d("error",`Sync [${l}] failed`)))}else d("error",a.msg)})}getLdap(){y(this.state.organizationName,this.state.ldapId).then(t=>{t.status==="ok"?(this.setState(a=>(a.ldap=t.data,a)),this.getLdapUser()):d("error",t.msg)})}getLdapUser(){x(this.state.organizationName,this.state.ldapId).then(t=>{t.status==="ok"?this.setState(a=>{var r;return a.users=t.data.users,a.existUuids=((r=t.data2)==null?void 0:r.length)>0?t.data2:[],a}):d("error",t.msg)})}buildValArray(t,a){const r=[];return t!==null&&t.length>0&&t.forEach(e=>{const s=e[a];r.includes(s)||r.push(s)}),r}buildFilter(t,a){const r=[];return t!==null&&t.length>0&&this.buildValArray(t,a).forEach(s=>{r.push({text:s,value:s})}),r}renderTable(t){const a=[{title:i.t("ldap:CN"),dataIndex:"cn",key:"cn",sorter:(e,s)=>e.cn.localeCompare(s.cn)},{title:i.t("ldap:UidNumber / Uid"),dataIndex:"uidNumber",key:"uidNumber",width:"200px",sorter:(e,s)=>e.uidNumber.localeCompare(s.uidNumber),render:(e,s,l)=>`${e} / ${s.uid}`},{title:i.t("ldap:Group ID"),dataIndex:"groupId",key:"groupId",width:"140px",sorter:(e,s)=>e.groupId.localeCompare(s.groupId),filters:this.buildFilter(this.state.users,"groupId"),onFilter:(e,s)=>s.groupId.indexOf(e)===0},{title:i.t("general:Email"),dataIndex:"email",key:"email",width:"240px",sorter:(e,s)=>e.email.localeCompare(s.email)},{title:i.t("general:Phone"),dataIndex:"phone",key:"phone",width:"160px",sorter:(e,s)=>e.phone.localeCompare(s.phone)},{title:i.t("user:Address"),dataIndex:"address",key:"address",sorter:(e,s)=>e.address.localeCompare(s.address)}];return n("div",{children:n(U,{rowSelection:{onChange:(e,s)=>{this.setState(l=>(l.selectedUsers=s,l))},getCheckboxProps:e=>({disabled:this.state.existUuids.indexOf(e.uuid)!==-1})},columns:a,dataSource:t,rowKey:"uuid",bordered:!0,pagination:{defaultPageSize:10,showQuickJumper:!0,showSizeChanger:!0},title:()=>{var e;return h("div",{children:[n("span",{children:(e=this.state.ldap)==null?void 0:e.serverName}),n(I,{placement:"right",title:"Please confirm to sync selected users",onConfirm:()=>this.syncUsers(),children:n(u,{type:"primary",style:{marginLeft:"10px"},children:i.t("general:Sync")})}),h(u,{style:{marginLeft:"20px"},onClick:()=>c(`/ldap/${this.state.organizationName}/${this.state.ldapId}`),children:[i.t("general:Edit")," LDAP"]})]})},loading:t===null})})}render(){return h("div",{children:[n(m,{style:{width:"100%",justifyContent:"center"},children:n(g,{span:22,children:this.renderTable(this.state.users)})}),n("div",{style:{marginTop:"20px",marginLeft:"40px"},children:n(u,{style:{marginLeft:"20px"},type:"primary",size:"large",onClick:()=>{this.props.history.push(`/organizations/${this.state.organizationName}`)},children:i.t("general:Save & Exit")})})]})}}export{L as default};
