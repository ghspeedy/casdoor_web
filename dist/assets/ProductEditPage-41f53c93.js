import{R as x,f as a,w as P,i as r,j as e,B as p,e as n,n as l,o as i,x as d,I as c,r as h,F as v,s as u,X as T}from"./index-a4571b31.js";import{b as f,u as C,d as F}from"./ProductBackend-0ca51f3d.js";import{b}from"./ProviderBackend-d21ff81c.js";import N from"./ProductBuyPage-987ce728.js";import{I as m}from"./index-b32b9059.js";import{L as y}from"./LinkOutlined-e3755743.js";import"./index-26374922.js";import"./UpOutlined-7082c42f.js";const{Option:g}=h;class z extends x.Component{constructor(t){super(t),this.state={classes:t,organizationName:t.organizationName!==void 0?t.organizationName:t.match.params.organizationName,productName:t.match.params.productName,product:null,providers:[],mode:t.location.mode!==void 0?t.location.mode:"edit"}}UNSAFE_componentWillMount(){this.getProduct(),this.getPaymentProviders()}getProduct(){f("admin",this.state.productName).then(t=>{this.setState({product:t})})}getPaymentProviders(){b("admin").then(t=>{this.setState({providers:t.filter(s=>s.category==="Payment")})})}parseProductField(t,s){return[""].includes(t)&&(s=T(s)),s}updateProductField(t,s){s=this.parseProductField(t,s);const o=this.state.product;o[t]=s,this.setState({product:o})}renderProduct(){return a(P,{size:"small",title:a("div",{children:[this.state.mode==="add"?r.t("product:New Product"):r.t("product:Edit Product"),"    ",e(p,{onClick:()=>this.submitProductEdit(!1),children:r.t("general:Save")}),e(p,{style:{marginLeft:"20px"},type:"primary",onClick:()=>this.submitProductEdit(!0),children:r.t("general:Save & Exit")}),this.state.mode==="add"?e(p,{style:{marginLeft:"20px"},onClick:()=>this.deleteProduct(),children:r.t("general:Cancel")}):null]}),style:n()?{margin:"5px"}:{},type:"inner",children:[a(l,{style:{marginTop:"20px"},children:[a(i,{style:{marginTop:"5px"},span:n()?22:2,children:[d(r.t("general:Name"),r.t("general:Name - Tooltip"))," :"]}),e(i,{span:22,children:e(c,{value:this.state.product.name,onChange:t=>{this.updateProductField("name",t.target.value)}})})]}),a(l,{style:{marginTop:"20px"},children:[a(i,{style:{marginTop:"5px"},span:n()?22:2,children:[d(r.t("general:Display name"),r.t("general:Display name - Tooltip"))," :"]}),e(i,{span:22,children:e(c,{value:this.state.product.displayName,onChange:t=>{this.updateProductField("displayName",t.target.value)}})})]}),a(l,{style:{marginTop:"20px"},children:[a(i,{style:{marginTop:"5px"},span:n()?22:2,children:[d(r.t("product:Image"),r.t("product:Image - Tooltip"))," :"]}),a(i,{span:22,style:n()?{maxWidth:"100%"}:{},children:[a(l,{style:{marginTop:"20px"},children:[a(i,{style:{marginTop:"5px"},span:n()?22:1,children:[d(r.t("general:URL"),r.t("general:URL - Tooltip"))," :"]}),e(i,{span:23,children:e(c,{prefix:e(y,{}),value:this.state.product.image,onChange:t=>{this.updateProductField("image",t.target.value)}})})]}),a(l,{style:{marginTop:"20px"},children:[a(i,{style:{marginTop:"5px"},span:n()?22:1,children:[r.t("general:Preview"),":"]}),e(i,{span:23,children:e("a",{target:"_blank",rel:"noreferrer",href:this.state.product.image,children:e("img",{src:this.state.product.image,alt:this.state.product.image,height:90,style:{marginBottom:"20px"}})})})]})]})]}),a(l,{style:{marginTop:"20px"},children:[a(i,{style:{marginTop:"5px"},span:n()?22:2,children:[d(r.t("user:Tag"),r.t("product:Tag - Tooltip"))," :"]}),e(i,{span:22,children:e(c,{value:this.state.product.tag,onChange:t=>{this.updateProductField("tag",t.target.value)}})})]}),a(l,{style:{marginTop:"20px"},children:[a(i,{style:{marginTop:"5px"},span:n()?22:2,children:[d(r.t("product:Detail"),r.t("product:Detail - Tooltip"))," :"]}),e(i,{span:22,children:e(c,{value:this.state.product.detail,onChange:t=>{this.updateProductField("detail",t.target.value)}})})]}),a(l,{style:{marginTop:"20px"},children:[a(i,{style:{marginTop:"5px"},span:n()?22:2,children:[d(r.t("general:Description"),r.t("general:Description - Tooltip"))," :"]}),e(i,{span:22,children:e(c,{value:this.state.product.description,onChange:t=>{this.updateProductField("description",t.target.value)}})})]}),a(l,{style:{marginTop:"20px"},children:[a(i,{style:{marginTop:"5px"},span:n()?22:2,children:[d(r.t("payment:Currency"),r.t("payment:Currency - Tooltip"))," :"]}),e(i,{span:22,children:e(h,{virtual:!1,style:{width:"100%"},value:this.state.product.currency,onChange:t=>{this.updateProductField("currency",t)},children:[{id:"USD",name:"USD"},{id:"CNY",name:"CNY"}].map((t,s)=>e(g,{value:t.id,children:t.name},s))})})]}),a(l,{style:{marginTop:"20px"},children:[a(i,{style:{marginTop:"5px"},span:n()?22:2,children:[d(r.t("product:Price"),r.t("product:Price - Tooltip"))," :"]}),e(i,{span:22,children:e(m,{value:this.state.product.price,onChange:t=>{this.updateProductField("price",t)}})})]}),a(l,{style:{marginTop:"20px"},children:[a(i,{style:{marginTop:"5px"},span:n()?22:2,children:[d(r.t("product:Quantity"),r.t("product:Quantity - Tooltip"))," :"]}),e(i,{span:22,children:e(m,{value:this.state.product.quantity,onChange:t=>{this.updateProductField("quantity",t)}})})]}),a(l,{style:{marginTop:"20px"},children:[a(i,{style:{marginTop:"5px"},span:n()?22:2,children:[d(r.t("product:Sold"),r.t("product:Sold - Tooltip"))," :"]}),e(i,{span:22,children:e(m,{value:this.state.product.sold,onChange:t=>{this.updateProductField("sold",t)}})})]}),a(l,{style:{marginTop:"20px"},children:[a(i,{style:{marginTop:"5px"},span:n()?22:2,children:[d(r.t("product:Payment providers"),r.t("product:Payment providers - Tooltip"))," :"]}),e(i,{span:22,children:e(h,{virtual:!1,mode:"tags",style:{width:"100%"},value:this.state.product.providers,onChange:t=>{this.updateProductField("providers",t)},children:this.state.providers.map((t,s)=>e(g,{value:t.name,children:t.name},s))})})]}),a(l,{style:{marginTop:"20px"},children:[a(i,{style:{marginTop:"5px"},span:n()?22:2,children:[d(r.t("product:Return URL"),r.t("product:Return URL - Tooltip"))," :"]}),e(i,{span:22,children:e(c,{prefix:e(y,{}),value:this.state.product.returnUrl,onChange:t=>{this.updateProductField("returnUrl",t.target.value)}})})]}),a(l,{style:{marginTop:"20px"},children:[a(i,{style:{marginTop:"5px"},span:n()?22:2,children:[d(r.t("general:State"),r.t("general:State - Tooltip"))," :"]}),e(i,{span:22,children:e(h,{virtual:!1,style:{width:"100%"},value:this.state.product.state,onChange:t=>{this.updateProductField("state",t)},children:[{id:"Published",name:"Published"},{id:"Draft",name:"Draft"}].map((t,s)=>e(g,{value:t.id,children:t.name},s))})})]}),a(l,{style:{marginTop:"20px"},children:[a(i,{style:{marginTop:"5px"},span:n()?22:2,children:[d(r.t("general:Preview"),r.t("general:Preview - Tooltip"))," :"]}),this.renderPreview()]})]})}renderPreview(){const t=`/products/${this.state.product.name}/buy`;return a(i,{span:22,style:{display:"flex",flexDirection:"column"},children:[e("a",{style:{marginBottom:"10px",display:"flex"},target:"_blank",rel:"noreferrer",href:t,children:e(p,{type:"primary",children:r.t("product:Test buy page..")})}),e("br",{}),e("br",{}),e("div",{style:{width:"90%",border:"1px solid rgb(217,217,217)",boxShadow:"10px 10px 5px #888888",alignItems:"center",overflow:"auto",flexDirection:"column",flex:"auto"},children:e(N,{product:this.state.product})})]})}submitProductEdit(t){const s=v(this.state.product);C(this.state.product.owner,this.state.productName,s).then(o=>{o.status==="ok"?(u("success",r.t("general:Successfully saved")),this.setState({productName:this.state.product.name}),t?this.props.history.push("/products"):this.props.history.push(`/products/${this.state.product.name}`)):(u("error",`${r.t("general:Failed to save")}: ${o.msg}`),this.updateProductField("name",this.state.productName))}).catch(o=>{u("error",`${r.t("general:Failed to connect to server")}: ${o}`)})}deleteProduct(){F(this.state.product).then(t=>{t.status==="ok"?this.props.history.push("/products"):u("error",`${r.t("general:Failed to delete")}: ${t.msg}`)}).catch(t=>{u("error",`${r.t("general:Failed to connect to server")}: ${t}`)})}render(){return a("div",{children:[this.state.product!==null?this.renderProduct():null,a("div",{style:{marginTop:"20px",marginLeft:"40px"},children:[e(p,{size:"large",onClick:()=>this.submitProductEdit(!1),children:r.t("general:Save")}),e(p,{style:{marginLeft:"20px"},type:"primary",size:"large",onClick:()=>this.submitProductEdit(!0),children:r.t("general:Save & Exit")}),this.state.mode==="add"?e(p,{style:{marginLeft:"20px"},size:"large",onClick:()=>this.deleteProduct(),children:r.t("general:Cancel")}):null]})]})}}export{z as default};
