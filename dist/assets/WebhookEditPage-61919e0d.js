import{R as x,l as W,b as C,q as T,i as a,j as t,I as b,f as o,T as w,B as m,D as E,n as d,o as s,h as F,F as y,w as z,e as l,x as p,r as u,s as c,X as S}from"./index-a4571b31.js";import{b as R,u as L,d as N}from"./WebhookBackend-837a507a.js";import{T as O}from"./Table-4974f722.js";import{U}from"./UpOutlined-fd61f12a.js";import{D as $}from"./DeleteOutlined-4c84e7f6.js";import{C as D}from"./index-70129f18.js";import"./javascript-d96a5cf8.js";import"./javascript-0700ad20.js";import{S as v}from"./index-c1f94e42.js";import{L as I}from"./LinkOutlined-e3755743.js";import"./UpOutlined-7082c42f.js";import"./DeleteOutlined-25685737.js";class _ extends x.Component{constructor(e){super(e),this.state={classes:e}}updateTable(e){this.props.onUpdateTable(e)}updateField(e,n,i,r){e[n][i]=r,this.updateTable(e)}addRow(e){const n={name:`header-${e.length}`,value:`value-${e.length}`};e===void 0&&(e=[]),e=W(e,n),this.updateTable(e)}deleteRow(e,n){e=C(e,n),this.updateTable(e)}upRow(e,n){e=T(e,n-1,n),this.updateTable(e)}downRow(e,n){e=T(e,n,n+1),this.updateTable(e)}renderTable(e){const n=[{title:a.t("general:Name"),dataIndex:"name",key:"name",width:"250px",render:(i,r,h)=>t(b,{value:i,onChange:k=>{this.updateField(e,h,"name",k.target.value)}})},{title:a.t("webhook:Value"),dataIndex:"value",key:"value",render:(i,r,h)=>t(b,{value:i,onChange:k=>{this.updateField(e,h,"value",k.target.value)}})},{title:a.t("general:Action"),key:"action",width:"100px",render:(i,r,h)=>o("div",{children:[t(w,{placement:"bottomLeft",title:a.t("general:Up"),children:t(m,{style:{marginRight:"5px"},disabled:h===0,icon:t(U,{}),size:"small",onClick:()=>this.upRow(e,h)})}),t(w,{placement:"topLeft",title:a.t("general:Down"),children:t(m,{style:{marginRight:"5px"},disabled:h===e.length-1,icon:t(E,{}),size:"small",onClick:()=>this.downRow(e,h)})}),t(w,{placement:"topLeft",title:a.t("general:Delete"),children:t(m,{icon:t($,{}),size:"small",onClick:()=>this.deleteRow(e,h)})})]})}];return t(O,{rowKey:"index",columns:n,dataSource:e,size:"middle",bordered:!0,pagination:!1,title:()=>o("div",{children:[this.props.title,"    ",t(m,{style:{marginRight:"5px"},type:"primary",size:"small",onClick:()=>this.addRow(e),children:a.t("general:Add")})]})})}render(){return t("div",{children:t(d,{style:{marginTop:"20px"},children:t(s,{span:24,children:this.renderTable(this.props.table)})})})}}const{Option:g}=u,P={id:9078,owner:"built-in",name:"68f55b28-7380-46b1-9bde-64fe1576e3b3",createdTime:"2022-01-01T01:03:42+08:00",organization:"built-in",clientIp:"159.89.126.192",user:"admin",method:"POST",requestUri:"/api/login",action:"login",isTriggered:!1},A={owner:"built-in",name:"admin",createdTime:"2020-07-16T21:46:52+08:00",updatedTime:"",id:"9eb20f79-3bb5-4e74-99ac-39e3b9a171e8",type:"normal-user",password:"123",passwordSalt:"",displayName:"Admin",avatar:"https://cdn.casbin.com/usercontent/admin/avatar/1596241359.png",permanentAvatar:"https://cdn.casbin.com/casdoor/avatar/casbin/admin.png",email:"admin@example.com",phone:"",location:"",address:null,affiliation:"",title:"",score:1e4,ranking:10,isOnline:!1,isAdmin:!0,isGlobalAdmin:!1,isForbidden:!1,isDeleted:!1,signupApplication:"app-casnode",properties:{bio:"",checkinDate:"20200801",editorType:"",emailVerifiedTime:"2020-07-16T21:46:52+08:00",fileQuota:"50",location:"",no:"22",oauth_QQ_displayName:"",oauth_QQ_verifiedTime:"",oauth_WeChat_displayName:"",oauth_WeChat_verifiedTime:"",onlineStatus:"false",phoneVerifiedTime:"",renameQuota:"3",tagline:"",website:""}};class Z extends x.Component{constructor(e){super(e),this.state={classes:e,webhookName:e.match.params.webhookName,webhook:null,organizations:[],mode:e.location.mode!==void 0?e.location.mode:"edit"}}UNSAFE_componentWillMount(){this.getWebhook(),this.getOrganizations()}getWebhook(){R("admin",this.state.webhookName).then(e=>{this.setState({webhook:e})})}getOrganizations(){F("admin").then(e=>{this.setState({organizations:e.msg===void 0?e:[]})})}parseWebhookField(e,n){return["port"].includes(e)&&(n=S(n)),n}updateWebhookField(e,n){n=this.parseWebhookField(e,n);const i=this.state.webhook;i[e]=n,this.setState({webhook:i})}renderWebhook(){const e=y(P);this.state.webhook.isUserExtended&&(e.extendedUser=A);const n=JSON.stringify(e,null,2);return o(z,{size:"small",title:o("div",{children:[this.state.mode==="add"?a.t("webhook:New Webhook"):a.t("webhook:Edit Webhook"),"    ",t(m,{onClick:()=>this.submitWebhookEdit(!1),children:a.t("general:Save")}),t(m,{style:{marginLeft:"20px"},type:"primary",onClick:()=>this.submitWebhookEdit(!0),children:a.t("general:Save & Exit")}),this.state.mode==="add"?t(m,{style:{marginLeft:"20px"},onClick:()=>this.deleteWebhook(),children:a.t("general:Cancel")}):null]}),style:l()?{margin:"5px"}:{},type:"inner",children:[o(d,{style:{marginTop:"10px"},children:[o(s,{style:{marginTop:"5px"},span:l()?22:2,children:[p(a.t("general:Organization"),a.t("general:Organization - Tooltip"))," :"]}),t(s,{span:22,children:t(u,{virtual:!1,style:{width:"100%"},value:this.state.webhook.organization,onChange:i=>{this.updateWebhookField("organization",i)},children:this.state.organizations.map((i,r)=>t(g,{value:i.name,children:i.name},r))})})]}),o(d,{style:{marginTop:"20px"},children:[o(s,{style:{marginTop:"5px"},span:l()?22:2,children:[p(a.t("general:Name"),a.t("general:Name - Tooltip"))," :"]}),t(s,{span:22,children:t(b,{value:this.state.webhook.name,onChange:i=>{this.updateWebhookField("name",i.target.value)}})})]}),o(d,{style:{marginTop:"20px"},children:[o(s,{style:{marginTop:"5px"},span:l()?22:2,children:[p(a.t("general:URL"),a.t("general:URL - Tooltip"))," :"]}),t(s,{span:22,children:t(b,{prefix:t(I,{}),value:this.state.webhook.url,onChange:i=>{this.updateWebhookField("url",i.target.value)}})})]}),o(d,{style:{marginTop:"20px"},children:[o(s,{style:{marginTop:"5px"},span:l()?22:2,children:[p(a.t("general:Method"),a.t("webhook:Method - Tooltip"))," :"]}),t(s,{span:22,children:t(u,{virtual:!1,style:{width:"100%"},value:this.state.webhook.method,onChange:i=>{this.updateWebhookField("method",i)},children:[{id:"POST",name:"POST"},{id:"GET",name:"GET"},{id:"PUT",name:"PUT"},{id:"DELETE",name:"DELETE"}].map((i,r)=>t(g,{value:i.id,children:i.name},r))})})]}),o(d,{style:{marginTop:"20px"},children:[o(s,{style:{marginTop:"5px"},span:l()?22:2,children:[p(a.t("webhook:Content type"),a.t("webhook:Content type - Tooltip"))," :"]}),t(s,{span:22,children:t(u,{virtual:!1,style:{width:"100%"},value:this.state.webhook.contentType,onChange:i=>{this.updateWebhookField("contentType",i)},children:[{id:"application/json",name:"application/json"},{id:"application/x-www-form-urlencoded",name:"application/x-www-form-urlencoded"}].map((i,r)=>t(g,{value:i.id,children:i.name},r))})})]}),o(d,{style:{marginTop:"20px"},children:[o(s,{style:{marginTop:"5px"},span:l()?22:2,children:[p(a.t("webhook:Headers"),a.t("webhook:Headers - Tooltip"))," :"]}),t(s,{span:22,children:t(_,{title:a.t("webhook:Headers"),table:this.state.webhook.headers,onUpdateTable:i=>{this.updateWebhookField("headers",i)}})})]}),o(d,{style:{marginTop:"20px"},children:[o(s,{style:{marginTop:"5px"},span:l()?22:2,children:[p(a.t("webhook:Events"),a.t("webhook:Events - Tooltip"))," :"]}),t(s,{span:22,children:t(u,{virtual:!1,mode:"tags",style:{width:"100%"},value:this.state.webhook.events,onChange:i=>{this.updateWebhookField("events",i)},children:["signup","login","logout","add-user","update-user","add-organization","update-organization","add-provider","update-provider"].map((i,r)=>t(g,{value:i,children:i},i))})})]}),o(d,{style:{marginTop:"20px"},children:[o(s,{style:{marginTop:"5px"},span:l()?19:2,children:[p(a.t("webhook:Is user extended"),a.t("webhook:Is user extended - Tooltip"))," :"]}),t(s,{span:1,children:t(v,{checked:this.state.webhook.isUserExtended,onChange:i=>{this.updateWebhookField("isUserExtended",i)}})})]}),o(d,{style:{marginTop:"20px"},children:[o(s,{style:{marginTop:"5px"},span:l()?22:2,children:[p(a.t("general:Preview"),a.t("general:Preview - Tooltip"))," :"]}),t(s,{span:22,children:t("div",{style:{width:"900px",height:"300px"},children:t(D,{value:n,options:{mode:"javascript",theme:"material-darker"},onBeforeChange:(i,r,h)=>{}})})})]}),o(d,{style:{marginTop:"20px"},children:[o(s,{style:{marginTop:"5px"},span:l()?19:2,children:[p(a.t("general:Is enabled"),a.t("general:Is enabled - Tooltip"))," :"]}),t(s,{span:1,children:t(v,{checked:this.state.webhook.isEnabled,onChange:i=>{this.updateWebhookField("isEnabled",i)}})})]})]})}submitWebhookEdit(e){const n=y(this.state.webhook);L(this.state.webhook.owner,this.state.webhookName,n).then(i=>{i.status==="ok"?(c("success",a.t("general:Successfully saved")),this.setState({webhookName:this.state.webhook.name}),e?this.props.history.push("/webhooks"):this.props.history.push(`/webhooks/${this.state.webhook.name}`)):(c("error",`${a.t("general:Failed to save")}: ${i.msg}`),this.updateWebhookField("name",this.state.webhookName))}).catch(i=>{c("error",`${a.t("general:Failed to connect to server")}: ${i}`)})}deleteWebhook(){N(this.state.webhook).then(e=>{e.status==="ok"?this.props.history.push("/webhooks"):c("error",`${a.t("general:Failed to delete")}: ${e.msg}`)}).catch(e=>{c("error",`${a.t("general:Failed to connect to server")}: ${e}`)})}render(){return o("div",{children:[this.state.webhook!==null?this.renderWebhook():null,o("div",{style:{marginTop:"20px",marginLeft:"40px"},children:[t(m,{size:"large",onClick:()=>this.submitWebhookEdit(!1),children:a.t("general:Save")}),t(m,{style:{marginLeft:"20px"},type:"primary",size:"large",onClick:()=>this.submitWebhookEdit(!0),children:a.t("general:Save & Exit")}),this.state.mode==="add"?t(m,{style:{marginLeft:"20px"},size:"large",onClick:()=>this.deleteWebhook(),children:a.t("general:Cancel")}):null]})]})}}export{Z as default};
