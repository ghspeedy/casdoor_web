import{ah as k,ai as S,aj as b,R as w,bR as z,s as d,bS as C,i as e,j as a,bO as U,f as n,w as L,B as m,e as s,n as r,o as i,x as l,I as p,r as F,m as M,bT as D,bU as V,a7 as $,a9 as N,bV as R,bW as O,F as j,X as B}from"./index-a4571b31.js";import{b as W,i as A,u as _,d as X}from"./PaymentBackend-145b4c76.js";import{D as c}from"./index-26374922.js";var q={icon:function(t,o){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z",fill:t}},{tag:"path",attrs:{d:"M512 140c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm32 588c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V456c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272zm-32-344a48.01 48.01 0 010-96 48.01 48.01 0 010 96z",fill:o}},{tag:"path",attrs:{d:"M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z",fill:t}}]}},name:"info-circle",theme:"twotone"};const G=q;var E=function(t,o){return k.createElement(S,b(b({},t),{},{ref:o,icon:G}))};E.displayName="InfoCircleTwoTone";const H=k.forwardRef(E),{Option:J}=F;class Z extends w.Component{constructor(t){super(t),this.state={classes:t,organizationName:t.organizationName!==void 0?t.organizationName:t.match.params.organizationName,paymentName:t.match.params.paymentName,payment:null,isModalVisible:!1,isInvoiceLoading:!1,mode:t.location.mode!==void 0?t.location.mode:"edit"}}UNSAFE_componentWillMount(){this.getPayment()}getPayment(){W("admin",this.state.paymentName).then(t=>{this.setState({payment:t}),z("invoice-area")})}parsePaymentField(t,o){return[""].includes(t)&&(o=B(o)),o}updatePaymentField(t,o){o=this.parsePaymentField(t,o);const y=this.state.payment;y[t]=o,this.setState({payment:y})}issueInvoice(){this.setState({isModalVisible:!1,isInvoiceLoading:!0}),A(this.state.payment.owner,this.state.paymentName).then(t=>{this.setState({isInvoiceLoading:!1}),t.status==="ok"?(d("success","Successfully invoiced"),C(t.data),this.getPayment()):d(t.msg.includes("成功")?"info":"error",t.msg)}).catch(t=>{this.setState({isInvoiceLoading:!1}),d("error",`${e.t("general:Failed to connect to server")}: ${t}`)})}downloadInvoice(){C(this.state.payment.invoiceUrl)}renderModal(){var h,g,v,T,I,x,P,f;const t=this,o=()=>{t.issueInvoice()},y=()=>{this.setState({isModalVisible:!1})};return a(U,{title:n("div",{children:[a(H,{twoToneColor:"rgb(45,120,213)"})," "+e.t("payment:Confirm your invoice information")]}),open:this.state.isModalVisible,onOk:o,onCancel:y,okText:e.t("payment:Issue Invoice"),cancelText:e.t("general:Cancel"),children:n("p",{children:[e.t("payment:Please carefully check your invoice information. Once the invoice is issued, it cannot be withdrawn or modified."),a("br",{}),a("br",{}),n(c,{size:"small",bordered:!0,children:[a(c.Item,{label:e.t("payment:Person name"),span:3,children:(h=this.state.payment)==null?void 0:h.personName}),a(c.Item,{label:e.t("payment:Person ID card"),span:3,children:(g=this.state.payment)==null?void 0:g.personIdCard}),a(c.Item,{label:e.t("payment:Person Email"),span:3,children:(v=this.state.payment)==null?void 0:v.personEmail}),a(c.Item,{label:e.t("payment:Person phone"),span:3,children:(T=this.state.payment)==null?void 0:T.personPhone}),a(c.Item,{label:e.t("payment:Invoice type"),span:3,children:((I=this.state.payment)==null?void 0:I.invoiceType)==="Individual"?e.t("payment:Individual"):e.t("general:Organization")}),a(c.Item,{label:e.t("payment:Invoice title"),span:3,children:(x=this.state.payment)==null?void 0:x.invoiceTitle}),a(c.Item,{label:e.t("payment:Invoice tax ID"),span:3,children:(P=this.state.payment)==null?void 0:P.invoiceTaxId}),a(c.Item,{label:e.t("payment:Invoice remark"),span:3,children:(f=this.state.payment)==null?void 0:f.invoiceRemark})]})]})})}renderPayment(){return n(L,{size:"small",title:n("div",{children:[this.state.mode==="add"?e.t("payment:New Payment"):e.t("payment:Edit Payment"),"    ",a(m,{onClick:()=>this.submitPaymentEdit(!1),children:e.t("general:Save")}),a(m,{style:{marginLeft:"20px"},type:"primary",onClick:()=>this.submitPaymentEdit(!0),children:e.t("general:Save & Exit")}),this.state.mode==="add"?a(m,{style:{marginLeft:"20px"},onClick:()=>this.deletePayment(),children:e.t("general:Cancel")}):null]}),style:s()?{margin:"5px"}:{},type:"inner",children:[n(r,{style:{marginTop:"10px"},children:[n(i,{style:{marginTop:"5px"},span:s()?22:2,children:[l(e.t("general:Organization"),e.t("general:Organization - Tooltip"))," :"]}),a(i,{span:22,children:a(p,{disabled:!0,value:this.state.payment.organization,onChange:t=>{}})})]}),n(r,{style:{marginTop:"20px"},children:[n(i,{style:{marginTop:"5px"},span:s()?22:2,children:[l(e.t("general:Name"),e.t("general:Name - Tooltip"))," :"]}),a(i,{span:22,children:a(p,{disabled:!0,value:this.state.payment.name,onChange:t=>{}})})]}),n(r,{style:{marginTop:"20px"},children:[n(i,{style:{marginTop:"5px"},span:s()?22:2,children:[l(e.t("general:Display name"),e.t("general:Display name - Tooltip"))," :"]}),a(i,{span:22,children:a(p,{disabled:!0,value:this.state.payment.displayName,onChange:t=>{this.updatePaymentField("displayName",t.target.value)}})})]}),n(r,{style:{marginTop:"20px"},children:[n(i,{style:{marginTop:"5px"},span:s()?22:2,children:[l(e.t("general:Provider"),e.t("general:Provider - Tooltip"))," :"]}),a(i,{span:22,children:a(p,{disabled:!0,value:this.state.payment.provider,onChange:t=>{}})})]}),n(r,{style:{marginTop:"20px"},children:[n(i,{style:{marginTop:"5px"},span:s()?22:2,children:[l(e.t("provider:Type"),e.t("payment:Type - Tooltip"))," :"]}),a(i,{span:22,children:a(p,{disabled:!0,value:this.state.payment.type,onChange:t=>{}})})]}),n(r,{style:{marginTop:"20px"},children:[n(i,{style:{marginTop:"5px"},span:s()?22:2,children:[l(e.t("payment:Product"),e.t("payment:Product - Tooltip"))," :"]}),a(i,{span:22,children:a(p,{disabled:!0,value:this.state.payment.productName,onChange:t=>{}})})]}),n(r,{style:{marginTop:"20px"},children:[n(i,{style:{marginTop:"5px"},span:s()?22:2,children:[l(e.t("product:Price"),e.t("product:Price - Tooltip"))," :"]}),a(i,{span:22,children:a(p,{disabled:!0,value:this.state.payment.price,onChange:t=>{}})})]}),n(r,{style:{marginTop:"20px"},children:[n(i,{style:{marginTop:"5px"},span:s()?22:2,children:[l(e.t("payment:Currency"),e.t("payment:Currency - Tooltip"))," :"]}),a(i,{span:22,children:a(p,{disabled:!0,value:this.state.payment.currency,onChange:t=>{}})})]}),n(r,{style:{marginTop:"20px"},children:[n(i,{style:{marginTop:"5px"},span:s()?22:2,children:[l(e.t("general:State"),e.t("general:State - Tooltip"))," :"]}),a(i,{span:22,children:a(p,{disabled:!0,value:this.state.payment.state,onChange:t=>{}})})]}),n(r,{style:{marginTop:"20px"},children:[n(i,{style:{marginTop:"5px"},span:s()?22:2,children:[l(e.t("payment:Message"),e.t("payment:Message - Tooltip"))," :"]}),a(i,{span:22,children:a(p,{disabled:!0,value:this.state.payment.message,onChange:t=>{}})})]}),n(r,{style:{marginTop:"20px"},children:[n(i,{style:{marginTop:"5px"},span:s()?22:2,children:[l(e.t("payment:Person name"),e.t("payment:Person name - Tooltip"))," :"]}),a(i,{span:22,children:a(p,{disabled:this.state.payment.invoiceUrl!=="",value:this.state.payment.personName,onChange:t=>{this.updatePaymentField("personName",t.target.value),this.state.payment.invoiceType==="Individual"&&(this.updatePaymentField("invoiceTitle",t.target.value),this.updatePaymentField("invoiceTaxId",""))}})})]}),n(r,{style:{marginTop:"20px"},children:[n(i,{style:{marginTop:"5px"},span:s()?22:2,children:[l(e.t("payment:Person ID card"),e.t("payment:Person ID card - Tooltip"))," :"]}),a(i,{span:22,children:a(p,{disabled:this.state.payment.invoiceUrl!=="",value:this.state.payment.personIdCard,onChange:t=>{this.updatePaymentField("personIdCard",t.target.value)}})})]}),n(r,{style:{marginTop:"20px"},children:[n(i,{style:{marginTop:"5px"},span:s()?22:2,children:[l(e.t("payment:Person Email"),e.t("payment:Person Email - Tooltip"))," :"]}),a(i,{span:22,children:a(p,{disabled:this.state.payment.invoiceUrl!=="",value:this.state.payment.personEmail,onChange:t=>{this.updatePaymentField("personEmail",t.target.value)}})})]}),n(r,{style:{marginTop:"20px"},children:[n(i,{style:{marginTop:"5px"},span:s()?22:2,children:[l(e.t("payment:Person phone"),e.t("payment:Person phone - Tooltip"))," :"]}),a(i,{span:22,children:a(p,{disabled:this.state.payment.invoiceUrl!=="",value:this.state.payment.personPhone,onChange:t=>{this.updatePaymentField("personPhone",t.target.value)}})})]}),n(r,{style:{marginTop:"20px"},children:[n(i,{style:{marginTop:"5px"},span:s()?22:2,children:[l(e.t("payment:Invoice type"),e.t("payment:Invoice type - Tooltip"))," :"]}),a(i,{span:22,children:a(F,{virtual:!1,disabled:this.state.payment.invoiceUrl!=="",style:{width:"100%"},value:this.state.payment.invoiceType,onChange:t=>{this.updatePaymentField("invoiceType",t),t==="Individual"&&(this.updatePaymentField("invoiceTitle",this.state.payment.personName),this.updatePaymentField("invoiceTaxId",""))},children:[{id:"Individual",name:e.t("payment:Individual")},{id:"Organization",name:e.t("general:Organization")}].map((t,o)=>a(J,{value:t.id,children:t.name},o))})})]}),n(r,{style:{marginTop:"20px"},children:[n(i,{style:{marginTop:"5px"},span:s()?22:2,children:[l(e.t("payment:Invoice title"),e.t("payment:Invoice title - Tooltip"))," :"]}),a(i,{span:22,children:a(p,{disabled:this.state.payment.invoiceUrl!==""||this.state.payment.invoiceType==="Individual",value:this.state.payment.invoiceTitle,onChange:t=>{this.updatePaymentField("invoiceTitle",t.target.value)}})})]}),n(r,{style:{marginTop:"20px"},children:[n(i,{style:{marginTop:"5px"},span:s()?22:2,children:[l(e.t("payment:Invoice tax ID"),e.t("payment:Invoice tax ID - Tooltip"))," :"]}),a(i,{span:22,children:a(p,{disabled:this.state.payment.invoiceUrl!==""||this.state.payment.invoiceType==="Individual",value:this.state.payment.invoiceTaxId,onChange:t=>{this.updatePaymentField("invoiceTaxId",t.target.value)}})})]}),n(r,{style:{marginTop:"20px"},children:[n(i,{style:{marginTop:"5px"},span:s()?22:2,children:[l(e.t("payment:Invoice remark"),e.t("payment:Invoice remark - Tooltip"))," :"]}),a(i,{span:22,children:a(p,{disabled:this.state.payment.invoiceUrl!=="",value:this.state.payment.invoiceRemark,onChange:t=>{this.updatePaymentField("invoiceRemark",t.target.value)}})})]}),n(r,{style:{marginTop:"20px"},children:[n(i,{style:{marginTop:"5px"},span:s()?22:2,children:[l(e.t("payment:Invoice URL"),e.t("payment:Invoice URL - Tooltip"))," :"]}),a(i,{span:22,children:a(p,{disabled:!0,value:this.state.payment.invoiceUrl,onChange:t=>{this.updatePaymentField("invoiceUrl",t.target.value)}})})]}),n(r,{id:"invoice-area",style:{marginTop:"20px"},children:[n(i,{style:{marginTop:"5px"},span:s()?22:2,children:[l(e.t("payment:Invoice actions"),e.t("payment:Invoice actions - Tooltip"))," :"]}),n(i,{span:22,children:[this.state.payment.invoiceUrl===""?a(m,{type:"primary",loading:this.state.isInvoiceLoading,onClick:()=>{const t=this.checkError();if(t!==""){d("error",t);return}this.setState({isModalVisible:!0})},children:e.t("payment:Issue Invoice")}):a(m,{type:"primary",onClick:()=>this.downloadInvoice(!1),children:e.t("payment:Download Invoice")}),a(m,{style:{marginLeft:"20px"},onClick:()=>M(this.state.payment.returnUrl),children:e.t("payment:Return to Website")})]})]})]})}checkError(){if(this.state.payment.state!=="Paid")return e.t("payment:Please pay the order first!");if(!D(this.state.payment.personName))return e.t("signup:Please input your real name!");if(!V(this.state.payment.personIdCard))return e.t("signup:Please input the correct ID card number!");if(!$(this.state.payment.personEmail))return e.t("signup:The input is not valid Email!");if(!N(this.state.payment.personPhone))return e.t("signup:The input is not valid Phone!");if(!N(this.state.payment.personPhone))return e.t("signup:The input is not valid Phone!");if(this.state.payment.invoiceType==="Individual"){if(this.state.payment.invoiceTitle!==this.state.payment.personName)return e.t("signup:The input is not invoice title!");if(this.state.payment.invoiceTaxId!=="")return e.t("signup:The input is not invoice Tax ID!")}else{if(!R(this.state.payment.invoiceTitle))return e.t("signup:The input is not invoice title!");if(!O(this.state.payment.invoiceTaxId))return e.t("signup:The input is not invoice Tax ID!")}return""}submitPaymentEdit(t){const o=this.checkError();if(o!==""){d("error",o);return}const y=j(this.state.payment);_(this.state.payment.owner,this.state.paymentName,y).then(h=>{h.status==="ok"?(d("success",e.t("general:Successfully saved")),this.setState({paymentName:this.state.payment.name}),t?this.props.history.push("/payments"):this.props.history.push(`/payments/${this.state.payment.name}`)):(d("error",`${e.t("general:Failed to save")}: ${h.msg}`),this.updatePaymentField("name",this.state.paymentName))}).catch(h=>{d("error",`${e.t("general:Failed to connect to server")}: ${h}`)})}deletePayment(){X(this.state.payment).then(t=>{t.status==="ok"?this.props.history.push("/payments"):d("error",`${e.t("general:Failed to delete")}: ${t.msg}`)}).catch(t=>{d("error",`${e.t("general:Failed to connect to server")}: ${t}`)})}render(){return n("div",{children:[this.state.payment!==null?this.renderPayment():null,this.renderModal(),n("div",{style:{marginTop:"20px",marginLeft:"40px"},children:[a(m,{size:"large",onClick:()=>this.submitPaymentEdit(!1),children:e.t("general:Save")}),a(m,{style:{marginLeft:"20px"},type:"primary",size:"large",onClick:()=>this.submitPaymentEdit(!0),children:e.t("general:Save & Exit")}),this.state.mode==="add"?a(m,{style:{marginLeft:"20px"},size:"large",onClick:()=>this.deletePayment(),children:e.t("general:Cancel")}):null]})]})}}export{Z as default};
