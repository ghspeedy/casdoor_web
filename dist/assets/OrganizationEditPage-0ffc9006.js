import{R as O,s as u,i as e,l as L,b as F,j as t,L as P,f as n,B as c,m as D,n as d,o as s,p as $,q as R,r as z,t as E,T as x,D as U,u as B,v as M,w as W,e as p,x as g,I as T,y as v,z as _,A as j,C as H,E as A,F as G,G as K,H as V,d as q}from"./index-a4571b31.js";import{a as J,d as Q,g as X}from"./LdapBackend-d81caf60.js";import{P as Y}from"./PopconfirmModal-c2d7912b.js";import{T as k,R as w}from"./Table-4974f722.js";import{S as b}from"./index-c1f94e42.js";import{U as Z}from"./UpOutlined-fd61f12a.js";import{D as ee}from"./DeleteOutlined-4c84e7f6.js";import{T as ae}from"./ThemeEditor-d9332fec.js";import{L as C}from"./LinkOutlined-e3755743.js";import{I as te}from"./index-b32b9059.js";import"./index-3220aa08.js";import"./UpOutlined-7082c42f.js";import"./DeleteOutlined-25685737.js";class ie extends O.Component{constructor(a){super(a),this.state={classes:a}}updateTable(a){this.props.onUpdateTable(a)}updateField(a,o,r,l){a[o][r]=l,this.updateTable(a)}newLdap(){return{id:"",owner:this.props.organizationName,createdTime:"",serverName:"Example LDAP Server",host:"example.com",port:389,admin:"cn=admin,dc=example,dc=com",passwd:"123",baseDn:"ou=People,dc=example,dc=com",autosync:0,lastSync:""}}addRow(a){const o=this.newLdap();J(o).then(r=>{r.status==="ok"?(u("success",e.t("general:Successfully added")),a===void 0&&(a=[]),a=L(a,r.data2),this.updateTable(a)):u("error",`${e.t("general:Failed to add")}: ${r.msg}`)}).catch(r=>{u("error",`Add LDAP server failed: ${r}`)})}deleteRow(a,o){Q(a[o]).then(r=>{r.status==="ok"?(u("success",e.t("general:Successfully deleted")),a=F(a,o),this.updateTable(a)):u("error",`${e.t("general:Failed to delete")}: ${r.msg}`)}).catch(r=>{u("error",`Delete LDAP server failed: ${r}`)})}renderTable(a){const o=[{title:e.t("ldap:Server name"),dataIndex:"serverName",key:"serverName",width:"160px",sorter:(r,l)=>r.serverName.localeCompare(l.serverName),render:(r,l,i)=>t(P,{to:`/ldaps/${l.id}`,children:r})},{title:e.t("ldap:Server"),dataIndex:"host",key:"host",ellipsis:!0,sorter:(r,l)=>r.host.localeCompare(l.host),render:(r,l,i)=>`${r}:${l.port}`},{title:e.t("ldap:Base DN"),dataIndex:"baseDn",key:"baseDn",ellipsis:!0,sorter:(r,l)=>r.baseDn.localeCompare(l.baseDn)},{title:e.t("ldap:Auto Sync"),dataIndex:"autoSync",key:"autoSync",width:"120px",sorter:(r,l)=>r.autoSync.localeCompare(l.autoSync),render:(r,l,i)=>r===0?t("span",{style:{color:"#faad14"},children:"Disable"}):t("span",{style:{color:"#52c41a"},children:r+" mins"})},{title:e.t("ldap:Last Sync"),dataIndex:"lastSync",key:"lastSync",ellipsis:!0,sorter:(r,l)=>r.lastSync.localeCompare(l.lastSync),render:(r,l,i)=>r},{title:e.t("general:Action"),dataIndex:"",key:"op",width:"240px",render:(r,l,i)=>n("div",{children:[t(c,{style:{marginTop:"10px",marginBottom:"10px",marginRight:"10px"},type:"primary",onClick:()=>D(`/ldap/sync/${l.owner}/${l.id}`),children:e.t("general:Sync")}),t(c,{style:{marginTop:"10px",marginBottom:"10px",marginRight:"10px"},onClick:()=>D(`/ldap/${l.owner}/${l.id}`),children:e.t("general:Edit")}),t(Y,{title:e.t("general:Sure to delete")+`: ${l.serverName} ?`,onConfirm:()=>this.deleteRow(a,i)})]})}];return t(k,{scroll:{x:"max-content"},rowKey:"id",columns:o,dataSource:a,size:"middle",bordered:!0,pagination:!1,title:()=>n("div",{children:[this.props.title,"    ",t(c,{style:{marginRight:"5px"},type:"primary",size:"small",onClick:()=>this.addRow(a),children:e.t("general:Add")})]})})}render(){return t("div",{children:t(d,{style:{marginTop:"20px"},children:t(s,{span:24,children:this.renderTable(this.props.table)})})})}}const{Option:N}=z;class ne extends O.Component{constructor(a){super(a),this.state={classes:a}}updateTable(a){this.props.onUpdateTable(a)}updateField(a,o,r,l){a[o][r]=l,this.updateTable(a)}addRow(a){const o={name:$(a,"Please select an account item"),visible:!0,viewRule:"Public",modifyRule:"Self"};a===void 0&&(a=[]),a=L(a,o),this.updateTable(a)}deleteRow(a,o){a=F(a,o),this.updateTable(a)}upRow(a,o){a=R(a,o-1,o),this.updateTable(a)}downRow(a,o){a=R(a,o,o+1),this.updateTable(a)}renderTable(a){const o=[{title:e.t("general:Name"),dataIndex:"name",key:"name",render:(r,l,i)=>{const m=[{name:"Organization",displayName:e.t("general:Organization")},{name:"ID",displayName:e.t("general:ID")},{name:"Name",displayName:e.t("general:Name")},{name:"Display name",displayName:e.t("general:Display name")},{name:"Avatar",displayName:e.t("general:Avatar")},{name:"User type",displayName:e.t("general:User type")},{name:"Password",displayName:e.t("general:Password")},{name:"Email",displayName:e.t("general:Email")},{name:"Phone",displayName:e.t("general:Phone")},{name:"Country code",displayName:e.t("user:Country code")},{name:"Country/Region",displayName:e.t("user:Country/Region")},{name:"Location",displayName:e.t("user:Location")},{name:"Affiliation",displayName:e.t("user:Affiliation")},{name:"Title",displayName:e.t("user:Title")},{name:"Homepage",displayName:e.t("user:Homepage")},{name:"Bio",displayName:e.t("user:Bio")},{name:"Tag",displayName:e.t("user:Tag")},{name:"Signup application",displayName:e.t("general:Signup application")},{name:"Roles",displayName:e.t("general:Roles")},{name:"Permissions",displayName:e.t("general:Permissions")},{name:"3rd-party logins",displayName:e.t("user:3rd-party logins")},{name:"Properties",displayName:e.t("user:Properties")},{name:"Is admin",displayName:e.t("user:Is admin")},{name:"Is global admin",displayName:e.t("user:Is global admin")},{name:"Is forbidden",displayName:e.t("user:Is forbidden")},{name:"Is deleted",displayName:e.t("user:Is deleted")},{name:"WebAuthn credentials",displayName:e.t("user:WebAuthn credentials")},{name:"Managed accounts",displayName:e.t("user:Managed accounts")}];return t(z,{virtual:!1,style:{width:"100%"},value:(y=>{const f=m.filter(I=>I.name===y);return f.length===0?"":f[0].displayName})(r),onChange:y=>{this.updateField(a,i,"name",y)},children:E(m,a,"name").map((y,f)=>t(N,{value:y.name,children:y.displayName},f))})}},{title:e.t("organization:Visible"),dataIndex:"visible",key:"visible",width:"120px",render:(r,l,i)=>t(b,{checked:r,onChange:m=>{this.updateField(a,i,"visible",m)}})},{title:e.t("organization:View rule"),dataIndex:"viewRule",key:"viewRule",width:"155px",render:(r,l,i)=>l.visible?t(z,{virtual:!1,style:{width:"100%"},value:r,onChange:h=>{this.updateField(a,i,"viewRule",h)},children:[{id:"Public",name:"Public"},{id:"Self",name:"Self"},{id:"Admin",name:"Admin"}].map((h,y)=>t(N,{value:h.id,children:h.name},y))}):null},{title:e.t("organization:Modify rule"),dataIndex:"modifyRule",key:"modifyRule",width:"155px",render:(r,l,i)=>{if(!l.visible)return null;let m;return l.viewRule==="Admin"||l.name==="Is admin"||l.name==="Is global admin"?m=[{id:"Admin",name:"Admin"},{id:"Immutable",name:"Immutable"}]:m=[{id:"Self",name:"Self"},{id:"Admin",name:"Admin"},{id:"Immutable",name:"Immutable"}],t(z,{virtual:!1,style:{width:"100%"},value:r,onChange:h=>{this.updateField(a,i,"modifyRule",h)},children:m.map((h,y)=>t(N,{value:h.id,children:h.name},y))})}},{title:e.t("general:Action"),key:"action",width:"100px",render:(r,l,i)=>n("div",{children:[t(x,{placement:"bottomLeft",title:e.t("general:Up"),children:t(c,{style:{marginRight:"5px"},disabled:i===0,icon:t(Z,{}),size:"small",onClick:()=>this.upRow(a,i)})}),t(x,{placement:"topLeft",title:e.t("general:Down"),children:t(c,{style:{marginRight:"5px"},disabled:i===a.length-1,icon:t(U,{}),size:"small",onClick:()=>this.downRow(a,i)})}),t(x,{placement:"topLeft",title:e.t("general:Delete"),children:t(c,{icon:t(ee,{}),size:"small",onClick:()=>this.deleteRow(a,i)})})]})}];return t(k,{scroll:{x:"max-content"},rowKey:"name",columns:o,dataSource:a,size:"middle",bordered:!0,pagination:!1,title:()=>n("div",{children:[this.props.title,"    ",t(c,{style:{marginRight:"5px"},type:"primary",size:"small",onClick:()=>this.addRow(a),children:e.t("general:Add")})]})})}render(){return t("div",{children:t(d,{style:{marginTop:"20px"},children:t(s,{span:24,children:this.renderTable(this.props.table)})})})}}const{Option:re}=z;class fe extends O.Component{constructor(a){super(a),this.state={classes:a,organizationName:a.match.params.organizationName,organization:null,applications:[],ldaps:null,mode:a.location.mode!==void 0?a.location.mode:"edit"}}UNSAFE_componentWillMount(){this.getOrganization(),this.getApplications(),this.getLdaps()}getOrganization(){B("admin",this.state.organizationName).then(a=>{this.setState({organization:a})})}getApplications(){M("admin",this.state.organizationName).then(a=>{this.setState({applications:a})})}getLdaps(){X(this.state.organizationName).then(a=>{let o=[];a.status==="ok"&&a.data!==null&&(o=a.data),this.setState({ldaps:o})})}parseOrganizationField(a,o){return o}updateOrganizationField(a,o){o=this.parseOrganizationField(a,o);const r=this.state.organization;r[a]=o,this.setState({organization:r})}renderOrganization(){var a,o,r,l;return n(W,{size:"small",title:n("div",{children:[this.state.mode==="add"?e.t("organization:New Organization"):e.t("organization:Edit Organization"),"    ",t(c,{onClick:()=>this.submitOrganizationEdit(!1),children:e.t("general:Save")}),t(c,{style:{marginLeft:"20px"},type:"primary",onClick:()=>this.submitOrganizationEdit(!0),children:e.t("general:Save & Exit")}),this.state.mode==="add"?t(c,{style:{marginLeft:"20px"},onClick:()=>this.deleteOrganization(),children:e.t("general:Cancel")}):null]}),style:p()?{margin:"5px"}:{},type:"inner",children:[n(d,{style:{marginTop:"10px"},children:[n(s,{style:{marginTop:"5px"},span:p()?22:2,children:[g(e.t("general:Name"),e.t("general:Name - Tooltip"))," :"]}),t(s,{span:22,children:t(T,{value:this.state.organization.name,disabled:this.state.organization.name==="built-in",onChange:i=>{this.updateOrganizationField("name",i.target.value)}})})]}),n(d,{style:{marginTop:"20px"},children:[n(s,{style:{marginTop:"5px"},span:p()?22:2,children:[g(e.t("general:Display name"),e.t("general:Display name - Tooltip"))," :"]}),t(s,{span:22,children:t(T,{value:this.state.organization.displayName,onChange:i=>{this.updateOrganizationField("displayName",i.target.value)}})})]}),n(d,{style:{marginTop:"20px"},children:[n(s,{style:{marginTop:"5px"},span:p()?22:2,children:[g(e.t("general:Favicon"),e.t("general:Favicon - Tooltip"))," :"]}),n(s,{span:22,children:[n(d,{style:{marginTop:"20px"},children:[n(s,{style:{marginTop:"5px"},span:p()?22:1,children:[g(e.t("general:URL"),e.t("general:URL - Tooltip"))," :"]}),t(s,{span:23,children:t(T,{prefix:t(C,{}),value:this.state.organization.favicon,onChange:i=>{this.updateOrganizationField("favicon",i.target.value)}})})]}),n(d,{style:{marginTop:"20px"},children:[n(s,{style:{marginTop:"5px"},span:p()?22:1,children:[e.t("general:Preview"),":"]}),t(s,{span:23,children:t("a",{target:"_blank",rel:"noreferrer",href:this.state.organization.favicon,children:t("img",{src:this.state.organization.favicon,alt:this.state.organization.favicon,height:90,style:{marginBottom:"20px"}})})})]})]})]}),n(d,{style:{marginTop:"20px"},children:[n(s,{style:{marginTop:"5px"},span:p()?22:2,children:[g(e.t("organization:Website URL"),e.t("organization:Website URL - Tooltip"))," :"]}),t(s,{span:22,children:t(T,{prefix:t(C,{}),value:this.state.organization.websiteUrl,onChange:i=>{this.updateOrganizationField("websiteUrl",i.target.value)}})})]}),n(d,{style:{marginTop:"20px"},children:[n(s,{style:{marginTop:"5px"},span:p()?22:2,children:[g(e.t("general:Password type"),e.t("general:Password type - Tooltip"))," :"]}),t(s,{span:22,children:t(z,{virtual:!1,style:{width:"100%"},value:this.state.organization.passwordType,onChange:i=>{this.updateOrganizationField("passwordType",i)},options:["plain","salt","md5-salt","bcrypt","pbkdf2-salt","argon2id"].map(i=>v(i,i))})})]}),n(d,{style:{marginTop:"20px"},children:[n(s,{style:{marginTop:"5px"},span:p()?22:2,children:[g(e.t("general:Password salt"),e.t("general:Password salt - Tooltip"))," :"]}),t(s,{span:22,children:t(T,{value:this.state.organization.passwordSalt,onChange:i=>{this.updateOrganizationField("passwordSalt",i.target.value)}})})]}),n(d,{style:{marginTop:"20px"},children:[n(s,{style:{marginTop:"5px"},span:p()?22:2,children:[g(e.t("general:Supported country codes"),e.t("general:Supported country codes - Tooltip"))," :"]}),t(s,{span:22,children:t(z,{virtual:!1,mode:"multiple",style:{width:"100%"},value:this.state.organization.countryCodes??[],onChange:i=>{this.updateOrganizationField("countryCodes",i)},filterOption:(i,m)=>((m==null?void 0:m.text)??"").toLowerCase().includes(i.toLowerCase()),children:_().map(i=>j(i))})})]}),n(d,{style:{marginTop:"20px"},children:[n(s,{style:{marginTop:"5px"},span:p()?22:2,children:[g(e.t("general:Default avatar"),e.t("general:Default avatar - Tooltip"))," :"]}),n(s,{span:22,children:[n(d,{style:{marginTop:"20px"},children:[n(s,{style:{marginTop:"5px"},span:p()?22:1,children:[g(e.t("general:URL"),e.t("general:URL - Tooltip"))," :"]}),t(s,{span:23,children:t(T,{prefix:t(C,{}),value:this.state.organization.defaultAvatar,onChange:i=>{this.updateOrganizationField("defaultAvatar",i.target.value)}})})]}),n(d,{style:{marginTop:"20px"},children:[n(s,{style:{marginTop:"5px"},span:p()?22:1,children:[e.t("general:Preview"),":"]}),t(s,{span:23,children:t("a",{target:"_blank",rel:"noreferrer",href:this.state.organization.defaultAvatar,children:t("img",{src:this.state.organization.defaultAvatar,alt:this.state.organization.defaultAvatar,height:90,style:{marginBottom:"20px"}})})})]})]})]}),n(d,{style:{marginTop:"20px"},children:[n(s,{style:{marginTop:"5px"},span:p()?22:2,children:[g(e.t("general:Default application"),e.t("general:Default application - Tooltip"))," :"]}),t(s,{span:22,children:t(z,{virtual:!1,style:{width:"100%"},value:this.state.organization.defaultApplication,onChange:i=>{this.updateOrganizationField("defaultApplication",i)},options:(a=this.state.applications)==null?void 0:a.map(i=>v(i.name,i.name))})})]}),n(d,{style:{marginTop:"20px"},children:[n(s,{style:{marginTop:"5px"},span:p()?22:2,children:[g(e.t("organization:Tags"),e.t("organization:Tags - Tooltip"))," :"]}),t(s,{span:22,children:t(z,{virtual:!1,mode:"tags",style:{width:"100%"},value:this.state.organization.tags,onChange:i=>{this.updateOrganizationField("tags",i)},children:(o=this.state.organization.tags)==null?void 0:o.map((i,m)=>t(re,{value:i,children:i},m))})})]}),n(d,{style:{marginTop:"20px"},children:[n(s,{style:{marginTop:"5px"},span:p()?22:2,children:[g(e.t("general:Master password"),e.t("general:Master password - Tooltip"))," :"]}),t(s,{span:22,children:t(T,{value:this.state.organization.masterPassword,onChange:i=>{this.updateOrganizationField("masterPassword",i.target.value)}})})]}),n(d,{style:{marginTop:"20px"},children:[n(s,{style:{marginTop:"5px"},span:p()?22:2,children:[g(e.t("general:Languages"),e.t("general:Languages - Tooltip"))," :"]}),t(s,{span:22,children:t(z,{virtual:!1,mode:"tags",style:{width:"100%"},options:H.map(i=>v(i.label,i.key)),value:this.state.organization.languages??[],onChange:i=>{this.updateOrganizationField("languages",i)}})})]}),n(d,{style:{marginTop:"20px"},children:[n(s,{style:{marginTop:"5px"},span:p()?19:2,children:[g(e.t("organization:Init score"),e.t("organization:Init score - Tooltip"))," :"]}),t(s,{span:4,children:t(te,{value:this.state.organization.initScore,onChange:i=>{this.updateOrganizationField("initScore",i)}})})]}),n(d,{style:{marginTop:"20px"},children:[n(s,{style:{marginTop:"5px"},span:p()?19:2,children:[g(e.t("organization:Soft deletion"),e.t("organization:Soft deletion - Tooltip"))," :"]}),t(s,{span:1,children:t(b,{checked:this.state.organization.enableSoftDeletion,onChange:i=>{this.updateOrganizationField("enableSoftDeletion",i)}})})]}),n(d,{style:{marginTop:"20px"},children:[n(s,{style:{marginTop:"5px"},span:p()?19:2,children:[g(e.t("organization:Is profile public"),e.t("organization:Is profile public - Tooltip"))," :"]}),t(s,{span:1,children:t(b,{checked:this.state.organization.isProfilePublic,onChange:i=>{this.updateOrganizationField("isProfilePublic",i)}})})]}),n(d,{style:{marginTop:"20px"},children:[n(s,{style:{marginTop:"5px"},span:p()?22:2,children:[g(e.t("organization:Account items"),e.t("organization:Account items - Tooltip"))," :"]}),t(s,{span:22,children:t(ne,{title:e.t("organization:Account items"),table:this.state.organization.accountItems,onUpdateTable:i=>{this.updateOrganizationField("accountItems",i)}})})]}),n(d,{style:{marginTop:"20px"},children:[n(s,{style:{marginTop:"5px"},span:p()?22:2,children:[g(e.t("theme:Theme"),e.t("theme:Theme - Tooltip"))," :"]}),n(s,{span:22,style:{marginTop:"5px"},children:[t(d,{children:n(w.Group,{value:((r=this.state.organization.themeData)==null?void 0:r.isEnabled)??!1,onChange:i=>{const{_:m,...h}=this.state.organization.themeData??{...A,isEnabled:!1};this.updateOrganizationField("themeData",{...h,isEnabled:i.target.value})},children:[t(w.Button,{value:!1,children:e.t("organization:Follow global theme")}),t(w.Button,{value:!0,children:e.t("theme:Customize theme")})]})}),(l=this.state.organization.themeData)!=null&&l.isEnabled?t(d,{style:{marginTop:"20px"},children:t(ae,{themeData:this.state.organization.themeData,onThemeChange:(i,m)=>{const{isEnabled:h}=this.state.organization.themeData??{...A,isEnabled:!1};this.updateOrganizationField("themeData",{...m,isEnabled:h})}})}):null]})]}),n(d,{style:{marginTop:"20px"},children:[n(s,{style:{marginTop:"5px"},span:p()?22:2,children:[g(e.t("general:LDAPs"),e.t("general:LDAPs - Tooltip"))," :"]}),t(s,{span:22,children:t(ie,{title:e.t("general:LDAPs"),table:this.state.ldaps,organizationName:this.state.organizationName,onUpdateTable:i=>{this.setState({ldaps:i})}})})]})]})}submitOrganizationEdit(a){const o=G(this.state.organization);K(this.state.organization.owner,this.state.organizationName,o).then(r=>{r.status==="ok"?(u("success",e.t("general:Successfully saved")),this.props.account.organization.name===this.state.organizationName&&this.props.onChangeTheme(V(this.state.organization)),this.setState({organizationName:this.state.organization.name}),a?this.props.history.push("/organizations"):this.props.history.push(`/organizations/${this.state.organization.name}`)):(u("error",`${e.t("general:Failed to save")}: ${r.msg}`),this.updateOrganizationField("name",this.state.organizationName))}).catch(r=>{u("error",`${e.t("general:Failed to connect to server")}: ${r}`)})}deleteOrganization(){q(this.state.organization).then(a=>{a.status==="ok"?this.props.history.push("/organizations"):u("error",`${e.t("general:Failed to delete")}: ${a.msg}`)}).catch(a=>{u("error",`${e.t("general:Failed to connect to server")}: ${a}`)})}render(){return n("div",{children:[this.state.organization!==null?this.renderOrganization():null,n("div",{style:{marginTop:"20px",marginLeft:"40px"},children:[t(c,{size:"large",onClick:()=>this.submitOrganizationEdit(!1),children:e.t("general:Save")}),t(c,{style:{marginLeft:"20px"},type:"primary",size:"large",onClick:()=>this.submitOrganizationEdit(!0),children:e.t("general:Save & Exit")}),this.state.mode==="add"?t(c,{style:{marginLeft:"20px"},size:"large",onClick:()=>this.deleteOrganization(),children:e.t("general:Cancel")}):null]})]})}}export{fe as default};
