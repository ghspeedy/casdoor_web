var x=Object.defineProperty;var f=(d,s,e)=>s in d?x(d,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[s]=e;var u=(d,s,e)=>(f(d,typeof s!="symbol"?s+"":s,e),e);import{g as y,s as l,i as t,b as w,j as i,L as m,c as k,W as c,e as S,f as g,B as p,P as C,k as R}from"./index-a4571b31.js";import{h as $}from"./moment-fbc5633a.js";import{a as b,d as T,g as P}from"./RoleBackend-f32e7df6.js";import{B as I}from"./BaseListPage-cf3b6a63.js";import{P as N}from"./PopconfirmModal-c2d7912b.js";import{S as F}from"./index-c1f94e42.js";import{T as z}from"./Table-4974f722.js";import"./index-3220aa08.js";class J extends I{constructor(){super(...arguments);u(this,"fetch",(e={})=>{let o=e.searchedColumn,h=e.searchText;const r=e.sortField,a=e.sortOrder;e.type!==void 0&&e.type!==null&&(o="type",h=e.type),this.setState({loading:!0}),P(C(this.props.account)?"":this.props.account.owner,e.pagination.current,e.pagination.pageSize,o,h,r,a).then(n=>{n.status==="ok"?this.setState({loading:!1,data:n.data,pagination:{...e.pagination,total:n.data2},searchText:e.searchText,searchedColumn:e.searchedColumn}):R(n)&&this.setState({loading:!1,isAuthorized:!1})})})}newRole(){const e=y();return{owner:this.props.account.owner,name:`role_${e}`,createdTime:$().format(),displayName:`New Role - ${e}`,users:[],roles:[],domains:[],isEnabled:!0}}addRole(){const e=this.newRole();b(e).then(o=>{o.status==="ok"?(this.props.history.push({pathname:`/roles/${e.owner}/${e.name}`,mode:"add"}),l("success",t.t("general:Successfully added"))):l("error",`${t.t("general:Failed to add")}: ${o.msg}`)}).catch(o=>{l("error",`${t.t("general:Failed to connect to server")}: ${o}`)})}deleteRole(e){T(this.state.data[e]).then(o=>{o.status==="ok"?(l("success",t.t("general:Successfully deleted")),this.setState({data:w(this.state.data,e),pagination:{total:this.state.pagination.total-1}})):l("error",`${t.t("general:Failed to delete")}: ${o.msg}`)}).catch(o=>{})}renderTable(e){const o=[{title:t.t("general:Name"),dataIndex:"name",key:"name",width:"150px",fixed:"left",sorter:!0,...this.getColumnSearchProps("name"),render:(r,a,n)=>i(m,{to:`/roles/${a.owner}/${a.name}`,children:r})},{title:t.t("general:Organization"),dataIndex:"owner",key:"owner",width:"120px",sorter:!0,...this.getColumnSearchProps("owner"),render:(r,a,n)=>i(m,{to:`/organizations/${r}`,children:r})},{title:t.t("general:Created time"),dataIndex:"createdTime",key:"createdTime",width:"160px",sorter:!0,render:(r,a,n)=>k(r)},{title:t.t("general:Display name"),dataIndex:"displayName",key:"displayName",width:"200px",sorter:!0,...this.getColumnSearchProps("displayName")},{title:t.t("role:Sub users"),dataIndex:"users",key:"users",sorter:!0,...this.getColumnSearchProps("users"),render:(r,a,n)=>c(r)},{title:t.t("role:Sub roles"),dataIndex:"roles",key:"roles",sorter:!0,...this.getColumnSearchProps("roles"),render:(r,a,n)=>c(r)},{title:t.t("role:Sub domains"),dataIndex:"domains",key:"domains",sorter:!0,...this.getColumnSearchProps("domains"),render:(r,a,n)=>c(r)},{title:t.t("general:Is enabled"),dataIndex:"isEnabled",key:"isEnabled",width:"120px",sorter:!0,render:(r,a,n)=>i(F,{disabled:!0,checkedChildren:"ON",unCheckedChildren:"OFF",checked:r})},{title:t.t("general:Action"),dataIndex:"",key:"op",width:"170px",fixed:S()?"false":"right",render:(r,a,n)=>g("div",{children:[i(p,{style:{marginTop:"10px",marginBottom:"10px",marginRight:"10px"},type:"primary",onClick:()=>this.props.history.push(`/roles/${a.owner}/${a.name}`),children:t.t("general:Edit")}),i(N,{title:t.t("general:Sure to delete")+`: ${a.name} ?`,onConfirm:()=>this.deleteRole(n)})]})}],h={total:this.state.pagination.total,showQuickJumper:!0,showSizeChanger:!0,showTotal:()=>t.t("general:{total} in total").replace("{total}",this.state.pagination.total)};return i("div",{children:i(z,{scroll:{x:"max-content"},columns:o,dataSource:e,rowKey:"name",size:"middle",bordered:!0,pagination:h,title:()=>g("div",{children:[t.t("general:Roles"),"    ",i(p,{type:"primary",size:"small",onClick:this.addRole.bind(this),children:t.t("general:Add")})]}),loading:this.state.loading,onChange:this.handleTableChange})})}}export{J as default};
