var v=Object.defineProperty;var y=(s,o,e)=>o in s?v(s,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[o]=e;var p=(s,o,e)=>(y(s,typeof o!="symbol"?o+"":o,e),e);import{P as c,g as S,s as u,i as r,b as f,j as d,L as P,c as w,a0 as l,a1 as C,a2 as g,e as k,f as m,B as x,k as $}from"./index-a4571b31.js";import{h as M}from"./moment-fbc5633a.js";import{a as A,d as T,g as b,b as I}from"./ProviderBackend-d21ff81c.js";import{B as L}from"./BaseListPage-cf3b6a63.js";import{P as O}from"./PopconfirmModal-c2d7912b.js";import{T as N}from"./Table-4974f722.js";import"./index-3220aa08.js";class G extends L{constructor(e){super(e);p(this,"fetch",(e={})=>{let a=e.searchedColumn,h=e.searchText;const t=e.sortField,i=e.sortOrder;e.category!==void 0&&e.category!==null?(a="category",h=e.category):e.type!==void 0&&e.type!==null&&(a="type",h=e.type),this.setState({loading:!0}),(c(this.props.account)?b(e.pagination.current,e.pagination.pageSize,a,h,t,i):I(this.state.owner,e.pagination.current,e.pagination.pageSize,a,h,t,i)).then(n=>{n.status==="ok"?this.setState({loading:!1,data:n.data,pagination:{...e.pagination,total:n.data2},searchText:e.searchText,searchedColumn:e.searchedColumn}):$(n)&&this.setState({loading:!1,isAuthorized:!1})})})}componentDidMount(){this.setState({owner:c(this.props.account)?"admin":this.props.account.owner})}newProvider(){const e=S();return{owner:this.state.owner,name:`provider_${e}`,createdTime:M().format(),displayName:`New Provider - ${e}`,category:"OAuth",type:"GitHub",method:"Normal",clientId:"",clientSecret:"",enableSignUp:!0,host:"",port:0,providerUrl:"https://github.com/organizations/xxx/settings/applications/1234567"}}addProvider(){const e=this.newProvider();A(e).then(a=>{a.status==="ok"?(this.props.history.push({pathname:`/providers/${e.owner}/${e.name}`,mode:"add"}),u("success",r.t("general:Successfully added"))):u("error",`${r.t("general:Failed to add")}: ${a.msg}`)}).catch(a=>{u("error",`${r.t("general:Failed to connect to server")}: ${a}`)})}deleteProvider(e){T(this.state.data[e]).then(a=>{a.status==="ok"?(u("success",r.t("general:Successfully deleted")),this.setState({data:f(this.state.data,e),pagination:{total:this.state.pagination.total-1}})):u("error",`${r.t("general:Failed to delete")}: ${a.msg}`)}).catch(a=>{u("error",`${r.t("general:Failed to connect to server")}: ${a}`)})}renderTable(e){const a=[{title:r.t("general:Name"),dataIndex:"name",key:"name",width:"120px",fixed:"left",sorter:!0,...this.getColumnSearchProps("name"),render:(t,i,n)=>d(P,{to:`/providers/${i.owner}/${t}`,children:t})},{title:r.t("general:Organization"),dataIndex:"owner",key:"owner",width:"150px",sorter:!0,...this.getColumnSearchProps("owner")},{title:r.t("general:Created time"),dataIndex:"createdTime",key:"createdTime",width:"180px",sorter:!0,render:(t,i,n)=>w(t)},{title:r.t("general:Display name"),dataIndex:"displayName",key:"displayName",sorter:!0,...this.getColumnSearchProps("displayName")},{title:r.t("provider:Category"),dataIndex:"category",key:"category",filterMultiple:!1,filters:[{text:"OAuth",value:"OAuth"},{text:"Email",value:"Email"},{text:"SMS",value:"SMS"},{text:"Storage",value:"Storage"},{text:"SAML",value:"SAML"},{text:"Captcha",value:"Captcha"},{text:"Payment",value:"Payment"}],width:"110px",sorter:!0},{title:r.t("provider:Type"),dataIndex:"type",key:"type",width:"110px",align:"center",filterMultiple:!1,filters:[{text:"OAuth",value:"OAuth",children:l("OAuth").map(t=>({text:t.id,value:t.name}))},{text:"Email",value:"Email",children:l("Email").map(t=>({text:t.id,value:t.name}))},{text:"SMS",value:"SMS",children:l("SMS").map(t=>({text:t.id,value:t.name}))},{text:"Storage",value:"Storage",children:l("Storage").map(t=>({text:t.id,value:t.name}))},{text:"SAML",value:"SAML",children:l("SAML").map(t=>({text:t.id,value:t.name}))},{text:"Captcha",value:"Captcha",children:l("Captcha").map(t=>({text:t.id,value:t.name}))},{text:"Payment",value:"Payment",children:l("Payment").map(t=>({text:t.id,value:t.name}))}],sorter:!0,render:(t,i,n)=>C(i)},{title:r.t("provider:Client ID"),dataIndex:"clientId",key:"clientId",width:"100px",sorter:!0,...this.getColumnSearchProps("clientId"),render:(t,i,n)=>g(t)},{title:r.t("provider:Provider URL"),dataIndex:"providerUrl",key:"providerUrl",width:"150px",sorter:!0,...this.getColumnSearchProps("providerUrl"),render:(t,i,n)=>d("a",{target:"_blank",rel:"noreferrer",href:t,children:g(t)})},{title:r.t("general:Action"),dataIndex:"",key:"op",width:"170px",fixed:k()?"false":"right",render:(t,i,n)=>m("div",{children:[d(x,{disabled:!c(this.props.account)&&i.owner!==this.props.account.owner,style:{marginTop:"10px",marginBottom:"10px",marginRight:"10px"},type:"primary",onClick:()=>this.props.history.push(`/providers/${i.owner}/${i.name}`),children:r.t("general:Edit")}),d(O,{title:r.t("general:Sure to delete")+`: ${i.name} ?`,onConfirm:()=>this.deleteProvider(n)})]})}],h={total:this.state.pagination.total,showQuickJumper:!0,showSizeChanger:!0,showTotal:()=>r.t("general:{total} in total").replace("{total}",this.state.pagination.total)};return d("div",{children:d(N,{scroll:{x:"max-content"},columns:a,dataSource:e,rowKey:"name",size:"middle",bordered:!0,pagination:h,title:()=>m("div",{children:[r.t("general:Providers"),"    ",d(x,{type:"primary",size:"small",onClick:this.addProvider.bind(this),children:r.t("general:Add")})]}),loading:this.state.loading,onChange:this.handleTableChange})})}}export{G as default};
