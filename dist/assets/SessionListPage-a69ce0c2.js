var x=Object.defineProperty;var m=(o,t,e)=>t in o?x(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var g=(o,t,e)=>(m(o,typeof t!="symbol"?t+"":t,e),e);import{V as h,$ as u,s as c,i as r,b as S,j as l,L as T,c as $,dF as w,e as y,k}from"./index-a4571b31.js";import{B as C}from"./BaseListPage-cf3b6a63.js";import{P as z}from"./PopconfirmModal-c2d7912b.js";import{T as I}from"./Table-4974f722.js";import"./index-3220aa08.js";function P(o,t="",e="",a="",d="",n="",s=""){return fetch(`${h}/api/get-sessions?owner=${o}&p=${t}&pageSize=${e}&field=${a}&value=${d}&sortField=${n}&sortOrder=${s}`,{method:"GET",credentials:"include",headers:{"Accept-Language":u()}}).then(i=>i.json())}function b(o){return fetch(`${h}/api/delete-session`,{method:"POST",credentials:"include",body:JSON.stringify(o),headers:{"Accept-Language":u()}}).then(t=>t.json())}class D extends C{constructor(){super(...arguments);g(this,"fetch",(e={})=>{let a=e.searchedColumn,d=e.searchText;const n=e.sortField,s=e.sortOrder;e.contentType!==void 0&&e.contentType!==null&&(a="contentType",d=e.contentType),this.setState({loading:!0}),P("",e.pagination.current,e.pagination.pageSize,a,d,n,s).then(i=>{i.status==="ok"?this.setState({loading:!1,data:i.data,pagination:{...e.pagination,total:i.data2},searchText:e.searchText,searchedColumn:e.searchedColumn}):k(i)&&this.setState({loading:!1,isAuthorized:!1})})})}deleteSession(e){b(this.state.data[e]).then(a=>{a.status==="ok"?(c("success",r.t("general:Successfully deleted")),this.setState({data:S(this.state.data,e),pagination:{total:this.state.pagination.total-1}})):c("error",`${r.t("general:Failed to delete")}: ${a.msg}`)}).catch(a=>{c("error",`${r.t("general:Failed to connect to server")}: ${a}`)})}renderTable(e){const a=[{title:r.t("general:Name"),dataIndex:"name",key:"name",width:"150px",fixed:"left",sorter:!0,...this.getColumnSearchProps("name")},{title:r.t("general:Organization"),dataIndex:"owner",key:"organization",width:"110px",sorter:!0,...this.getColumnSearchProps("organization"),render:(n,s,i)=>l(T,{to:`/organizations/${n}`,children:n})},{title:r.t("general:Created time"),dataIndex:"createdTime",key:"createdTime",width:"180px",sorter:!0,render:(n,s,i)=>$(n)},{title:r.t("general:Session ID"),dataIndex:"sessionId",key:"sessionId",width:"180px",sorter:!0,render:(n,s,i)=>n.map((p,f)=>l(w,{children:p},f))},{title:r.t("general:Action"),dataIndex:"",key:"op",width:"70px",fixed:y()?"false":"right",render:(n,s,i)=>l("div",{children:l(z,{title:r.t("general:Sure to delete")+`: ${s.name} ?`,onConfirm:()=>this.deleteSession(i)})})}],d={total:this.state.pagination.total,showQuickJumper:!0,showSizeChanger:!0,showTotal:()=>r.t("general:{total} in total").replace("{total}",this.state.pagination.total)};return l("div",{children:l(I,{scroll:{x:"max-content"},columns:a,dataSource:e,rowKey:"name",size:"middle",bordered:!0,pagination:d,loading:this.state.loading,onChange:this.handleTableChange})})}}export{D as default};
