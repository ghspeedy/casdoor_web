var w=Object.defineProperty;var C=(d,n,e)=>n in d?w(d,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[n]=e;var x=(d,n,e)=>(C(d,typeof n!="symbol"?n+"":n,e),e);import{g as $,S as T,s as l,i as t,b as v,j as r,L as f,c as I,f as p,n as b,o as P,e as L,B as u,k as B,T as z,ag as F}from"./index-a4571b31.js";import{h as R}from"./moment-fbc5633a.js";import{a as N,d as q,g as D}from"./ProductBackend-0ca51f3d.js";import{B as E}from"./BaseListPage-cf3b6a63.js";import{P as M}from"./PopconfirmModal-c2d7912b.js";import{T as j}from"./Table-4974f722.js";import{L as S}from"./index-ee984c89.js";import{E as A}from"./EditOutlined-5f57c71a.js";import"./index-3220aa08.js";class Y extends E{constructor(){super(...arguments);x(this,"fetch",(e={})=>{let a=e.searchedColumn,c=e.searchText;const i=e.sortField,s=e.sortOrder;e.type!==void 0&&e.type!==null&&(a="type",c=e.type),this.setState({loading:!0}),D("",e.pagination.current,e.pagination.pageSize,a,c,i,s).then(o=>{o.status==="ok"?this.setState({loading:!1,data:o.data,pagination:{...e.pagination,total:o.data2},searchText:e.searchText,searchedColumn:e.searchedColumn}):B(o)&&this.setState({loading:!1,isAuthorized:!1})})})}newProduct(){const e=$();return{owner:"admin",name:`product_${e}`,createdTime:R().format(),displayName:`New Product - ${e}`,image:`${T}/img/casdoor-logo_1185x256.png`,tag:"Casdoor Summit 2022",currency:"USD",price:300,quantity:99,sold:10,providers:[],state:"Published"}}addProduct(){const e=this.newProduct();N(e).then(a=>{a.status==="ok"?(this.props.history.push({pathname:`/products/${e.name}`,mode:"add"}),l("success",t.t("general:Successfully added"))):l("error",`${t.t("general:Failed to add")}: ${a.msg}`)}).catch(a=>{l("error",`${t.t("general:Failed to connect to server")}: ${a}`)})}deleteProduct(e){q(this.state.data[e]).then(a=>{a.status==="ok"?(l("success",t.t("general:Successfully deleted")),this.setState({data:v(this.state.data,e),pagination:{total:this.state.pagination.total-1}})):l("error",`${t.t("general:Failed to delete")}: ${a.msg}`)}).catch(a=>{l("error",`${t.t("general:Failed to connect to server")}: ${a}`)})}renderTable(e){const a=[{title:t.t("general:Name"),dataIndex:"name",key:"name",width:"140px",fixed:"left",sorter:!0,...this.getColumnSearchProps("name"),render:(i,s,o)=>r(f,{to:`/products/${i}`,children:i})},{title:t.t("general:Created time"),dataIndex:"createdTime",key:"createdTime",width:"160px",sorter:!0,render:(i,s,o)=>I(i)},{title:t.t("general:Display name"),dataIndex:"displayName",key:"displayName",width:"170px",sorter:!0,...this.getColumnSearchProps("displayName")},{title:t.t("product:Image"),dataIndex:"image",key:"image",width:"170px",render:(i,s,o)=>r("a",{target:"_blank",rel:"noreferrer",href:i,children:r("img",{src:i,alt:i,width:150})})},{title:t.t("user:Tag"),dataIndex:"tag",key:"tag",width:"160px",sorter:!0,...this.getColumnSearchProps("tag")},{title:t.t("payment:Currency"),dataIndex:"currency",key:"currency",width:"120px",sorter:!0,...this.getColumnSearchProps("currency")},{title:t.t("product:Price"),dataIndex:"price",key:"price",width:"120px",sorter:!0,...this.getColumnSearchProps("price")},{title:t.t("product:Quantity"),dataIndex:"quantity",key:"quantity",width:"120px",sorter:!0,...this.getColumnSearchProps("quantity")},{title:t.t("product:Sold"),dataIndex:"sold",key:"sold",width:"120px",sorter:!0,...this.getColumnSearchProps("sold")},{title:t.t("general:State"),dataIndex:"state",key:"state",width:"120px",sorter:!0,...this.getColumnSearchProps("state")},{title:t.t("product:Payment providers"),dataIndex:"providers",key:"providers",width:"500px",...this.getColumnSearchProps("providers"),render:(i,s,o)=>{const h=i;if(h.length===0)return`(${t.t("general:empty")})`;const m=Math.floor((h.length+1)/2),y=k=>r(S,{size:"small",locale:{emptyText:" "},dataSource:k,renderItem:(g,O)=>r(S.Item,{children:p("div",{style:{display:"inline"},children:[r(z,{placement:"topLeft",title:"Edit",children:r(u,{style:{marginRight:"5px"},icon:r(A,{}),size:"small",onClick:()=>F(this,`/providers/${g}`)})}),r(f,{to:`/providers/${g}`,children:g})]})})});return r("div",{children:p(b,{children:[r(P,{span:12,children:y(h.slice(0,m))}),r(P,{span:12,children:y(h.slice(m))})]})})}},{title:t.t("general:Action"),dataIndex:"",key:"op",width:"230px",fixed:L()?"false":"right",render:(i,s,o)=>p("div",{children:[r(u,{style:{marginTop:"10px",marginBottom:"10px",marginRight:"10px"},onClick:()=>this.props.history.push(`/products/${s.name}/buy`),children:t.t("product:Buy")}),r(u,{style:{marginTop:"10px",marginBottom:"10px",marginRight:"10px"},type:"primary",onClick:()=>this.props.history.push(`/products/${s.name}`),children:t.t("general:Edit")}),r(M,{title:t.t("general:Sure to delete")+`: ${s.name} ?`,onConfirm:()=>this.deleteProduct(o)})]})}],c={total:this.state.pagination.total,showQuickJumper:!0,showSizeChanger:!0,showTotal:()=>t.t("general:{total} in total").replace("{total}",this.state.pagination.total)};return r("div",{children:r(j,{scroll:{x:"max-content"},columns:a,dataSource:e,rowKey:"name",size:"middle",bordered:!0,pagination:c,title:()=>p("div",{children:[t.t("general:Products"),"    ",r(u,{type:"primary",size:"small",onClick:this.addProduct.bind(this),children:t.t("general:Add")})]}),loading:this.state.loading,onChange:this.handleTableChange})})}}export{Y as default};
